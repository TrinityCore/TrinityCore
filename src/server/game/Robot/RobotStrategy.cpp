#include "RobotStrategy.h"
#include "Script_Warrior.h"
#include "Script_Hunter.h"
#include "Script_Shaman.h"
#include "Script_Paladin.h"
#include "Script_Warlock.h"
#include "Script_Priest.h"
#include "Script_Rogue.h"
#include "Script_Mage.h"
#include "Script_Druid.h"
#include "RobotConfig.h"
#include "RobotManager.h"
#include "Group.h"
#include "MotionMaster.h"
#include "FollowMovementGenerator.h"
#include "ChaseMovementGenerator.h"
#include "GridNotifiers.h"
#include "Map.h"
#include "Pet.h"

RobotStrategy::RobotStrategy(Player* pmMe)
{
    me = pmMe;
    engageTarget = NULL;
    restDelay = 0;
    engageDelay = 0;
    strategyType = RobotStrategyType::RobotStrategyType_Solo;
}

void RobotStrategy::Update(uint32 pmDiff)
{
    return;
}

void RobotStrategy_Solo::InitialStrategy()
{
    strategyType = RobotStrategyType::RobotStrategyType_Solo;
    soloState = RobotSoloState::RobotSoloState_Wander;

    deathDelay = 0;
    soloDelay = urand(sRobotConfig->SoloMinDelay, sRobotConfig->SoloMaxDelay);
    restDelay = 0;
    waitDelay = 0;
    strollDelay = 0;
    confuseDelay = 0;
    interestsDelay = 0;

    switch (me->GetClass())
    {
    case Classes::CLASS_WARRIOR:
    {
        sb = new Script_Warrior(me);
        break;
    }
    case Classes::CLASS_HUNTER:
    {
        sb = new Script_Hunter(me);
        break;
    }
    case Classes::CLASS_SHAMAN:
    {
        sb = new Script_Shaman(me);
        break;
    }
    case Classes::CLASS_PALADIN:
    {
        sb = new Script_Paladin(me);
        break;
    }
    case Classes::CLASS_WARLOCK:
    {
        sb = new Script_Warlock(me);
        break;
    }
    case Classes::CLASS_PRIEST:
    {
        sb = new Script_Priest(me);
        break;
    }
    case Classes::CLASS_ROGUE:
    {
        sb = new Script_Rogue(me);
        break;
    }
    case Classes::CLASS_MAGE:
    {
        sb = new Script_Mage(me);
        break;
    }
    case Classes::CLASS_DRUID:
    {
        sb = new Script_Druid(me);
        break;
    }
    }
}

void RobotStrategy_Solo::Update(uint32 pmDiff)
{
    if (!me)
    {
        return;
    }
    if (me->GetGroup())
    {
        me->rai->GetActiveStrategy()->sb->Reset();
        me->rai->activeStrategyIndex = Strategy_Index::Strategy_Index_Group;
        return;
    }
    if (!me->GetSession()->isRobotSession)
    {
        return;
    }
    if (interestsDelay > 0)
    {
        interestsDelay -= pmDiff;
    }
    if (!me->IsAlive())
    {
        if (deathDelay > 0)
        {
            deathDelay -= pmDiff;
            if (deathDelay <= 0)
            {
                sb->RandomTeleport();
                return;
            }
        }
        else
        {
            deathDelay = urand(sRobotConfig->DeathMinDelay, sRobotConfig->DeathMaxDelay);
        }
        return;
    }
    soloDelay -= pmDiff;
    if (soloDelay < 0)
    {
        sb->RandomTeleport();
        return;
    }
    switch (soloState)
    {
    case RobotSoloState::RobotSoloState_None:
    {
        return;
    }
    case RobotSoloState::RobotSoloState_Wander:
    {
        if (me->IsInCombat())
        {
            me->StopMoving();
            me->GetMotionMaster()->Clear();
            soloState = RobotSoloState::RobotSoloState_Battle;
            return;
        }
        if (Rest())
        {
            return;
        }
        if (Buff())
        {
            return;
        }
        if (PVP())
        {
            engageDelay = 20 * TimeConstants::IN_MILLISECONDS;
            return;
        }
        if (urand(0, 1) == 0)
        {
            if (Confuse())
            {
                return;
            }
        }
        if (urand(0, 1) == 0)
        {
            if (Stroll())
            {
                return;
            }
        }
        if (Battle())
        {
            soloState = RobotSoloState::RobotSoloState_Battle;
            engageDelay = 10 * TimeConstants::IN_MILLISECONDS;
            return;
        }
        if (Wait())
        {
            return;
        }
        break;
    }
    case RobotSoloState::RobotSoloState_Battle:
    {
        if (me->IsInCombat())
        {
            engageDelay = 0;
            if (me->GetHealthPct() < 40.0f)
            {
                if (Heal())
                {
                    return;
                }
            }
            if (Battle())
            {
                return;
            }
            if (me->GetClass() == Classes::CLASS_HUNTER)
            {
                me->HandleEmoteCommand(Emote::EMOTE_ONESHOT_CHEER);
            }
        }
        else
        {
            if (engageDelay > 0)
            {
                engageDelay -= pmDiff;
            }
            if (engageDelay <= 0)
            {
                engageDelay = 0;
                soloState = RobotSoloState::RobotSoloState_Wander;
                return;
            }
            if (sb->Attack(engageTarget))
            {
                return;
            }
            else
            {
                engageTarget = NULL;
                engageDelay = 0;
            }
        }
        break;
    }
    case RobotSoloState::RobotSoloState_Rest:
    {
        if (me->IsInCombat())
        {
            restDelay = 0;
            me->StopMoving();
            me->GetMotionMaster()->Clear();
            soloState = RobotSoloState::RobotSoloState_Battle;
            return;
        }
        restDelay -= pmDiff;
        if (restDelay < 0)
        {
            me->StopMoving();
            me->GetMotionMaster()->Clear();
            soloState = RobotSoloState::RobotSoloState_Wander;
            return;
        }
        break;
    }
    case RobotSoloState::RobotSoloState_Wait:
    {
        if (me->IsInCombat())
        {
            waitDelay = 0;
            me->StopMoving();
            me->GetMotionMaster()->Clear();
            soloState = RobotSoloState::RobotSoloState_Battle;
            return;
        }
        waitDelay -= pmDiff;
        if (waitDelay < 0)
        {
            me->StopMoving();
            me->GetMotionMaster()->Clear();
            soloState = RobotSoloState::RobotSoloState_Wander;
            return;
        }
        break;
    }
    case RobotSoloState::RobotSoloState_Stroll:
    {
        if (me->IsInCombat())
        {
            strollDelay = 0;
            me->StopMoving();
            me->GetMotionMaster()->Clear();
            soloState = RobotSoloState::RobotSoloState_Battle;
            return;
        }
        strollDelay -= pmDiff;
        if (strollDelay < 0)
        {
            me->StopMoving();
            me->GetMotionMaster()->Clear();
            soloState = RobotSoloState::RobotSoloState_Wander;
            return;
        }
        break;
    }
    case RobotSoloState::RobotSoloState_Confuse:
    {
        if (me->IsInCombat())
        {
            confuseDelay = 0;
            me->StopMoving();
            me->GetMotionMaster()->Clear();
            soloState = RobotSoloState::RobotSoloState_Battle;
            return;
        }
        confuseDelay -= pmDiff;
        if (confuseDelay < 0)
        {
            me->StopMoving();
            me->GetMotionMaster()->Clear();
            soloState = RobotSoloState::RobotSoloState_Wander;
            return;
        }
        break;
    }
    default:
    {
        break;
    }
    }
}

bool RobotStrategy_Solo::Buff()
{
    if (me)
    {
        return sb->Buff(me, true);
    }
    return false;
}

bool RobotStrategy_Solo::Rest()
{
    if (!me)
    {
        return false;
    }
    if (me->IsInCombat())
    {
        return false;
    }
    else
    {
        float hpRate = me->GetHealthPct();
        float mpRate = 100;
        if (me->GetPowerType() == Powers::POWER_MANA)
        {
            mpRate = me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA);
        }
        if (hpRate > 50 && mpRate > 50)
        {
            return false;
        }
        else
        {
            if (sb->Rest())
            {
                soloState = RobotSoloState::RobotSoloState_Rest;
                restDelay = DEFAULT_REST_DELAY;
                return true;
            }
        }
    }

    return false;
}

bool RobotStrategy_Solo::Battle()
{
    if (!me)
    {
        return false;
    }
    if (Unit* myTarget = me->GetSelectedUnit())
    {
        if (Player* targetPlayer = myTarget->ToPlayer())
        {
            if (sb->Attack(targetPlayer))
            {
                engageTarget = targetPlayer;
                return true;
            }
        }
    }
    for (Unit::AttackerSet::const_iterator attackerIT = me->getAttackers().begin(); attackerIT != me->getAttackers().end(); attackerIT++)
    {
        if (Unit* pTarget = *attackerIT)
        {
            if (Player* targetPlayer = pTarget->ToPlayer())
            {
                if (sb->Attack(targetPlayer))
                {
                    engageTarget = targetPlayer;
                    return true;
                }
            }
        }
    }
    if (Pet* memberPet = me->GetPet())
    {
        if (memberPet->IsAlive())
        {
            for (Unit::AttackerSet::const_iterator attackerIT = memberPet->getAttackers().begin(); attackerIT != memberPet->getAttackers().end(); ++attackerIT)
            {
                if (Unit* eachAttacker = *attackerIT)
                {
                    if (Player* targetPlayer = eachAttacker->ToPlayer())
                    {
                        if (sb->Attack(targetPlayer))
                        {
                            engageTarget = targetPlayer;
                            return true;
                        }
                    }
                }
            }
        }
    }
    if (Unit* myTarget = me->GetSelectedUnit())
    {
        if (sb->Attack(myTarget))
        {
            engageTarget = myTarget;
            return true;
        }
    }
    Unit* closestAttacker = NULL;
    float closestDistance = DEFAULT_VISIBILITY_DISTANCE;
    for (Unit::AttackerSet::const_iterator attackerIT = me->getAttackers().begin(); attackerIT != me->getAttackers().end(); attackerIT++)
    {
        if (Unit* pTarget = *attackerIT)
        {
            float distance = me->GetDistance(pTarget);
            if (distance < closestDistance)
            {
                closestDistance = distance;
                closestAttacker = pTarget;
            }
        }
    }
    if (Pet* memberPet = me->GetPet())
    {
        if (memberPet->IsAlive())
        {
            for (Unit::AttackerSet::const_iterator attackerIT = memberPet->getAttackers().begin(); attackerIT != memberPet->getAttackers().end(); ++attackerIT)
            {
                if (Unit* eachAttacker = *attackerIT)
                {
                    float distance = me->GetDistance(eachAttacker);
                    if (distance < closestDistance)
                    {
                        closestDistance = distance;
                        closestAttacker = eachAttacker;
                    }
                }
            }
        }
    }
    if (sb->Attack(closestAttacker))
    {
        engageTarget = closestAttacker;
        return true;
    }

    std::list<Unit*> attackTargets;
    Trinity::AnyUnfriendlyUnitInObjectRangeCheck u_check(me, me, DEFAULT_VISIBILITY_DISTANCE);
    Trinity::UnitListSearcher<Trinity::AnyUnfriendlyUnitInObjectRangeCheck> searcher(me, attackTargets, u_check);
    Cell::VisitAllObjects(me, searcher, DEFAULT_VISIBILITY_DISTANCE);
    Unit* nearestAttackableTarget = NULL;
    float nearestDistance = MAX_VISIBILITY_DISTANCE;
    for (std::list<Unit*>::iterator it = attackTargets.begin(); it != attackTargets.end(); it++)
    {
        if (Unit* eachU = *it)
        {
            if (eachU->IsPet())
            {
                if (Pet* pet = eachU->ToPet())
                {
                    if (pet->GetCharmerOrOwner())
                    {
                        continue;
                    }
                }
            }
            if (!me->IsValidAttackTarget(eachU))
            {
                continue;
            }
            if (!me->IsWithinLOSInMap(eachU))
            {
                continue;
            }
            if (eachU->GetTypeId() == TypeID::TYPEID_PLAYER)
            {
                if (sb->Attack(eachU))
                {
                    engageTarget = eachU;
                    return true;
                }
            }
            float checkDistance = me->GetDistance(eachU);
            if (checkDistance < nearestDistance)
            {
                nearestDistance = checkDistance;
                nearestAttackableTarget = eachU;
            }
        }
    }
    if (sb->Attack(nearestAttackableTarget))
    {
        engageTarget = nearestAttackableTarget;
        return true;
    }

    return false;
}

bool RobotStrategy_Solo::PVP()
{
    if (!me)
    {
        return false;
    }
    std::list<Player*> attackTargets;
    Trinity::AnyPlayerInObjectRangeCheck u_check(me, DEFAULT_VISIBILITY_DISTANCE);
    Trinity::PlayerListSearcher<Trinity::AnyPlayerInObjectRangeCheck> searcher(me, attackTargets, u_check);
    Cell::VisitWorldObjects(me, searcher, DEFAULT_VISIBILITY_DISTANCE);
    for (std::list<Player*>::iterator it = attackTargets.begin(); it != attackTargets.end(); it++)
    {
        if (Player* eachPlayer = *it)
        {
            if (sb->Attack(eachPlayer))
            {
                engageTarget = eachPlayer;
                return true;
            }
        }
    }

    return false;
}

bool RobotStrategy_Solo::Heal()
{
    if (me)
    {
        return sb->Heal(me, true);
    }
    return false;
}

bool RobotStrategy_Solo::Wait()
{
    if (me)
    {
        sb->ClearTarget();
        me->AttackStop();
        me->GetMotionMaster()->Clear();
        me->StopMoving();
        waitDelay = 5 * TimeConstants::IN_MILLISECONDS;
        soloState = RobotSoloState::RobotSoloState_Wait;
        return true;
    }
    return false;
}

bool RobotStrategy_Solo::Stroll()
{
    if (me)
    {
        float destX = 0;
        float destY = 0;
        float destZ = 0;
        Position rdp = me->GetRandomPoint(me->GetPosition(), DEFAULT_VISIBILITY_DISTANCE);
        me->GetMotionMaster()->MovePoint(0, rdp);
        strollDelay = 5 * TimeConstants::IN_MILLISECONDS;
        soloState = RobotSoloState::RobotSoloState_Stroll;
        return true;
    }
    return false;
}

bool RobotStrategy_Solo::Confuse()
{
    // EJ confuse issue use wait instead
    return Wait();

    if (me)
    {
        me->StopMoving();
        me->GetMotionMaster()->Clear();
        me->GetMotionMaster()->MoveConfused();
        confuseDelay = 5 * TimeConstants::IN_MILLISECONDS;
        soloState = RobotSoloState::RobotSoloState_Confuse;
        return true;
    }
    return false;
}

void RobotStrategy_Solo::HandleChatCommand(Player* pmSender, std::string pmCMD)
{
    if (!me)
    {
        return;
    }
    std::vector<std::string> commandVector = sRobotManager->SplitString(pmCMD, " ", true);
    std::string commandName = commandVector.at(0);
    if (commandName == "who")
    {
        sb->WhisperTo(sRobotManager->characterTalentTabNameMap[me->GetClass()][sb->characterTalentTab], Language::LANG_UNIVERSAL, pmSender);
    }
}

void RobotStrategy_Solo::Reset()
{
    deathDelay = 0;
    confuseDelay = 0;
    engageDelay = 0;
    restDelay = 0;
    soloDelay = urand(sRobotConfig->SoloMinDelay, sRobotConfig->SoloMaxDelay);
    waitDelay = 0;
    strollDelay = 0;
    soloState = RobotSoloState::RobotSoloState_Wander;
}

void RobotStrategy_Group::InitialStrategy()
{
    strategyType = RobotStrategyType::RobotStrategyType_Group;
    combatTime = 0;
    moveDelay = 0;
    teleportAssembleDelay = 0;
    restDelay = 0;
    readyCheckDelay = 0;
    aoeDelay = sRobotConfig->AOEDelay;
    dpsDelay = sRobotConfig->DPSDelay;
    staying = false;
    holding = false;
    following = true;
    cure = true;
    actionType = 0;
    actionDelay = 0;
    followDistance = FOLLOW_NORMAL_DISTANCE;
    if (me)
    {
        switch (me->GetClass())
        {
        case Classes::CLASS_WARRIOR:
        {
            sb = new Script_Warrior(me);
            followDistance = MELEE_MIN_DISTANCE;
            break;
        }
        case Classes::CLASS_HUNTER:
        {
            sb = new  Script_Hunter(me);
            break;
        }
        case Classes::CLASS_SHAMAN:
        {
            sb = new  Script_Shaman(me);
            break;
        }
        case Classes::CLASS_PALADIN:
        {
            sb = new  Script_Paladin(me);
            followDistance = MELEE_MIN_DISTANCE;
            break;
        }
        case Classes::CLASS_WARLOCK:
        {
            sb = new  Script_Warlock(me);
            break;
        }
        case Classes::CLASS_PRIEST:
        {
            sb = new  Script_Priest(me);
            followDistance = MID_RANGE;
            break;
        }
        case Classes::CLASS_ROGUE:
        {
            sb = new  Script_Rogue(me);
            followDistance = MELEE_MIN_DISTANCE;
            break;
        }
        case Classes::CLASS_MAGE:
        {
            sb = new  Script_Mage(me);
            break;
        }
        case Classes::CLASS_DRUID:
        {
            sb = new  Script_Druid(me);
            followDistance = MELEE_MIN_DISTANCE;
            break;
        }
        default:
        {
            sb = new  Script_Base(me);
            break;
        }
        }
    }
}

bool RobotStrategy_Group::Chasing()
{
    if (holding)
    {
        return false;
    }
    return true;
}

bool RobotStrategy_Group::Update0(uint32 pmDiff)
{
    if (!me)
    {
        return false;
    }
    sb->Update(pmDiff);

    if (Group* myGroup = me->GetGroup())
    {
        if (!me->GetSession()->isRobotSession)
        {
            return false;
        }
        if (Player* leaderPlayer = ObjectAccessor::FindConnectedPlayer(myGroup->GetLeaderGUID()))
        {
            if (WorldSession* leaderWS = leaderPlayer->GetSession())
            {
                if (leaderWS->isRobotSession)
                {
                    me->RemoveFromGroup();
                    return false;
                }
            }
        }
        if (readyCheckDelay > 0)
        {
            readyCheckDelay -= pmDiff;
            if (readyCheckDelay <= 0)
            {
                if (Group* myGroup = me->GetGroup())
                {
                    if (Player* leaderPlayer = ObjectAccessor::FindConnectedPlayer(myGroup->GetLeaderGUID()))
                    {
                        if (WorldSession* leaderWS = leaderPlayer->GetSession())
                        {
                            if (!leaderWS->isRobotSession)
                            {
                                uint8 readyCheckValue = 0;
                                if (!me->IsAlive())
                                {
                                    readyCheckValue = 0;
                                }
                                else if (me->GetDistance(leaderPlayer) > VISIBILITY_DISTANCE_NORMAL)
                                {
                                    readyCheckValue = 0;
                                }
                                else
                                {
                                    readyCheckValue = 1;
                                }
                                WorldPacket data(MSG_RAID_READY_CHECK, 8);
                                data << readyCheckValue;
                                if (WorldSession* myWS = me->GetSession())
                                {
                                    myWS->HandleRaidReadyCheckOpcode(data);
                                }
                            }
                        }
                    }
                }
            }
        }
        if (teleportAssembleDelay > 0)
        {
            teleportAssembleDelay -= pmDiff;
            if (teleportAssembleDelay <= 0)
            {
                if (Player* leaderPlayer = ObjectAccessor::FindConnectedPlayer(myGroup->GetLeaderGUID()))
                {
                    if (!me->IsAlive())
                    {
                        me->ResurrectPlayer(0.2f);
                        me->SpawnCorpseBones();
                    }
                    me->ClearInCombat();
                    me->TeleportTo(leaderPlayer->GetWorldLocation());
                    sb->WhisperTo("I have come", Language::LANG_UNIVERSAL, leaderPlayer);
                    return false;
                }
            }
        }
        if (moveDelay > 0)
        {
            moveDelay -= pmDiff;
            return false;
        }
        if (staying)
        {
            return false;
        }
    }
    else
    {
        me->rai->GetActiveStrategy()->sb->Reset();
        me->rai->activeStrategyIndex = Strategy_Index::Strategy_Index_Solo;
        return false;
    }

    return true;
}

void RobotStrategy_Group::Update(uint32 pmDiff)
{
    if (!Update0(pmDiff))
    {
        return;
    }
    if (Group* myGroup = me->GetGroup())
    {
        bool groupInCombat = GroupInCombat();
        if (groupInCombat)
        {
            restDelay = 0;
            combatTime += pmDiff;
        }
        else
        {
            combatTime = 0;
        }
        if (engageDelay > 0)
        {
            engageDelay -= pmDiff;
            switch (me->groupRole)
            {
            case GroupRole::GroupRole_DPS:
            {
                if (sb->DPS(engageTarget, Chasing(), false, NULL))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole::GroupRole_Healer:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole::GroupRole_Tank:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return;
        }
        if (groupInCombat)
        {
            switch (me->groupRole)
            {
            case GroupRole::GroupRole_DPS:
            {
                if (DPS())
                {
                    return;
                }
                break;
            }
            case GroupRole::GroupRole_Healer:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole::GroupRole_Tank:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            default:
            {
                break;
            }
            }
        }
        else
        {
            if (restDelay > 0)
            {
                restDelay -= pmDiff;
                return;
            }
            switch (me->groupRole)
            {
            case GroupRole::GroupRole_DPS:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole::GroupRole_Healer:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole::GroupRole_Tank:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            default:
            {
                break;
            }
            }
        }
        Follow();
    }
    else
    {
        me->rai->GetActiveStrategy()->sb->Reset();
        me->rai->activeStrategyIndex = Strategy_Index::Strategy_Index_Solo;
        return;
    }
}

bool RobotStrategy_Group::GroupInCombat()
{
    if (!me)
    {
        return false;
    }
    if (Group* myGroup = me->GetGroup())
    {
        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
        {
            if (Player* member = groupRef->GetSource())
            {
                if (member->IsInCombat())
                {
                    if (me->GetDistance(member) < ATTACK_RANGE_LIMIT)
                    {
                        return true;
                    }
                }
                else if (Pet* memberPet = member->GetPet())
                {
                    if (memberPet->IsAlive())
                    {
                        if (memberPet->IsInCombat())
                        {
                            if (me->GetDistance(memberPet) < ATTACK_RANGE_LIMIT)
                            {
                                return true;
                            }
                        }
                    }
                }
            }
        }
    }

    return false;
}

Player* RobotStrategy_Group::GetPlayerByGroupRole(uint32 pmGroupRole)
{
    if (!me)
    {
        return NULL;
    }
    if (Group* myGroup = me->GetGroup())
    {
        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
        {
            if (Player* member = groupRef->GetSource())
            {
                if (member->groupRole == pmGroupRole)
                {
                    return member;
                }
            }
        }
    }

    return NULL;
}

std::unordered_set<Player*> RobotStrategy_Group::GetPlayerSetByGroupRoleSet(std::unordered_set<uint32> pmGroupRoleSet)
{
    std::unordered_set<Player*> resultSet;
    resultSet.clear();

    if (me)
    {
        if (Group* myGroup = me->GetGroup())
        {
            for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
            {
                if (Player* member = groupRef->GetSource())
                {
                    if (pmGroupRoleSet.find(member->groupRole) != pmGroupRoleSet.end())
                    {
                        resultSet.insert(member);
                    }
                }
            }
        }
    }

    return resultSet;
}

std::unordered_set<ObjectGuid> RobotStrategy_Group::GetPlayerGUIDSetByGroupRoleSet(std::unordered_set<uint32> pmGroupRoleSet)
{
    std::unordered_set<ObjectGuid> resultSet;
    resultSet.clear();

    if (me)
    {
        if (Group* myGroup = me->GetGroup())
        {
            for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
            {
                if (Player* member = groupRef->GetSource())
                {
                    if (pmGroupRoleSet.find(member->groupRole) != pmGroupRoleSet.end())
                    {
                        resultSet.insert(member->GetGUID());
                    }
                }
            }
        }
    }

    return resultSet;
}

Player* RobotStrategy_Group::GetMainTank()
{
    if (!me)
    {
        return NULL;
    }
    switch (me->groupRole)
    {
    case GroupRole::GroupRole_Tank:
    {
        return me;
    }
    default:
    {
        if (Group* myGroup = me->GetGroup())
        {
            for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
            {
                if (Player* member = groupRef->GetSource())
                {
                    if (member->groupRole == GroupRole::GroupRole_Tank)
                    {
                        return member;
                    }
                }
            }
        }
        break;
    }
    }

    return NULL;
}

Player* RobotStrategy_Group::GetSubTank()
{
    return NULL;
}

bool RobotStrategy_Group::Engage(Unit* pmTarget)
{
    if (!me)
    {
        return false;
    }
    switch (me->groupRole)
    {
    case GroupRole::GroupRole_Tank:
    {
        return sb->Tank(pmTarget, Chasing());
    }
    case GroupRole::GroupRole_DPS:
    {
        return sb->DPS(pmTarget, Chasing(), false, NULL);
    }
    case GroupRole::GroupRole_Healer:
    {
        return Heal();
    }
    default:
    {
        break;
    }
    }

    return false;
}

bool RobotStrategy_Group::DPS()
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    if (combatTime > dpsDelay)
    {
        bool aoe = combatTime > aoeDelay;
        Player* mainTank = GetMainTank();
        if (mainTank)
        {
            if (sb->DPS(mainTank->GetSelectedUnit(), Chasing(), aoe, mainTank))
            {
                return true;
            }
        }
        if (sb->DPS(me->GetSelectedUnit(), Chasing(), aoe, mainTank))
        {
            return true;
        }
        Unit* closestVictim = NULL;
        float closestDistance = ATTACK_RANGE_LIMIT;
        std::unordered_map<ObjectGuid, Unit*> groupAttackerMap = GetAttackerMap();
        for (std::unordered_map<ObjectGuid, Unit*>::iterator gaIT = groupAttackerMap.begin(); gaIT != groupAttackerMap.end(); gaIT++)
        {
            if (Unit* eachAttacker = gaIT->second)
            {
                float eachAttackerDistance = me->GetDistance(eachAttacker);
                if (eachAttackerDistance < closestDistance)
                {
                    closestVictim = eachAttacker;
                    closestDistance = eachAttackerDistance;
                }
            }
        }
        if (sb->DPS(closestVictim, Chasing(), aoe, mainTank))
        {
            return true;
        }
    }

    return false;
}

bool RobotStrategy_Group::Lightwell()
{
    if (!me)
    {
        return false;
    }
    if (me->GetHealthPct() < 80.0f)
    {
        for (std::unordered_set<uint32>::iterator lightwellIT = sRobotManager->lightwellRenewSpellIDSet.begin(); lightwellIT != sRobotManager->lightwellRenewSpellIDSet.end(); lightwellIT++)
        {
            uint32 eachLightwellID = *lightwellIT;
            if (me->HasAura(eachLightwellID))
            {
                return false;
            }
        }

        std::list<Unit*> meleeRangeUnits;
        Trinity::AnyFriendlyUnitInObjectRangeCheck u_check(me, me, NOMINAL_MELEE_RANGE);
        Trinity::UnitListSearcher<Trinity::AnyFriendlyUnitInObjectRangeCheck> searcher(me, meleeRangeUnits, u_check);
        Cell::VisitAllObjects(me, searcher, NOMINAL_MELEE_RANGE);
        for (std::list<Unit*>::iterator it = meleeRangeUnits.begin(); it != meleeRangeUnits.end(); it++)
        {
            if (Unit* eachU = *it)
            {
                if (sRobotManager->lightwellUnitEntrySet.find(eachU->GetEntry()) != sRobotManager->lightwellUnitEntrySet.end())
                {
                    if (Creature* lightwellC = eachU->ToCreature())
                    {
                        lightwellC->HandleSpellClick(me);
                        return true;
                    }
                }
            }
        }
    }

    return false;
}

bool RobotStrategy_Group::Tank()
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    if (Player* mainTank = GetMainTank())
    {
        if (mainTank->GetGUID() != me->GetGUID())
        {
            return DPS();
        }
    }
    if (Unit* myTarget = me->GetSelectedUnit())
    {
        if (me->IsValidAttackTarget(myTarget))
        {
            if (myTarget->GetTarget() != me->GetGUID())
            {
                if (me->GetDistance(myTarget) < RANGED_MAX_DISTANCE)
                {
                    sb->Taunt(myTarget);
                    if (sb->Tank(myTarget, Chasing()))
                    {
                        return true;
                    }
                }
            }
        }
    }
    Unit* closestVictim = NULL;
    float closestDistance = ATTACK_RANGE_LIMIT;
    std::unordered_map<ObjectGuid, Unit*> groupAttackerMap = GetAttackerMap();
    for (std::unordered_map<ObjectGuid, Unit*>::iterator gaIT = groupAttackerMap.begin(); gaIT != groupAttackerMap.end(); gaIT++)
    {
        if (Unit* eachAttacker = gaIT->second)
        {
            // tank can only cover 30.0f range
            if (me->GetDistance(eachAttacker) < RANGED_MAX_DISTANCE)
            {
                if (eachAttacker->GetTarget() != me->GetGUID())
                {
                    sb->Taunt(eachAttacker);
                    if (sb->Tank(eachAttacker, Chasing()))
                    {
                        return true;
                    }
                }
                float eachAttackerDistance = me->GetDistance(eachAttacker);
                if (eachAttackerDistance < closestDistance)
                {
                    closestVictim = eachAttacker;
                    closestDistance = eachAttackerDistance;
                }
            }
        }
    }
    if (Unit* myTarget = me->GetSelectedUnit())
    {
        if (me->IsValidAttackTarget(myTarget))
        {
            if (sb->Tank(myTarget, Chasing()))
            {
                return true;
            }
        }
    }
    if (sb->Tank(closestVictim, Chasing()))
    {
        return true;
    }

    return false;
}

bool RobotStrategy_Group::Tank(Unit* pmTarget)
{
    if (!me)
    {
        return false;
    }
    switch (me->groupRole)
    {
    case GroupRole::GroupRole_Tank:
    {
        sb->ClearTarget();
        sb->ChooseTarget(pmTarget);
        return sb->Tank(pmTarget, Chasing());
    }
    default:
    {
        break;
    }
    }

    return false;
}

bool RobotStrategy_Group::Rest()
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    bool canTry = false;
    if (me->GetHealthPct() < 40.0f)
    {
        canTry = true;
    }
    if (me->GetPowerType() == Powers::POWER_MANA)
    {
        if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) < 40.0f)
        {
            canTry = true;
        }
    }
    if (canTry)
    {
        if (sb->Rest())
        {
            restDelay = DEFAULT_REST_DELAY;
            return true;
        }
    }

    return false;
}

bool RobotStrategy_Group::Heal()
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    if (Group* myGroup = me->GetGroup())
    {
        int lowMemberCount = 0;
        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
        {
            if (Player* member = groupRef->GetSource())
            {
                if (member->IsAlive())
                {
                    if (member->GetHealthPct() < 60.0f)
                    {
                        if (me->GetDistance(member) < RANGED_MAX_DISTANCE)
                        {
                            lowMemberCount++;
                        }
                    }
                }
            }
        }
        if (lowMemberCount > 2)
        {
            if (sb->GroupHeal())
            {
                return true;
            }
        }
        if (Player* mainTank = GetMainTank())
        {
            if (mainTank->GetHealthPct() < 90.0f)
            {
                if (sb->Heal(mainTank, cure))
                {
                    return true;
                }
            }
        }
        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
        {
            if (Player* member = groupRef->GetSource())
            {
                if (member->IsAlive())
                {
                    if (member->GetHealthPct() < 50.0f)
                    {
                        if (sb->Heal(member, cure))
                        {
                            return true;
                        }
                    }
                }
            }
        }
    }

    return false;
}

bool RobotStrategy_Group::Buff()
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    if (Group* myGroup = me->GetGroup())
    {
        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
        {
            if (Player* member = groupRef->GetSource())
            {
                if (sb->Buff(member, cure))
                {
                    return true;
                }
            }
        }
    }

    return false;
}

bool RobotStrategy_Group::Follow()
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    if (holding)
    {
        return false;
    }
    if (!following)
    {
        return false;
    }
    if (Player* mainTank = GetMainTank())
    {
        if (mainTank->GetGUID() != me->GetGUID())
        {
            if (sb->Follow(mainTank, followDistance))
            {
                return true;
            }
        }
    }
    if (Group* myGroup = me->GetGroup())
    {
        if (Player* leader = ObjectAccessor::FindConnectedPlayer(myGroup->GetLeaderGUID()))
        {
            return sb->Follow(leader, followDistance);
        }
    }
    return false;
}

bool RobotStrategy_Group::Stay(std::string pmTargetGroupRole)
{
    if (!me)
    {
        return false;
    }
    bool todo = true;
    if (pmTargetGroupRole == "dps")
    {
        if (me->groupRole != GroupRole::GroupRole_DPS)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "healer")
    {
        if (me->groupRole != GroupRole::GroupRole_Healer)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "tank")
    {
        if (me->groupRole != GroupRole::GroupRole_Tank)
        {
            todo = false;
        }
    }

    if (todo)
    {
        me->StopMoving();
        me->GetMotionMaster()->Clear();
        me->AttackStop();
        me->InterruptSpell(CURRENT_AUTOREPEAT_SPELL);
        sb->PetStop();
        staying = true;
        return true;
    }

    return false;
}

bool RobotStrategy_Group::Hold(std::string pmTargetGroupRole)
{
    if (!me)
    {
        return false;
    }
    bool todo = true;
    if (pmTargetGroupRole == "dps")
    {
        if (me->groupRole != GroupRole::GroupRole_DPS)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "healer")
    {
        if (me->groupRole != GroupRole::GroupRole_Healer)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "tank")
    {
        if (me->groupRole != GroupRole::GroupRole_Tank)
        {
            todo = false;
        }
    }

    if (todo)
    {
        holding = true;
        staying = false;
        return true;
    }

    return false;
}

std::string RobotStrategy_Group::GetGroupRoleName()
{
    if (!me)
    {
        return "";
    }
    switch (me->groupRole)
    {
    case GroupRole::GroupRole_DPS:
    {
        return "dps";
    }
    case GroupRole::GroupRole_Tank:
    {
        return "tank";
    }
    case GroupRole::GroupRole_Healer:
    {
        return "healer";
    }
    default:
    {
        break;
    }
    }
    return "dps";
}

void RobotStrategy_Group::SetGroupRole(std::string pmRoleName)
{
    if (!me)
    {
        return;
    }
    if (pmRoleName == "dps")
    {
        me->groupRole = GroupRole::GroupRole_DPS;
    }
    else if (pmRoleName == "tank")
    {
        me->groupRole = GroupRole::GroupRole_Tank;
    }
    else if (pmRoleName == "healer")
    {
        me->groupRole = GroupRole::GroupRole_Healer;
    }
}

std::unordered_map<ObjectGuid, Unit*> RobotStrategy_Group::GetAttackerMap()
{
    std::unordered_map<ObjectGuid, Unit*> attackerMap;
    attackerMap.clear();
    if (me)
    {
        if (Group* myGroup = me->GetGroup())
        {
            for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
            {
                if (Player* member = groupRef->GetSource())
                {
                    if (member->IsAlive())
                    {
                        for (Unit::AttackerSet::const_iterator attackerIT = member->getAttackers().begin(); attackerIT != member->getAttackers().end(); ++attackerIT)
                        {
                            if (Unit* eachAttacker = *attackerIT)
                            {
                                if (eachAttacker->IsAlive())
                                {
                                    if (attackerMap.find(eachAttacker->GetGUID()) == attackerMap.end())
                                    {
                                        attackerMap[eachAttacker->GetGUID()] = eachAttacker;
                                    }
                                }
                            }
                        }
                        if (Pet* memberPet = member->GetPet())
                        {
                            if (memberPet->IsAlive())
                            {
                                for (Unit::AttackerSet::const_iterator attackerIT = memberPet->getAttackers().begin(); attackerIT != memberPet->getAttackers().end(); ++attackerIT)
                                {
                                    if (Unit* eachAttacker = *attackerIT)
                                    {
                                        if (eachAttacker->IsAlive())
                                        {
                                            if (attackerMap.find(eachAttacker->GetGUID()) == attackerMap.end())
                                            {
                                                attackerMap[eachAttacker->GetGUID()] = eachAttacker;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    return attackerMap;
}

std::unordered_map<ObjectGuid, Unit*> RobotStrategy_Group::GetAddsMap(uint32 pmBossEntry)
{
    std::unordered_map<ObjectGuid, Unit*> attackerMap;
    attackerMap.clear();
    if (me)
    {
        if (Group* myGroup = me->GetGroup())
        {
            for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
            {
                if (Player* member = groupRef->GetSource())
                {
                    if (member->IsAlive())
                    {
                        for (Unit::AttackerSet::const_iterator attackerIT = member->getAttackers().begin(); attackerIT != member->getAttackers().end(); ++attackerIT)
                        {
                            if (Unit* eachAttacker = *attackerIT)
                            {
                                if (eachAttacker->IsAlive())
                                {
                                    if (eachAttacker->GetEntry() == pmBossEntry)
                                    {
                                        continue;
                                    }
                                    if (attackerMap.find(eachAttacker->GetGUID()) == attackerMap.end())
                                    {
                                        attackerMap[eachAttacker->GetGUID()] = eachAttacker;
                                    }
                                }
                            }
                        }
                        if (Pet* memberPet = member->GetPet())
                        {
                            if (memberPet->IsAlive())
                            {
                                for (Unit::AttackerSet::const_iterator attackerIT = memberPet->getAttackers().begin(); attackerIT != memberPet->getAttackers().end(); ++attackerIT)
                                {
                                    if (Unit* eachAttacker = *attackerIT)
                                    {
                                        if (eachAttacker->IsAlive())
                                        {
                                            if (eachAttacker->GetEntry() == pmBossEntry)
                                            {
                                                continue;
                                            }
                                            if (attackerMap.find(eachAttacker->GetGUID()) == attackerMap.end())
                                            {
                                                attackerMap[eachAttacker->GetGUID()] = eachAttacker;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    return attackerMap;
}

std::unordered_map<ObjectGuid, Unit*> RobotStrategy_Group::GetAttackerMap(uint32 pmAttackerEntry)
{
    std::unordered_map<ObjectGuid, Unit*> attackerMap;
    attackerMap.clear();
    if (me)
    {
        if (Group* myGroup = me->GetGroup())
        {
            for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
            {
                if (Player* member = groupRef->GetSource())
                {
                    if (member->IsAlive())
                    {
                        for (Unit::AttackerSet::const_iterator attackerIT = member->getAttackers().begin(); attackerIT != member->getAttackers().end(); ++attackerIT)
                        {
                            if (Unit* eachAttacker = *attackerIT)
                            {
                                if (eachAttacker->IsAlive())
                                {
                                    if (eachAttacker->GetEntry() != pmAttackerEntry)
                                    {
                                        continue;
                                    }
                                    if (attackerMap.find(eachAttacker->GetGUID()) == attackerMap.end())
                                    {
                                        attackerMap[eachAttacker->GetGUID()] = eachAttacker;
                                    }
                                }
                            }
                        }
                        if (Pet* memberPet = member->GetPet())
                        {
                            if (memberPet->IsAlive())
                            {
                                for (Unit::AttackerSet::const_iterator attackerIT = memberPet->getAttackers().begin(); attackerIT != memberPet->getAttackers().end(); ++attackerIT)
                                {
                                    if (Unit* eachAttacker = *attackerIT)
                                    {
                                        if (eachAttacker->IsAlive())
                                        {
                                            if (eachAttacker->GetEntry() != pmAttackerEntry)
                                            {
                                                continue;
                                            }
                                            if (attackerMap.find(eachAttacker->GetGUID()) == attackerMap.end())
                                            {
                                                attackerMap[eachAttacker->GetGUID()] = eachAttacker;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    return attackerMap;
}

Unit* RobotStrategy_Group::GetAttacker(uint32 pmAttackerEntry)
{
    if (me)
    {
        if (Group* myGroup = me->GetGroup())
        {
            for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
            {
                if (Player* member = groupRef->GetSource())
                {
                    if (member->IsAlive())
                    {
                        for (Unit::AttackerSet::const_iterator attackerIT = member->getAttackers().begin(); attackerIT != member->getAttackers().end(); ++attackerIT)
                        {
                            if (Unit* eachAttacker = *attackerIT)
                            {
                                if (eachAttacker->IsAlive())
                                {
                                    if (eachAttacker->GetEntry() == pmAttackerEntry)
                                    {
                                        return eachAttacker;
                                    }
                                }
                            }
                        }
                        if (Pet* memberPet = member->GetPet())
                        {
                            if (memberPet->IsAlive())
                            {
                                for (Unit::AttackerSet::const_iterator attackerIT = memberPet->getAttackers().begin(); attackerIT != memberPet->getAttackers().end(); ++attackerIT)
                                {
                                    if (Unit* eachAttacker = *attackerIT)
                                    {
                                        if (eachAttacker->IsAlive())
                                        {
                                            if (eachAttacker->GetEntry() == pmAttackerEntry)
                                            {
                                                return eachAttacker;
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}

bool RobotStrategy_Group::AngleInRange(float pmSourceAngle, float pmTargetAngle, float pmRange)
{
    float angleGap = std::abs(pmTargetAngle - pmSourceAngle);
    if (angleGap > M_PI)
    {
        angleGap = M_PI * 2 - angleGap;
    }
    if (angleGap < pmRange)
    {
        return true;
    }
    return false;
}

Position RobotStrategy_Group::GetNearPoint(Position pmSourcePosition, float pmDistance, float pmAbsoluteAngle)
{
    Position targetPosition;
    targetPosition.m_positionX = pmSourcePosition.GetPositionX() + pmDistance * std::cos(pmAbsoluteAngle);
    targetPosition.m_positionY = pmSourcePosition.GetPositionY() + pmDistance * std::sin(pmAbsoluteAngle);
    targetPosition.m_positionZ = pmSourcePosition.GetPositionZ() + 10.0f;
    me->UpdateAllowedPositionZ(targetPosition.m_positionX, targetPosition.m_positionY, targetPosition.m_positionZ);
    return targetPosition;
}

std::string RobotStrategy_Group_Blackrock_Spire::GetGroupRoleName()
{
    if (!me)
    {
        return "";
    }
    switch (me->groupRole)
    {
    case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_DPS:
    {
        return "dps";
    }
    case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank1:
    {
        return "tank1";
    }
    case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank2:
    {
        return "tank2";
    }
    case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank3:
    {
        return "tank3";
    }
    case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer1:
    {
        return "healer1";
    }
    case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer2:
    {
        return "healer2";
    }
    default:
    {
        break;
    }
    }
    return "dps";
}

void RobotStrategy_Group_Blackrock_Spire::SetGroupRole(std::string pmRoleName)
{
    if (!me)
    {
        return;
    }
    if (pmRoleName == "dps")
    {
        me->groupRole = GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_DPS;
    }
    else if (pmRoleName == "tank1")
    {
        me->groupRole = GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank1;
    }
    else if (pmRoleName == "tank2")
    {
        me->groupRole = GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank2;
    }
    else if (pmRoleName == "tank3")
    {
        me->groupRole = GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank3;
    }
    else if (pmRoleName == "healer1")
    {
        me->groupRole = GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer1;
    }
    else if (pmRoleName == "healer2")
    {
        me->groupRole = GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer2;
    }
}

void RobotStrategy_Group_Blackrock_Spire::InitialStrategy()
{
    RobotStrategy_Group::InitialStrategy();
    tankGythPos.m_positionX = 180.0f;
    tankGythPos.m_positionY = -420.0f;
    tankGythPos.m_positionZ = 110.5f;

    tankRendPos.m_positionX = 140.0f;
    tankRendPos.m_positionY = -420.0f;
    tankRendPos.m_positionZ = 110.5f;

    dpsGythPos.m_positionX = 160.0f;
    dpsGythPos.m_positionY = -420.0f;
    dpsGythPos.m_positionZ = 110.5f;

    tankDrakkisathPos1.m_positionX = 19.0f;
    tankDrakkisathPos1.m_positionY = -310.0f;
    tankDrakkisathPos1.m_positionZ = 111.0f;

    tankDrakkisathPos2.m_positionX = 7.0f;
    tankDrakkisathPos2.m_positionY = -310.0f;
    tankDrakkisathPos2.m_positionZ = 111.0f;

    tankDrakkisathAddsPos.m_positionX = 35.0f;
    tankDrakkisathAddsPos.m_positionY = -285.0f;
    tankDrakkisathAddsPos.m_positionZ = 111.0f;

    dpsDrakkisathPos.m_positionX = 12.0f;
    dpsDrakkisathPos.m_positionY = -285.0f;
    dpsDrakkisathPos.m_positionZ = 111.0f;
}

Player* RobotStrategy_Group_Blackrock_Spire::GetMainTank()
{
    if (!me)
    {
        return NULL;
    }
    if (Group* myGroup = me->GetGroup())
    {
        Player* tank1 = NULL;
        Player* tank2 = NULL;
        Player* tank3 = NULL;
        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
        {
            if (Player* member = groupRef->GetSource())
            {
                if (member->groupRole == GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank1)
                {
                    tank1 = member;
                }
                else if (member->groupRole == GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank2)
                {
                    tank2 = member;
                }
                else if (member->groupRole == GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank3)
                {
                    tank3 = member;
                }
            }
        }
        if (tank1)
        {
            if (tank1->IsAlive())
            {
                if (me->GetDistance(tank1) < ATTACK_RANGE_LIMIT)
                {
                    return tank1;
                }
            }
        }
        if (tank2)
        {
            if (tank2->IsAlive())
            {
                if (me->GetDistance(tank2) < ATTACK_RANGE_LIMIT)
                {
                    return tank2;
                }
            }
        }
        if (tank3)
        {
            if (tank3->IsAlive())
            {
                if (me->GetDistance(tank3) < ATTACK_RANGE_LIMIT)
                {
                    return tank3;
                }
            }
        }
    }

    return NULL;
}

bool RobotStrategy_Group_Blackrock_Spire::DPS()
{
    if (!me)
    {
        return false;
    }
    if (combatTime < dpsDelay)
    {
        if (GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Gyth))
        {
            if (me->GetClass() == Classes::CLASS_HUNTER || me->GetClass() == Classes::CLASS_MAGE || me->GetClass() == Classes::CLASS_PRIEST || me->GetClass() == Classes::CLASS_SHAMAN || me->GetClass() == Classes::CLASS_WARLOCK)
            {
                if (me->GetDistance(dpsGythPos) > 3.0f)
                {
                    actionType = ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_DPSGythMove;
                    actionDelay = 3000;
                    return true;
                }
            }
        }
        if (GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Drakkisath))
        {
            if (me->GetClass() == Classes::CLASS_HUNTER || me->GetClass() == Classes::CLASS_MAGE || me->GetClass() == Classes::CLASS_PRIEST || me->GetClass() == Classes::CLASS_SHAMAN || me->GetClass() == Classes::CLASS_WARLOCK)
            {
                if (me->GetDistance(dpsDrakkisathPos) > 3.0f)
                {
                    actionType = ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_DPSDrakkisathMove;
                    actionDelay = 3000;
                    return true;
                }
            }
        }
    }
    else
    {
        if (Unit* gyth = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Gyth))
        {
            if (me->GetClass() == Classes::CLASS_HUNTER || me->GetClass() == Classes::CLASS_MAGE || me->GetClass() == Classes::CLASS_PRIEST || me->GetClass() == Classes::CLASS_SHAMAN || me->GetClass() == Classes::CLASS_WARLOCK)
            {
                if (me->GetDistance(dpsGythPos) > 3.0f)
                {
                    actionType = ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_DPSGythMove;
                    actionDelay = 3000;
                    return true;
                }
                if (sb->DPS(gyth, Chasing(), false, NULL))
                {
                    return true;
                }
            }
        }
        if (Unit* gyth = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Drakkisath))
        {
            if (me->GetClass() == Classes::CLASS_HUNTER || me->GetClass() == Classes::CLASS_MAGE || me->GetClass() == Classes::CLASS_PRIEST || me->GetClass() == Classes::CLASS_SHAMAN || me->GetClass() == Classes::CLASS_WARLOCK)
            {
                if (me->GetDistance(dpsDrakkisathPos) > 3.0f)
                {
                    actionType = ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_DPSDrakkisathMove;
                    actionDelay = 3000;
                    return true;
                }
            }
            if (Player* addsTank = GetPlayerByGroupRole(GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank3))
            {
                if (sb->DPS(addsTank->GetSelectedUnit(), Chasing(), false, NULL))
                {
                    return true;
                }
            }
        }
    }

    return RobotStrategy_Group::DPS();
}

bool RobotStrategy_Group_Blackrock_Spire::Heal()
{
    if (!me)
    {
        return false;
    }
    if (GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Gyth))
    {
        if (me->GetDistance(dpsGythPos) > 3.0f)
        {
            actionType = ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_DPSGythMove;
            actionDelay = 3000;
            return true;
        }
    }
    else if (GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Drakkisath))
    {
        if (me->GetDistance(dpsDrakkisathPos) > 3.0f)
        {
            actionType = ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_DPSDrakkisathMove;
            actionDelay = 3000;
            return true;
        }
        if (me->groupRole == GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer1)
        {
            if (Player* tank1 = GetPlayerByGroupRole(GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank1))
            {
                if (tank1->IsAlive())
                {
                    if (tank1->GetHealthPct() < 90.0f)
                    {
                        if (sb->Heal(tank1, cure))
                        {
                            return true;
                        }
                    }
                }
            }
            if (Player* tank2 = GetPlayerByGroupRole(GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank2))
            {
                if (tank2->IsAlive())
                {
                    if (tank2->GetHealthPct() < 90.0f)
                    {
                        if (sb->Heal(tank2, cure))
                        {
                            return true;
                        }
                    }
                }
            }
            return true;
        }
        if (me->groupRole == GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer2)
        {
            if (Player* tank3 = GetPlayerByGroupRole(GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank3))
            {
                if (tank3->IsAlive())
                {
                    if (tank3->GetHealthPct() < 90.0f)
                    {
                        if (sb->Heal(tank3, cure))
                        {
                            return true;
                        }
                    }
                }
            }
            if (Group* myGroup = me->GetGroup())
            {
                int lowMemberCount = 0;
                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                {
                    if (Player* member = groupRef->GetSource())
                    {
                        if (member->IsAlive())
                        {
                            if (member->GetHealthPct() < 60.0f)
                            {
                                if (me->GetDistance(member) < FOLLOW_NORMAL_DISTANCE)
                                {
                                    lowMemberCount++;
                                }
                            }
                        }
                    }
                }
                if (lowMemberCount > 1)
                {
                    if (sb->GroupHeal())
                    {
                        return true;
                    }
                }
            }
            return true;
        }
    }

    return RobotStrategy_Group::Heal();
}

bool RobotStrategy_Group_Blackrock_Spire::Engage(Unit* pmTarget)
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    switch (me->groupRole)
    {
    case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_DPS:
    {
        return sb->DPS(pmTarget, Chasing(), false, NULL);
    }
    case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer1:
    {
        return Heal();
    }
    case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer2:
    {
        return Heal();
    }
    case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank1:
    {
        return Tank(pmTarget);
    }
    case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank2:
    {
        return Tank(pmTarget);
    }
    case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank3:
    {
        return Tank(pmTarget);
    }
    default:
    {
        break;
    }
    }

    return false;
}

bool RobotStrategy_Group_Blackrock_Spire::Tank(Unit* pmTarget)
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    switch (me->groupRole)
    {
    case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank1:
    {
        sb->ClearTarget();
        sb->ChooseTarget(pmTarget);
        return sb->Tank(pmTarget, Chasing());
    }
    default:
    {
        break;
    }
    }

    return false;
}

bool RobotStrategy_Group_Blackrock_Spire::Tank()
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    Player* mainTank = GetMainTank();
    if (Unit* gyth = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Gyth))
    {
        if (me->groupRole == GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank1)
        {
            if (gyth->GetTarget() != me->GetGUID())
            {
                sb->Taunt(gyth);
                if (sb->Tank(gyth, Chasing()))
                {
                    return true;
                }
            }
            if (me->GetDistance(tankGythPos) > 1.0f)
            {
                actionType = ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_TankGythMove;
                actionDelay = 3000;
                return true;
            }
            sb->Taunt(gyth);
            if (sb->Tank(gyth, Chasing()))
            {
                return true;
            }
        }
    }
    if (Unit* rend = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Rend))
    {
        if (me->groupRole == GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank2)
        {
            if (rend->GetTarget() != me->GetGUID())
            {
                sb->Taunt(rend);
                if (sb->Tank(rend, Chasing(), true))
                {
                    return true;
                }
            }
            if (me->GetDistance(tankRendPos) > 1.0f)
            {
                actionType = ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_TankRendMove;
                actionDelay = 3000;
                return true;
            }
            sb->Taunt(rend);
            if (sb->Tank(rend, Chasing(), true))
            {
                return true;
            }
        }
    }
    if (Unit* drakkisath = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Drakkisath))
    {
        if (me->groupRole == GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank1)
        {
            if (me->HasUnitState(UnitState::UNIT_STATE_CONFUSED))
            {
                return true;
            }
            if (drakkisath->GetTarget() != me->GetGUID())
            {
                sb->Taunt(drakkisath);
                if (sb->Tank(drakkisath, Chasing(), true))
                {
                    return true;
                }
            }
            if (me->GetDistance(tankDrakkisathPos1) > 1.0f)
            {
                actionType = ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_TankDrakkisathMove1;
                actionDelay = 1000;
                return true;
            }
            sb->Taunt(drakkisath);
            if (sb->Tank(drakkisath, Chasing(), true))
            {
                return true;
            }
        }
        if (me->groupRole == GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank2)
        {
            if (me->HasUnitState(UnitState::UNIT_STATE_CONFUSED))
            {
                return true;
            }
            if (mainTank->HasUnitState(UnitState::UNIT_STATE_CONFUSED))
            {
                if (drakkisath->GetTarget() != me->GetGUID())
                {
                    sb->Taunt(drakkisath);
                    if (sb->Tank(drakkisath, Chasing(), true))
                    {
                        return true;
                    }
                }
                if (me->GetDistance(tankDrakkisathPos2) > 1.0f)
                {
                    actionType = ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_TankDrakkisathMove2;
                    actionDelay = 1000;
                    return true;
                }
                sb->Taunt(drakkisath);
                if (sb->Tank(drakkisath, Chasing(), true))
                {
                    return true;
                }
            }
            if (me->GetDistance(tankDrakkisathPos2) > 1.0f)
            {
                actionType = ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_TankDrakkisathMove2;
                actionDelay = 3000;
                return true;
            }
            else
            {
                if (!me->isInFront(drakkisath, M_PI / 16))
                {
                    me->SetFacingToObject(drakkisath);
                }
            }
            me->AttackStop();
            return true;
        }
        if (me->groupRole == GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank3)
        {
            if (me->HasUnitState(UnitState::UNIT_STATE_CONFUSED))
            {
                return true;
            }
            std::unordered_map<ObjectGuid, Unit*> addsMap = GetAddsMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Drakkisath);
            if (addsMap.size() > 0)
            {
                Unit* closestAdds = NULL;
                float closestAddsDistance = ATTACK_RANGE_LIMIT;
                for (std::unordered_map<ObjectGuid, Unit*>::iterator addsIT = addsMap.begin(); addsIT != addsMap.end(); addsIT++)
                {
                    if (addsIT->second->GetTarget() != me->GetGUID())
                    {
                        sb->Taunt(addsIT->second);
                        if (sb->Tank(addsIT->second, Chasing()))
                        {
                            return true;
                        }
                    }
                    float eachAddsDistance = me->GetDistance(addsIT->second);
                    if (eachAddsDistance < closestAddsDistance)
                    {
                        closestAdds = addsIT->second;
                        closestAddsDistance = eachAddsDistance;
                    }
                }
                if (me->GetDistance(tankDrakkisathAddsPos) > 1.0f)
                {
                    actionType = ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_TankDrakkisathAddsMove;
                    actionDelay = 1000;
                    return true;
                }
                if (Unit* myTarget = me->GetSelectedUnit())
                {
                    if (addsMap.find(myTarget->GetGUID()) != addsMap.end())
                    {
                        sb->Taunt(myTarget);
                        if (sb->Tank(myTarget, Chasing()))
                        {
                            return true;
                        }
                    }
                }
                sb->Taunt(closestAdds);
                if (sb->Tank(closestAdds, Chasing()))
                {
                    return true;
                }
            }
        }
    }

    return RobotStrategy_Group::Tank();
}

void RobotStrategy_Group_Blackrock_Spire::Update(uint32 pmDiff)
{
    if (!Update0(pmDiff))
    {
        return;
    }
    if (Group* myGroup = me->GetGroup())
    {
        if (actionDelay > 0)
        {
            actionDelay -= pmDiff;
            switch (actionType)
            {
            case ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_TankGythMove:
            {
                if (me->GetDistance(tankGythPos) > 1.0f)
                {
                    me->GetMotionMaster()->MovePoint(0, tankGythPos);
                }
                else
                {
                    actionDelay = 0;
                }
                break;
            }
            case ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_TankRendMove:
            {
                if (me->GetDistance(tankRendPos) > 1.0f)
                {
                    me->GetMotionMaster()->MovePoint(0, tankRendPos);
                }
                else
                {
                    actionDelay = 0;
                }
                break;
            }
            case ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_DPSGythMove:
            {
                if (me->GetDistance(dpsGythPos) > 3.0f)
                {
                    me->GetMotionMaster()->MovePoint(0, dpsGythPos);
                }
                else
                {
                    actionDelay = 0;
                }
                break;
            }
            case ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_TankDrakkisathMove1:
            {
                if (me->GetDistance(tankDrakkisathPos1) > 1.0f)
                {
                    me->GetMotionMaster()->MovePoint(0, tankDrakkisathPos1);
                }
                else
                {
                    actionDelay = 0;
                }
                break;
            }
            case ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_TankDrakkisathMove2:
            {
                if (me->GetDistance(tankDrakkisathPos2) > 1.0f)
                {
                    me->GetMotionMaster()->MovePoint(0, tankDrakkisathPos2);
                }
                else
                {
                    actionDelay = 0;
                }
                break;
            }
            case ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_TankDrakkisathAddsMove:
            {
                if (me->GetDistance(tankDrakkisathAddsPos) > 1.0f)
                {
                    me->GetMotionMaster()->MovePoint(0, tankDrakkisathAddsPos);
                }
                else
                {
                    actionDelay = 0;
                }
                break;
            }
            case ActionType_Blackrock_Spire::ActionType_Blackrock_Spire_DPSDrakkisathMove:
            {
                if (me->GetDistance(dpsDrakkisathPos) > 3.0f)
                {
                    me->GetMotionMaster()->MovePoint(0, dpsDrakkisathPos);
                }
                else
                {
                    actionDelay = 0;
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return;
        }
        bool groupInCombat = GroupInCombat();
        if (groupInCombat)
        {
            restDelay = 0;
            combatTime += pmDiff;
        }
        else
        {
            combatTime = 0;
        }
        if (engageDelay > 0)
        {
            engageDelay -= pmDiff;
            switch (me->groupRole)
            {
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_DPS:
            {
                if (sb->DPS(engageTarget, Chasing(), false, NULL))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer1:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer2:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank1:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank2:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank3:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return;
        }
        if (groupInCombat)
        {
            switch (me->groupRole)
            {
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_DPS:
            {
                if (DPS())
                {
                    return;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer1:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer2:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank1:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank2:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank3:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            default:
            {
                break;
            }
            }
        }
        else
        {
            if (restDelay > 0)
            {
                restDelay -= pmDiff;
                return;
            }
            switch (me->groupRole)
            {
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_DPS:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer1:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Healer2:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank1:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank2:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_Blackrock_Spire::GroupRole_Blackrock_Spire_Tank3:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            default:
            {
                break;
            }
            }
        }
        Follow();
    }
    else
    {
        me->rai->GetActiveStrategy()->sb->Reset();
        me->rai->activeStrategyIndex = Strategy_Index::Strategy_Index_Solo;
        return;
    }
}

bool RobotStrategy_Group_Alcaz_Island::DPS()
{
    if (!me)
    {
        return false;
    }
    if (combatTime > dpsDelay)
    {
        for (Unit::AttackerSet::const_iterator attackerIT = me->getAttackers().begin(); attackerIT != me->getAttackers().end(); ++attackerIT)
        {
            if (Unit* eachAttacker = *attackerIT)
            {
                if (eachAttacker->GetEntry() == CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Doctor_Weavil)
                {
                    if (sb->DPS(eachAttacker, Chasing(), false, NULL))
                    {
                        return true;
                    }
                }
            }
        }
        if (Pet* memberPet = me->GetPet())
        {
            if (memberPet->IsAlive())
            {
                for (Unit::AttackerSet::const_iterator attackerIT = memberPet->getAttackers().begin(); attackerIT != memberPet->getAttackers().end(); ++attackerIT)
                {
                    if (Unit* eachAttacker = *attackerIT)
                    {
                        if (eachAttacker->GetEntry() == CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Doctor_Weavil)
                        {
                            if (sb->DPS(eachAttacker, Chasing(), false, NULL))
                            {
                                return true;
                            }
                        }
                    }
                }
            }
        }
    }

    return RobotStrategy_Group::DPS();
}

bool RobotStrategy_Group_Alcaz_Island::Tank()
{
    if (!me)
    {
        return false;
    }
    for (Unit::AttackerSet::const_iterator attackerIT = me->getAttackers().begin(); attackerIT != me->getAttackers().end(); ++attackerIT)
    {
        if (Unit* eachAttacker = *attackerIT)
        {
            if (eachAttacker->GetEntry() == CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Doctor_Weavil)
            {
                if (sb->Tank(eachAttacker, Chasing(), true))
                {
                    return true;
                }
            }
        }
    }
    if (Pet* memberPet = me->GetPet())
    {
        if (memberPet->IsAlive())
        {
            for (Unit::AttackerSet::const_iterator attackerIT = memberPet->getAttackers().begin(); attackerIT != memberPet->getAttackers().end(); ++attackerIT)
            {
                if (Unit* eachAttacker = *attackerIT)
                {
                    if (eachAttacker->GetEntry() == CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Doctor_Weavil)
                    {
                        if (sb->Tank(eachAttacker, Chasing(), true))
                        {
                            return true;
                        }
                    }
                }
            }
        }
    }

    return RobotStrategy_Group::Tank();
}

void RobotStrategy_Group_EmeraldDragon::InitialStrategy()
{
    engageAngle = 0.0f;
    engageDistance = 0.0f;
    shadeCombatTime = 0;
    RobotStrategy_Group::InitialStrategy();
}

std::string RobotStrategy_Group_EmeraldDragon::GetGroupRoleName()
{
    if (!me)
    {
        return "";
    }
    switch (me->groupRole)
    {
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
    {
        return "tank1";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
    {
        return "tank2";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
    {
        return "tank3";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
    {
        return "tank4";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
    {
        return "tank5";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
    {
        return "healer1";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
    {
        return "healer2";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
    {
        return "healer3";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
    {
        return "healer4";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
    {
        return "healer5";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
    {
        return "healer6";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
    {
        return "healer7";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
    {
        return "healer8";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range:
    {
        return "dpsr";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee:
    {
        return "dpsm";
    }
    default:
    {
        break;
    }
    }
    return "dps";
}

void RobotStrategy_Group_EmeraldDragon::SetGroupRole(std::string pmRoleName)
{
    if (!me)
    {
        return;
    }
    else if (pmRoleName == "tank1")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1;
    }
    else if (pmRoleName == "tank2")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2;
    }
    else if (pmRoleName == "tank3")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3;
    }
    else if (pmRoleName == "tank4")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4;
    }
    else if (pmRoleName == "tank5")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5;
    }
    else if (pmRoleName == "healer1")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1;
    }
    else if (pmRoleName == "healer2")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2;
    }
    else if (pmRoleName == "healer3")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3;
    }
    else if (pmRoleName == "healer4")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4;
    }
    else if (pmRoleName == "healer5")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5;
    }
    else if (pmRoleName == "healer6")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6;
    }
    else if (pmRoleName == "healer7")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7;
    }
    else if (pmRoleName == "healer8")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8;
    }
    else if (pmRoleName == "dpsm")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee;
    }
    else if (pmRoleName == "dpsr")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range;
    }
    else
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range;
    }
}

bool RobotStrategy_Group_EmeraldDragon::Stay(std::string pmTargetGroupRole)
{
    if (!me)
    {
        return false;
    }
    bool todo = true;
    if (pmTargetGroupRole == "dps")
    {
        if (me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "healer")
    {
        if (me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "tank")
    {
        if (me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5)
        {
            todo = false;
        }
    }
    if (todo)
    {
        me->StopMoving();
        me->GetMotionMaster()->Clear();
        me->AttackStop();
        me->InterruptSpell(CURRENT_AUTOREPEAT_SPELL);
        sb->PetStop();
        staying = true;
        return true;
    }
    return false;
}

bool RobotStrategy_Group_EmeraldDragon::Hold(std::string pmTargetGroupRole)
{
    if (!me)
    {
        return false;
    }
    bool todo = true;
    if (pmTargetGroupRole == "dps")
    {
        if (me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "healer")
    {
        if (me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "tank")
    {
        if (me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5)
        {
            todo = false;
        }
    }
    if (todo)
    {
        holding = true;
        staying = false;
        return true;
    }
    return false;
}

bool RobotStrategy_Group_EmeraldDragon::Engage(Unit* pmTarget)
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    switch (me->groupRole)
    {
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
    {
        return sb->Tank(pmTarget, Chasing());
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
    {
        return Tank();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
    {
        return Heal();
    }
    default:
    {
        return DPS();
    }
    }

    return false;
}

bool RobotStrategy_Group_EmeraldDragon::Follow()
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    if (holding)
    {
        return false;
    }
    if (!following)
    {
        return false;
    }
    if (Group* myGroup = me->GetGroup())
    {
        if (Player* leader = ObjectAccessor::FindConnectedPlayer(myGroup->GetLeaderGUID()))
        {
            return sb->Follow(leader, followDistance);
        }
    }
    return false;
}

void RobotStrategy_Group_EmeraldDragon::Update(uint32 pmDiff)
{
    if (!Update0(pmDiff))
    {
        return;
    }
    if (Group* myGroup = me->GetGroup())
    {
        if (actionDelay > 0)
        {
            actionDelay -= pmDiff;
            switch (actionType)
            {
            case ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove:
            {
                if (me->GetExactDist(markPos) < 0.5f)
                {
                    actionDelay = 0;
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return;
        }
        bool groupInCombat = GroupInCombat();
        if (groupInCombat)
        {
            restDelay = 0;
            combatTime += pmDiff;
            if (GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar).size() > 0)
            {
                shadeCombatTime += pmDiff;
            }
            else
            {
                shadeCombatTime = 0;
            }
        }
        else
        {
            combatTime = 0;
        }
        if (engageDelay > 0)
        {
            engageDelay -= pmDiff;
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range:
            {
                if (sb->DPS(engageTarget, Chasing(), false, NULL))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee:
            {
                if (sb->DPS(engageTarget, Chasing(), false, NULL))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return;
        }
        if (groupInCombat)
        {
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range:
            {
                if (DPS())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee:
            {
                if (DPS())
                {
                    return;
                }
                break;
            }
            default:
            {
                break;
            }
            }
        }
        else
        {
            if (restDelay > 0)
            {
                restDelay -= pmDiff;
                return;
            }
            switch (me->groupRole)
            {

            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            default:
            {
                break;
            }
            }
        }
        Follow();
    }
    else
    {
        me->rai->GetActiveStrategy()->sb->Reset();
        me->rai->activeStrategyIndex = Strategy_Index::Strategy_Index_Solo;
        return;
    }
}

bool RobotStrategy_Group_EmeraldDragon::DPS()
{
    if (!me->IsAlive())
    {
        return true;
    }
    if (me->HasAura(24778))
    {
        return true;
    }
    if (Group* myGroup = me->GetGroup())
    {
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Lethon))
        {
            bool bossPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                bool myPositionValid = false;
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                float myBossDistance = me->GetExactDist(boss->GetPosition());
                float engageDistanceMin = 13.0f;
                float engageDistanceMax = 15.0f;
                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                {
                    engageDistanceMin = 28.0f;
                    engageDistanceMax = 49.0f;
                    if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                else
                {
                    if (AngleInRange(myBossAngle, engageAngle, ANGLE_RANGE))
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                if (!myPositionValid)
                {
                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                    actionDelay = 3000;
                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                    return true;
                }
            }
            if (combatTime > dpsDelay)
            {
                bool attackSS = false;
                if (attackSS)
                {
                    std::list<Creature*> spiritShades;
                    me->GetCreatureListWithEntryInGrid(spiritShades, CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Spirit_Shade, VISIBILITY_DISTANCE_NORMAL);
                    if (spiritShades.size() > 0)
                    {
                        bool chaseDPS = true;
                        float distanceLimit = VISIBILITY_DISTANCE_NORMAL;
                        if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                        {
                            chaseDPS = false;
                            distanceLimit = 30.0f;
                        }
                        if (myGroup->groupTargetArrangementMap.find(me->GetGUID()) != myGroup->groupTargetArrangementMap.end())
                        {
                            ObjectGuid mySpiritShadeGUID = myGroup->groupTargetArrangementMap[me->GetGUID()];
                            if (Unit* mySpiritShade = ObjectAccessor::GetUnit(*me, mySpiritShadeGUID))
                            {
                                if (mySpiritShade->IsAlive())
                                {
                                    if (me->GetDistance(mySpiritShade) < distanceLimit)
                                    {
                                        if (sb->DPS(mySpiritShade, chaseDPS, false, NULL))
                                        {
                                            return true;
                                        }
                                    }
                                }
                            }
                        }
                        for (Creature* eachSS : spiritShades)
                        {
                            if (eachSS->IsAlive())
                            {
                                if (me->GetDistance(eachSS) < distanceLimit)
                                {
                                    bool arranged = false;
                                    for (std::unordered_map<ObjectGuid, ObjectGuid>::iterator arrangedIT = myGroup->groupTargetArrangementMap.begin(); arrangedIT != myGroup->groupTargetArrangementMap.end(); arrangedIT++)
                                    {
                                        if (eachSS->GetGUID() == arrangedIT->second)
                                        {
                                            arranged = true;
                                            break;
                                        }
                                    }
                                    if (!arranged)
                                    {
                                        myGroup->groupTargetArrangementMap[me->GetGUID()] = eachSS->GetGUID();
                                        return true;
                                    }
                                }
                            }
                        }
                        for (Creature* eachSS : spiritShades)
                        {
                            if (eachSS->IsAlive())
                            {
                                if (me->GetDistance(eachSS) < distanceLimit)
                                {
                                    if (sb->DPS(eachSS, chaseDPS, false, NULL))
                                    {
                                        return true;
                                    }
                                }
                            }
                        }
                    }
                    else
                    {
                        myGroup->groupTargetArrangementMap.clear();
                    }
                }
                sb->DPS(boss, false, false, NULL);
            }
            return true;
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Ysondre))
        {
            bool bossPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                bool myPositionValid = false;
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                float myBossDistance = me->GetExactDist(boss->GetPosition());
                float engageDistanceMin = 13.0f;
                float engageDistanceMax = 15.0f;
                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                {
                    engageDistanceMin = 28.0f;
                    engageDistanceMax = 49.0f;
                    if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                else
                {
                    if (AngleInRange(myBossAngle, engageAngle, ANGLE_RANGE))
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                if (!myPositionValid)
                {
                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                    actionDelay = 3000;
                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                    return true;
                }
            }
            if (combatTime > dpsDelay)
            {
                std::unordered_map<ObjectGuid, Unit*> dementedDruidMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Demented_Druid);
                if (dementedDruidMap.size() > 0)
                {
                    bool chaseDPS = true;
                    float distanceLimit = VISIBILITY_DISTANCE_NORMAL;
                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                    {
                        chaseDPS = false;
                        distanceLimit = 30.0f;
                    }
                    if (myGroup->groupTargetArrangementMap.find(me->GetGUID()) != myGroup->groupTargetArrangementMap.end())
                    {
                        ObjectGuid myDruidGUID = myGroup->groupTargetArrangementMap[me->GetGUID()];
                        if (Unit* myDruid = ObjectAccessor::GetUnit(*me, myDruidGUID))
                        {
                            if (myDruid->IsAlive())
                            {
                                if (me->GetExactDist(myDruid->GetPosition()) < distanceLimit)
                                {
                                    if (sb->DPS(myDruid, chaseDPS, false, NULL))
                                    {
                                        return true;
                                    }
                                }
                            }
                        }
                    }
                    for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                    {
                        if (Unit* eachDD = ddIT->second)
                        {
                            if (me->GetExactDist(eachDD->GetPosition()) < distanceLimit)
                            {
                                bool arranged = false;
                                for (std::unordered_map<ObjectGuid, ObjectGuid>::iterator arrangedIT = myGroup->groupTargetArrangementMap.begin(); arrangedIT != myGroup->groupTargetArrangementMap.end(); arrangedIT++)
                                {
                                    if (eachDD->GetGUID() == arrangedIT->second)
                                    {
                                        arranged = true;
                                        break;
                                    }
                                }
                                if (!arranged)
                                {
                                    myGroup->groupTargetArrangementMap[me->GetGUID()] = eachDD->GetGUID();
                                    return true;
                                }
                            }
                        }
                    }
                    for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                    {
                        if (Unit* eachDD = ddIT->second)
                        {
                            if (me->GetExactDist(eachDD->GetPosition()) < distanceLimit)
                            {
                                if (sb->DPS(eachDD, chaseDPS, false, NULL))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                }
                else
                {
                    myGroup->groupTargetArrangementMap.clear();
                }
                sb->DPS(boss, false, false, NULL);
            }
            return true;
        }
        std::unordered_map<ObjectGuid, Unit*> shadeOfTaerarMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar);
        if (shadeOfTaerarMap.size() > 0)
        {
            if (Creature* boss = me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Taerar))
            {
                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee)
                {
                    Position otherSidePos = GetNearPoint(boss->GetPosition(), engageDistance, basePos.GetOrientation() + M_PI * 3 / 2);
                    if (me->GetExactDist(otherSidePos) > 1.0f)
                    {
                        actionDelay = 3000;
                        markPos = otherSidePos;
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                    }
                    return true;
                }
                bool chaseDPS = true;
                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                {
                    chaseDPS = false;
                }
                if (shadeCombatTime > 10000)
                {
                    if (Unit* shade5 = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(5)))
                    {
                        if (shade5->IsAlive())
                        {
                            if (me->GetDistance(shade5) < RANGED_MAX_DISTANCE)
                            {
                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                {
                                    if (tank3->IsAlive())
                                    {
                                        if (!tank3->HasAura(24778))
                                        {
                                            if (shade5->GetTarget() == tank3->GetGUID())
                                            {
                                                if (sb->DPS(shade5, chaseDPS, false, NULL))
                                                {
                                                    return true;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if (Unit* shade6 = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(6)))
                    {
                        if (shade6->IsAlive())
                        {
                            if (me->GetDistance(shade6) < RANGED_MAX_DISTANCE)
                            {
                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                {
                                    if (tank4->IsAlive())
                                    {
                                        if (!tank4->HasAura(24778))
                                        {
                                            if (shade6->GetTarget() == tank4->GetGUID())
                                            {
                                                if (sb->DPS(shade6, chaseDPS, false, NULL))
                                                {
                                                    return true;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if (Unit* shade7 = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(7)))
                    {
                        if (shade7->IsAlive())
                        {
                            if (me->GetDistance(shade7) < RANGED_MAX_DISTANCE)
                            {
                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                {
                                    if (tank5->IsAlive())
                                    {
                                        if (!tank5->HasAura(24778))
                                        {
                                            if (shade7->GetTarget() == tank5->GetGUID())
                                            {
                                                if (sb->DPS(shade7, chaseDPS, false, NULL))
                                                {
                                                    return true;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if (Unit* shade5 = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(5)))
                    {
                        if (shade5->IsAlive())
                        {
                            if (me->GetDistance(shade5) < RANGED_MAX_DISTANCE)
                            {
                                if (sb->DPS(shade5, chaseDPS, false, NULL))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                    if (Unit* shade6 = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(6)))
                    {
                        if (shade6->IsAlive())
                        {
                            if (me->GetDistance(shade6) < RANGED_MAX_DISTANCE)
                            {
                                if (sb->DPS(shade6, chaseDPS, false, NULL))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                    if (Unit* shade7 = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(7)))
                    {
                        if (shade7->IsAlive())
                        {
                            if (me->GetDistance(shade7) < RANGED_MAX_DISTANCE)
                            {
                                if (sb->DPS(shade7, chaseDPS, false, NULL))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                }
                return true;
            }
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Taerar))
        {
            bool bossPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                bool myPositionValid = false;
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                float myBossDistance = me->GetExactDist(boss->GetPosition());
                float engageDistanceMin = 13.0f;
                float engageDistanceMax = 15.0f;
                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                {
                    engageDistanceMin = 28.0f;
                    engageDistanceMax = 49.0f;
                    if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                else
                {
                    if (AngleInRange(myBossAngle, engageAngle, ANGLE_RANGE))
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                if (!myPositionValid)
                {
                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                    actionDelay = 3000;
                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                    return true;
                }
            }
            if (combatTime > dpsDelay)
            {
                std::unordered_map<ObjectGuid, Unit*> dementedDruidMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Demented_Druid);
                if (dementedDruidMap.size() > 0)
                {
                    bool chaseDPS = true;
                    float distanceLimit = VISIBILITY_DISTANCE_NORMAL;
                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                    {
                        chaseDPS = false;
                        distanceLimit = 30.0f;
                    }
                    if (myGroup->groupTargetArrangementMap.find(me->GetGUID()) != myGroup->groupTargetArrangementMap.end())
                    {
                        ObjectGuid myDruidGUID = myGroup->groupTargetArrangementMap[me->GetGUID()];
                        if (Unit* myDruid = ObjectAccessor::GetUnit(*me, myDruidGUID))
                        {
                            if (myDruid->IsAlive())
                            {
                                if (me->GetDistance(myDruid) < distanceLimit)
                                {
                                    if (sb->DPS(myDruid, chaseDPS, false, NULL))
                                    {
                                        return true;
                                    }
                                }
                            }
                        }
                    }
                    for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                    {
                        if (Unit* eachDD = ddIT->second)
                        {
                            if (me->GetDistance(eachDD) < distanceLimit)
                            {
                                bool arranged = false;
                                for (std::unordered_map<ObjectGuid, ObjectGuid>::iterator arrangedIT = myGroup->groupTargetArrangementMap.begin(); arrangedIT != myGroup->groupTargetArrangementMap.end(); arrangedIT++)
                                {
                                    if (eachDD->GetGUID() == arrangedIT->second)
                                    {
                                        arranged = true;
                                        break;
                                    }
                                }
                                if (!arranged)
                                {
                                    myGroup->groupTargetArrangementMap[me->GetGUID()] = eachDD->GetGUID();
                                    return true;
                                }
                            }
                        }
                    }
                    for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                    {
                        if (Unit* eachDD = ddIT->second)
                        {
                            if (me->GetDistance(eachDD) < distanceLimit)
                            {
                                if (sb->DPS(eachDD, chaseDPS, false, NULL))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                }
                else
                {
                    myGroup->groupTargetArrangementMap.clear();
                }
                sb->DPS(boss, false, false, NULL);
            }
            return true;
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Emeriss))
        {
            bool bossPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                bool myPositionValid = false;
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                float myBossDistance = me->GetExactDist(boss->GetPosition());
                float engageDistanceMin = 13.0f;
                float engageDistanceMax = 15.0f;
                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                {
                    engageDistanceMin = 28.0f;
                    engageDistanceMax = 49.0f;
                    if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                else
                {
                    if (AngleInRange(myBossAngle, engageAngle, ANGLE_RANGE))
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                if (!myPositionValid)
                {
                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                    actionDelay = 3000;
                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                    return true;
                }
            }
            if (combatTime > dpsDelay)
            {
                bool doDPS = false;
                if (me->GetHealthPct() > 90.0f)
                {
                    doDPS = true;
                }
                else if (boss->GetHealthPct() < 25.0f)
                {
                    doDPS = true;
                }
                if (doDPS)
                {
                    sb->DPS(boss, false, false, NULL);
                }
            }
            return true;
        }
    }

    return RobotStrategy_Group::DPS();
}

bool RobotStrategy_Group_EmeraldDragon::Tank()
{
    if (Group* myGroup = me->GetGroup())
    {
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Lethon))
        {
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation());
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                        {
                            if (tank2->IsAlive())
                            {
                                if (!tank2->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank2->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation() + M_PI);
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                        {
                            if (tank1->IsAlive())
                            {
                                if (!tank1->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank1->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (me->IsAlive())
                {
                    if (boss->GetTarget() != me->GetGUID())
                    {
                        bool bossPositionValid = false;
                        if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        if (bossPositionValid)
                        {
                            bool myPositionValid = false;
                            float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                            if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                            {
                                float myBossDistance = me->GetExactDist(boss->GetPosition());
                                if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                {
                                    myPositionValid = true;
                                }
                            }
                            if (!myPositionValid)
                            {
                                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                {
                                    engageDistance = frand(37.0f, 43.0f);
                                }
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        sb->DPS(boss, false, false, NULL);
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (me->IsAlive())
                {
                    if (boss->GetTarget() != me->GetGUID())
                    {
                        bool bossPositionValid = false;
                        if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        if (bossPositionValid)
                        {
                            bool myPositionValid = false;
                            float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                            if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                            {
                                float myBossDistance = me->GetExactDist(boss->GetPosition());
                                if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                {
                                    myPositionValid = true;
                                }
                            }
                            if (!myPositionValid)
                            {
                                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                {
                                    engageDistance = frand(37.0f, 43.0f);
                                }
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        sb->DPS(boss, false, false, NULL);
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (me->IsAlive())
                {
                    if (boss->GetTarget() != me->GetGUID())
                    {
                        bool bossPositionValid = false;
                        if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        if (bossPositionValid)
                        {
                            bool myPositionValid = false;
                            float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                            if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                            {
                                float myBossDistance = me->GetExactDist(boss->GetPosition());
                                if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                {
                                    myPositionValid = true;
                                }
                            }
                            if (!myPositionValid)
                            {
                                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                {
                                    engageDistance = frand(37.0f, 43.0f);
                                }
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        sb->DPS(boss, false, false, NULL);
                    }
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return true;
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Ysondre))
        {
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation());
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                        {
                            if (tank2->IsAlive())
                            {
                                if (!tank2->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank2->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation() + M_PI);
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                        {
                            if (tank1->IsAlive())
                            {
                                if (!tank1->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank1->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (me->IsAlive())
                {
                    std::unordered_map<ObjectGuid, Unit*> dementedDruidMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Demented_Druid);
                    if (dementedDruidMap.size() > 0)
                    {
                        if (dementedDruidMap.find(me->GetTarget()) != dementedDruidMap.end())
                        {
                            if (Unit* myDruid = me->GetSelectedUnit())
                            {
                                if (myDruid->GetTarget() != me->GetGUID())
                                {
                                    sb->Taunt(me->GetSelectedUnit());
                                    if (sb->Tank(me->GetSelectedUnit(), true))
                                    {
                                        return true;
                                    }
                                }
                            }
                        }
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                        {
                            if (Unit* eachDD = ddIT->second)
                            {
                                if (Player* ddTarget = ObjectAccessor::GetPlayer(*me, eachDD->GetTarget()))
                                {
                                    if (ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8)
                                    {
                                        sb->Taunt(eachDD);
                                        if (sb->Tank(eachDD, true))
                                        {
                                            return true;
                                        }
                                    }
                                }
                            }
                        }
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                        {
                            if (Unit* eachDD = ddIT->second)
                            {
                                sb->Taunt(eachDD);
                                if (sb->Tank(eachDD, true))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                    bool bossPositionValid = false;
                    if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    if (bossPositionValid)
                    {
                        Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(sidePos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = sidePos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (me->IsAlive())
                {
                    std::unordered_map<ObjectGuid, Unit*> dementedDruidMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Demented_Druid);
                    if (dementedDruidMap.size() > 0)
                    {
                        if (dementedDruidMap.find(me->GetTarget()) != dementedDruidMap.end())
                        {
                            if (Unit* myDruid = me->GetSelectedUnit())
                            {
                                if (myDruid->GetTarget() != me->GetGUID())
                                {
                                    sb->Taunt(me->GetSelectedUnit());
                                    if (sb->Tank(me->GetSelectedUnit(), true))
                                    {
                                        return true;
                                    }
                                }
                            }
                        }
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                        {
                            if (Unit* eachDD = ddIT->second)
                            {
                                if (Player* ddTarget = ObjectAccessor::GetPlayer(*me, eachDD->GetTarget()))
                                {
                                    if (ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8)
                                    {
                                        sb->Taunt(eachDD);
                                        if (sb->Tank(eachDD, true))
                                        {
                                            return true;
                                        }
                                    }
                                }
                            }
                        }
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                        {
                            if (Unit* eachDD = ddIT->second)
                            {
                                sb->Taunt(eachDD);
                                if (sb->Tank(eachDD, true))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                    bool bossPositionValid = false;
                    if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    if (bossPositionValid)
                    {
                        Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(sidePos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = sidePos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (me->IsAlive())
                {
                    std::unordered_map<ObjectGuid, Unit*> dementedDruidMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Demented_Druid);
                    if (dementedDruidMap.size() > 0)
                    {
                        if (dementedDruidMap.find(me->GetTarget()) != dementedDruidMap.end())
                        {
                            if (Unit* myDruid = me->GetSelectedUnit())
                            {
                                if (myDruid->GetTarget() != me->GetGUID())
                                {
                                    sb->Taunt(me->GetSelectedUnit());
                                    if (sb->Tank(me->GetSelectedUnit(), true))
                                    {
                                        return true;
                                    }
                                }
                            }
                        }
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                        {
                            if (Unit* eachDD = ddIT->second)
                            {
                                if (Player* ddTarget = ObjectAccessor::GetPlayer(*me, eachDD->GetTarget()))
                                {
                                    if (ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8)
                                    {
                                        sb->Taunt(eachDD);
                                        if (sb->Tank(eachDD, true))
                                        {
                                            return true;
                                        }
                                    }
                                }
                            }
                        }
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                        {
                            if (Unit* eachDD = ddIT->second)
                            {
                                sb->Taunt(eachDD);
                                if (sb->Tank(eachDD, true))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                    bool bossPositionValid = false;
                    if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    if (bossPositionValid)
                    {
                        Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(sidePos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = sidePos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        }
                    }
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return true;
        }
        std::unordered_map<ObjectGuid, Unit*> shadeOfTaerarMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar);
        if (shadeOfTaerarMap.size() > 0)
        {
            if (Creature* boss = me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Taerar))
            {
                if (Unit* firstShade = shadeOfTaerarMap.begin()->second)
                {
                    int targetIcon = myGroup->GetTargetIconByOG(firstShade->GetGUID());
                    if (targetIcon < 5 || targetIcon > 7)
                    {
                        int checkTargetIcon = 5;
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator shadeIT = shadeOfTaerarMap.begin(); shadeIT != shadeOfTaerarMap.end(); shadeIT++)
                        {
                            if (Unit* eachShade = shadeIT->second)
                            {
                                myGroup->SetTargetIcon(checkTargetIcon, me->GetGUID(), eachShade->GetGUID());
                                checkTargetIcon++;
                            }
                        }
                    }
                }
                switch (me->groupRole)
                {
                case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
                {
                    if (me->IsAlive())
                    {
                        Position frontPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(frontPos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = frontPos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                            return true;
                        }
                    }
                    break;
                }
                case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
                {
                    if (me->IsAlive())
                    {
                        Position frontPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(frontPos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = frontPos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                            return true;
                        }
                    }
                    break;
                }
                case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
                {
                    if (Unit* myShade = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(5)))
                    {
                        if (myShade->GetEntry() == CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar)
                        {
                            if (myShade->IsAlive())
                            {
                                if (me->IsAlive())
                                {
                                    if (shadeCombatTime > 7000)
                                    {
                                        if (myShade->GetTarget() == me->GetGUID())
                                        {
                                            Position shadePos = boss->GetPosition();
                                            shadePos.m_positionX = boss->GetPositionX() + 15.0f * std::cos(basePos.GetOrientation() + M_PI / 2);
                                            shadePos.m_positionY = boss->GetPositionY() + 15.0f * std::sin(basePos.GetOrientation() + M_PI / 2);
                                            shadePos.m_positionZ = boss->GetPositionZ() + 10.0f;
                                            me->UpdateAllowedPositionZ(shadePos.m_positionX, shadePos.m_positionY, shadePos.m_positionZ);
                                            float shadeDistance = me->GetExactDist(shadePos);
                                            if (shadeDistance > 10.0f)
                                            {
                                                actionDelay = 1000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                markPos = shadePos;
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(myShade->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(myShade);
                                    sb->Tank(myShade, true);
                                }
                            }
                            else
                            {
                                myGroup->SetTargetIcon(5, me->GetGUID(), ObjectGuid());
                                Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                if (me->GetExactDist(sidePos) > 1.0f)
                                {
                                    actionDelay = 3000;
                                    markPos = sidePos;
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                        }
                    }
                    break;
                }
                case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
                {
                    if (Unit* myShade = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(6)))
                    {
                        if (myShade->GetEntry() == CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar)
                        {
                            if (myShade->IsAlive())
                            {
                                if (me->IsAlive())
                                {
                                    if (shadeCombatTime > 7000)
                                    {
                                        if (myShade->GetTarget() == me->GetGUID())
                                        {
                                            Position shadePos = basePos;
                                            shadePos.m_positionX = boss->GetPositionX() + 15.0f * std::cos(basePos.GetOrientation() + M_PI / 2);
                                            shadePos.m_positionY = boss->GetPositionY() + 15.0f * std::sin(basePos.GetOrientation() + M_PI / 2);
                                            shadePos.m_positionZ = boss->GetPositionZ() + 10.0f;
                                            me->UpdateAllowedPositionZ(shadePos.m_positionX, shadePos.m_positionY, shadePos.m_positionZ);
                                            float shadeDistance = me->GetExactDist(shadePos);
                                            if (shadeDistance > 10.0f)
                                            {
                                                actionDelay = 1000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                markPos = shadePos;
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(myShade->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(myShade);
                                    sb->Tank(myShade, true);
                                }
                            }
                            else
                            {
                                myGroup->SetTargetIcon(6, me->GetGUID(), ObjectGuid());
                                Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                if (me->GetExactDist(sidePos) > 1.0f)
                                {
                                    actionDelay = 3000;
                                    markPos = sidePos;
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                        }
                    }
                    break;
                }
                case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
                {
                    if (Unit* myShade = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(7)))
                    {
                        if (myShade->GetEntry() == CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar)
                        {
                            if (myShade->IsAlive())
                            {
                                if (me->IsAlive())
                                {
                                    if (shadeCombatTime > 7000)
                                    {
                                        if (myShade->GetTarget() == me->GetGUID())
                                        {
                                            Position shadePos = basePos;
                                            shadePos.m_positionX = boss->GetPositionX() + 15.0f * std::cos(basePos.GetOrientation() + M_PI / 2);
                                            shadePos.m_positionY = boss->GetPositionY() + 15.0f * std::sin(basePos.GetOrientation() + M_PI / 2);
                                            shadePos.m_positionZ = boss->GetPositionZ() + 10.0f;
                                            me->UpdateAllowedPositionZ(shadePos.m_positionX, shadePos.m_positionY, shadePos.m_positionZ);
                                            float shadeDistance = me->GetExactDist(shadePos);
                                            if (shadeDistance > 10.0f)
                                            {
                                                actionDelay = 1000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                markPos = shadePos;
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(myShade->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(myShade);
                                    sb->Tank(myShade, true);
                                }
                            }
                            else
                            {
                                myGroup->SetTargetIcon(7, me->GetGUID(), ObjectGuid());
                                Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                if (me->GetExactDist(sidePos) > 1.0f)
                                {
                                    actionDelay = 3000;
                                    markPos = sidePos;
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                        }
                    }
                    break;
                }
                default:
                {
                    break;
                }
                }
                return true;
            }
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Taerar))
        {
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation());
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                        {
                            if (tank2->IsAlive())
                            {
                                if (!tank2->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank2->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation() + M_PI);
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                        {
                            if (tank1->IsAlive())
                            {
                                if (!tank1->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank1->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (me->IsAlive())
                {
                    if (boss->GetHealthPct() < 25.0f)
                    {
                        if (sb->DPS(boss, true, false, NULL))
                        {
                            return true;
                        }
                    }
                    bool bossPositionValid = false;
                    if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    if (bossPositionValid)
                    {
                        Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(sidePos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = sidePos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                            return true;
                        }
                        if (sb->DPS(boss, false, false, NULL))
                        {
                            return true;
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (me->IsAlive())
                {
                    if (boss->GetHealthPct() < 25.0f)
                    {
                        if (sb->DPS(boss, true, false, NULL))
                        {
                            return true;
                        }
                    }
                    bool bossPositionValid = false;
                    if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    if (bossPositionValid)
                    {
                        Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(sidePos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = sidePos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                            return true;
                        }
                        if (sb->DPS(boss, false, false, NULL))
                        {
                            return true;
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (me->IsAlive())
                {
                    if (boss->GetHealthPct() < 25.0f)
                    {
                        if (sb->DPS(boss, true, false, NULL))
                        {
                            return true;
                        }
                    }
                    bool bossPositionValid = false;
                    if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    if (bossPositionValid)
                    {
                        Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(sidePos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = sidePos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                            return true;
                        }
                        if (sb->DPS(boss, false, false, NULL))
                        {
                            return true;
                        }
                    }
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return true;
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Emeriss))
        {
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation());
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                        {
                            if (tank2->IsAlive())
                            {
                                if (!tank2->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank2->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation() + M_PI);
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                        {
                            if (tank1->IsAlive())
                            {
                                if (!tank1->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank1->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (me->IsAlive())
                {
                    if (boss->GetTarget() != me->GetGUID())
                    {
                        bool bossPositionValid = false;
                        if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        if (bossPositionValid)
                        {
                            bool myPositionValid = false;
                            float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                            if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                            {
                                float myBossDistance = me->GetExactDist(boss->GetPosition());
                                if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                {
                                    myPositionValid = true;
                                }
                            }
                            if (!myPositionValid)
                            {
                                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                {
                                    engageDistance = frand(37.0f, 43.0f);
                                }
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        sb->DPS(boss, false, false, NULL);
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (me->IsAlive())
                {
                    if (boss->GetTarget() != me->GetGUID())
                    {
                        bool bossPositionValid = false;
                        if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        if (bossPositionValid)
                        {
                            bool myPositionValid = false;
                            float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                            if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                            {
                                float myBossDistance = me->GetExactDist(boss->GetPosition());
                                if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                {
                                    myPositionValid = true;
                                }
                            }
                            if (!myPositionValid)
                            {
                                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                {
                                    engageDistance = frand(37.0f, 43.0f);
                                }
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        sb->DPS(boss, false, false, NULL);
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (me->IsAlive())
                {
                    if (boss->GetTarget() != me->GetGUID())
                    {
                        bool bossPositionValid = false;
                        if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        if (bossPositionValid)
                        {
                            bool myPositionValid = false;
                            float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                            if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                            {
                                float myBossDistance = me->GetExactDist(boss->GetPosition());
                                if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                {
                                    myPositionValid = true;
                                }
                            }
                            if (!myPositionValid)
                            {
                                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                {
                                    engageDistance = frand(37.0f, 43.0f);
                                }
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        sb->DPS(boss, false, false, NULL);
                    }
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return true;
        }
    }
    return RobotStrategy_Group::Tank();
}

bool RobotStrategy_Group_EmeraldDragon::Tank(Unit* pmTarget)
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    switch (me->groupRole)
    {
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
    {
        sb->ClearTarget();
        sb->ChooseTarget(pmTarget);
        return sb->Tank(pmTarget, Chasing());
    }
    default:
    {
        break;
    }
    }

    return false;
}

bool RobotStrategy_Group_EmeraldDragon::Heal()
{
    if (Group* myGroup = me->GetGroup())
    {
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Lethon))
        {
            bool bossPositionValid = false;
            bool myPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                {
                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                    if (myBossDistance > 18.0f && myBossDistance < 42.0f)
                    {
                        myPositionValid = true;
                    }
                }
            }
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                {
                                    if (healer2->IsAlive())
                                    {
                                        if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer2->HasAura(24818))
                                            {
                                                if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                    {
                                        if (healer3->IsAlive())
                                        {
                                            if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer3->HasAura(24818))
                                                {
                                                    if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                {
                                    if (healer3->IsAlive())
                                    {
                                        if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer3->HasAura(24818))
                                            {
                                                if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                    {
                                        if (healer1->IsAlive())
                                        {
                                            if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer1->HasAura(24818))
                                                {
                                                    if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                {
                                    if (healer1->IsAlive())
                                    {
                                        if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer1->HasAura(24818))
                                            {
                                                if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                    {
                                        if (healer2->IsAlive())
                                        {
                                            if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer2->HasAura(24818))
                                                {
                                                    if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                {
                                    if (healer5->IsAlive())
                                    {
                                        if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer5->HasAura(24818))
                                            {
                                                if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                    {
                                        if (healer6->IsAlive())
                                        {
                                            if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer6->HasAura(24818))
                                                {
                                                    if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                {
                                    if (healer6->IsAlive())
                                    {
                                        if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer6->HasAura(24818))
                                            {
                                                if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                    {
                                        if (healer4->IsAlive())
                                        {
                                            if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer4->HasAura(24818))
                                                {
                                                    if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                {
                                    if (healer4->IsAlive())
                                    {
                                        if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer4->HasAura(24818))
                                            {
                                                if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                    {
                                        if (healer5->IsAlive())
                                        {
                                            if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer5->HasAura(24818))
                                                {
                                                    if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer8 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8))
                        {
                            if (healer8->IsAlive())
                            {
                                if (!healer8->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer8->HasAura(24818))
                                    {
                                        if (healer8->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer8->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer7 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7))
                        {
                            if (healer7->IsAlive())
                            {
                                if (!healer7->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer7->HasAura(24818))
                                    {
                                        if (healer7->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer7->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            default:
            {
                break;
            }
            }
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Ysondre))
        {
            bool bossPositionValid = false;
            bool myPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                {
                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                    if (myBossDistance > 18.0f && myBossDistance < 42.0f)
                    {
                        myPositionValid = true;
                    }
                }
            }
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                {
                                    if (healer2->IsAlive())
                                    {
                                        if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer2->HasAura(24818))
                                            {
                                                if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                    {
                                        if (healer3->IsAlive())
                                        {
                                            if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer3->HasAura(24818))
                                                {
                                                    if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                {
                                    if (healer3->IsAlive())
                                    {
                                        if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer3->HasAura(24818))
                                            {
                                                if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                    {
                                        if (healer1->IsAlive())
                                        {
                                            if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer1->HasAura(24818))
                                                {
                                                    if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                {
                                    if (healer1->IsAlive())
                                    {
                                        if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer1->HasAura(24818))
                                            {
                                                if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                    {
                                        if (healer2->IsAlive())
                                        {
                                            if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer2->HasAura(24818))
                                                {
                                                    if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                {
                                    if (healer5->IsAlive())
                                    {
                                        if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer5->HasAura(24818))
                                            {
                                                if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                    {
                                        if (healer6->IsAlive())
                                        {
                                            if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer6->HasAura(24818))
                                                {
                                                    if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                {
                                    if (healer6->IsAlive())
                                    {
                                        if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer6->HasAura(24818))
                                            {
                                                if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                    {
                                        if (healer4->IsAlive())
                                        {
                                            if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer4->HasAura(24818))
                                                {
                                                    if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                {
                                    if (healer4->IsAlive())
                                    {
                                        if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer4->HasAura(24818))
                                            {
                                                if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                    {
                                        if (healer5->IsAlive())
                                        {
                                            if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer5->HasAura(24818))
                                                {
                                                    if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer8 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8))
                        {
                            if (healer8->IsAlive())
                            {
                                if (!healer8->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer8->HasAura(24818))
                                    {
                                        if (healer8->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer8->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer7 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7))
                        {
                            if (healer7->IsAlive())
                            {
                                if (!healer7->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer7->HasAura(24818))
                                    {
                                        if (healer7->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer7->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            default:
            {
                break;
            }
            }
        }
        std::unordered_map<ObjectGuid, Unit*> shadeOfTaerarMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar);
        if (shadeOfTaerarMap.size() > 0)
        {
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                {
                                    if (healer2->IsAlive())
                                    {
                                        if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer2->HasAura(24818))
                                            {
                                                if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                    {
                                        if (healer3->IsAlive())
                                        {
                                            if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer3->HasAura(24818))
                                                {
                                                    if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                {
                                    if (healer3->IsAlive())
                                    {
                                        if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer3->HasAura(24818))
                                            {
                                                if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                    {
                                        if (healer1->IsAlive())
                                        {
                                            if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer1->HasAura(24818))
                                                {
                                                    if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                {
                                    if (healer1->IsAlive())
                                    {
                                        if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer1->HasAura(24818))
                                            {
                                                if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                    {
                                        if (healer2->IsAlive())
                                        {
                                            if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer2->HasAura(24818))
                                                {
                                                    if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                {
                                    if (healer5->IsAlive())
                                    {
                                        if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer5->HasAura(24818))
                                            {
                                                if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                    {
                                        if (healer6->IsAlive())
                                        {
                                            if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer6->HasAura(24818))
                                                {
                                                    if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                {
                                    if (healer6->IsAlive())
                                    {
                                        if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer6->HasAura(24818))
                                            {
                                                if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                    {
                                        if (healer4->IsAlive())
                                        {
                                            if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer4->HasAura(24818))
                                                {
                                                    if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                {
                                    if (healer4->IsAlive())
                                    {
                                        if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer4->HasAura(24818))
                                            {
                                                if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                    {
                                        if (healer5->IsAlive())
                                        {
                                            if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer5->HasAura(24818))
                                                {
                                                    if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                        {
                                            if (tank3->IsAlive())
                                            {
                                                if (tank3->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank3, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                            }
                                        }
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer8 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8))
                        {
                            if (healer8->IsAlive())
                            {
                                if (!healer8->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer8->HasAura(24818))
                                    {
                                        if (healer8->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer8->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                        {
                                            if (tank3->IsAlive())
                                            {
                                                if (tank3->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank3, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                            }
                                        }
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer7 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7))
                        {
                            if (healer7->IsAlive())
                            {
                                if (!healer7->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer7->HasAura(24818))
                                    {
                                        if (healer7->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer7->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            default:
            {
                break;
            }
            }
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Taerar))
        {
            if (me->GetClass() == Classes::CLASS_PRIEST)
            {
                if (Player* activeTank = ObjectAccessor::GetPlayer(*me, myGroup->GetOGByTargetIcon(0)))
                {
                    if (!activeTank->HasAura(6346))
                    {
                        if (sb->SpellValid(6346))
                        {
                            if (me->GetExactDist(activeTank->GetPosition()) < 30.0f)
                            {
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                if (sb->CastSpell(activeTank, "Fear Ward", 35.0f))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                }
            }
            bool bossPositionValid = false;
            bool myPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                {
                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                    if (myBossDistance > 18.0f && myBossDistance < 42.0f)
                    {
                        myPositionValid = true;
                    }
                }
            }
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                {
                                    if (healer2->IsAlive())
                                    {
                                        if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer2->HasAura(24818))
                                            {
                                                if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                    {
                                        if (healer3->IsAlive())
                                        {
                                            if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer3->HasAura(24818))
                                                {
                                                    if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                {
                                    if (healer3->IsAlive())
                                    {
                                        if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer3->HasAura(24818))
                                            {
                                                if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                    {
                                        if (healer1->IsAlive())
                                        {
                                            if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer1->HasAura(24818))
                                                {
                                                    if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                {
                                    if (healer1->IsAlive())
                                    {
                                        if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer1->HasAura(24818))
                                            {
                                                if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                    {
                                        if (healer2->IsAlive())
                                        {
                                            if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer2->HasAura(24818))
                                                {
                                                    if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                {
                                    if (healer5->IsAlive())
                                    {
                                        if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer5->HasAura(24818))
                                            {
                                                if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                    {
                                        if (healer6->IsAlive())
                                        {
                                            if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer6->HasAura(24818))
                                                {
                                                    if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                {
                                    if (healer6->IsAlive())
                                    {
                                        if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer6->HasAura(24818))
                                            {
                                                if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                    {
                                        if (healer4->IsAlive())
                                        {
                                            if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer4->HasAura(24818))
                                                {
                                                    if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                {
                                    if (healer4->IsAlive())
                                    {
                                        if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer4->HasAura(24818))
                                            {
                                                if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                    {
                                        if (healer5->IsAlive())
                                        {
                                            if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer5->HasAura(24818))
                                                {
                                                    if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 60.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                        {
                                            if (tank3->IsAlive())
                                            {
                                                if (tank3->GetHealthPct() < 90.0f)
                                                {
                                                    if (me->GetExactDist(tank3->GetPosition()) < 40.0f)
                                                    {
                                                        if (sb->Heal(tank3, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (me->GetExactDist(member->GetPosition()) < 40.0f)
                                                        {
                                                            if (sb->Heal(member, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer8 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8))
                        {
                            if (healer8->IsAlive())
                            {
                                if (!healer8->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer8->HasAura(24818))
                                    {
                                        if (healer8->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer8->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                        {
                                            if (tank3->IsAlive())
                                            {
                                                if (tank3->GetHealthPct() < 90.0f)
                                                {
                                                    if (me->GetExactDist(tank3->GetPosition()) < 40.0f)
                                                    {
                                                        if (sb->Heal(tank3, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (me->GetExactDist(member->GetPosition()) < 40.0f)
                                                        {
                                                            if (sb->Heal(member, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer7 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7))
                        {
                            if (healer7->IsAlive())
                            {
                                if (!healer7->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer7->HasAura(24818))
                                    {
                                        if (healer7->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer7->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            default:
            {
                break;
            }
            }
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Emeriss))
        {
            bool bossPositionValid = false;
            bool myPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                {
                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                    if (myBossDistance > 18.0f && myBossDistance < 42.0f)
                    {
                        myPositionValid = true;
                    }
                }
            }
            if (me->GetClass() == Classes::CLASS_PRIEST)
            {
                if (Player* activeTank = ObjectAccessor::GetPlayer(*me, myGroup->GetOGByTargetIcon(0)))
                {
                    if (activeTank->HasAura(24928))
                    {
                        if (me->GetExactDist(activeTank->GetPosition()) < 40.0f)
                        {
                            me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                            me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                            me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                            me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                            if (sb->CastSpell(activeTank, "Abolish Disease", 45.0f))
                            {
                                return true;
                            }
                        }
                    }
                }
            }
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                {
                                    if (healer2->IsAlive())
                                    {
                                        if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer2->HasAura(24818))
                                            {
                                                if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }

                                if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                {
                                    if (healer1->IsAlive())
                                    {
                                        if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer1->HasAura(24818))
                                            {
                                                if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (me->IsAlive())
                {
                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                    {
                        if (!me->HasAura(24818))
                        {
                            if (me->GetPower(Powers::POWER_MANA) > 500)
                            {
                                uint8 mySubGroup = me->GetSubGroup();
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (me->GetExactDist(member->GetPosition()) < RANGED_MAX_DISTANCE)
                                                        {
                                                            if (sb->GroupHeal(100.0f))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                return true;
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                {
                                    if (healer5->IsAlive())
                                    {
                                        if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer5->HasAura(24818))
                                            {
                                                if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                {
                                    if (healer4->IsAlive())
                                    {
                                        if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer4->HasAura(24818))
                                            {
                                                if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (me->IsAlive())
                {
                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                    {
                        if (!me->HasAura(24818))
                        {
                            if (me->GetPower(Powers::POWER_MANA) > 500)
                            {
                                uint8 mySubGroup = me->GetSubGroup();
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (me->GetExactDist(member->GetPosition()) < RANGED_MAX_DISTANCE)
                                                        {
                                                            if (sb->GroupHeal(100.0f))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                return true;
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (me->IsAlive())
                {
                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                    {
                        if (!me->HasAura(24818))
                        {
                            if (me->GetPower(Powers::POWER_MANA) > 500)
                            {
                                uint8 mySubGroup = me->GetSubGroup();
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (me->GetExactDist(member->GetPosition()) < RANGED_MAX_DISTANCE)
                                                        {
                                                            if (sb->GroupHeal(100.0f))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                return true;
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (me->IsAlive())
                {
                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                    {
                        if (!me->HasAura(24818))
                        {
                            if (me->GetPower(Powers::POWER_MANA) > 500)
                            {
                                uint8 mySubGroup = me->GetSubGroup();
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (me->GetExactDist(member->GetPosition()) < RANGED_MAX_DISTANCE)
                                                        {
                                                            if (sb->GroupHeal(100.0f))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                return true;
                            }
                        }
                    }
                }
                return true;
                break;
            }
            default:
            {
                break;
            }
            }
        }
    }

    return RobotStrategy_Group::Heal();
}

void RobotStrategy_Group_Azuregos::InitialStrategy()
{
    engageAngle = 0.0f;
    engageDistance = 0.0f;
    RobotStrategy_Group::InitialStrategy();
}

std::string RobotStrategy_Group_Azuregos::GetGroupRoleName()
{
    if (!me)
    {
        return "";
    }
    switch (me->groupRole)
    {
    case GroupRole_Azuregos::GroupRole_Azuregos_Tank:
    {
        return "tank";
    }
    case GroupRole_Azuregos::GroupRole_Azuregos_Healer1:
    {
        return "healer1";
    }
    case GroupRole_Azuregos::GroupRole_Azuregos_Healer2:
    {
        return "healer2";
    }
    case GroupRole_Azuregos::GroupRole_Azuregos_DPS:
    {
        return "dps";
    }
    default:
    {
        break;
    }
    }
    return "dps";
}

void RobotStrategy_Group_Azuregos::SetGroupRole(std::string pmRoleName)
{
    if (!me)
    {
        return;
    }
    else if (pmRoleName == "tank")
    {
        me->groupRole = GroupRole_Azuregos::GroupRole_Azuregos_Tank;
    }
    else if (pmRoleName == "healer1")
    {
        me->groupRole = GroupRole_Azuregos::GroupRole_Azuregos_Healer1;
    }
    else if (pmRoleName == "healer2")
    {
        me->groupRole = GroupRole_Azuregos::GroupRole_Azuregos_Healer2;
    }
    else if (pmRoleName == "dps")
    {
        me->groupRole = GroupRole_Azuregos::GroupRole_Azuregos_DPS;
    }
    else
    {
        me->groupRole = GroupRole_Azuregos::GroupRole_Azuregos_DPS;
    }
}

bool RobotStrategy_Group_Azuregos::Stay(std::string pmTargetGroupRole)
{
    if (!me)
    {
        return false;
    }
    bool todo = true;
    if (pmTargetGroupRole == "dps")
    {
        if (me->groupRole != GroupRole_Azuregos::GroupRole_Azuregos_DPS)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "healer")
    {
        if (me->groupRole != GroupRole_Azuregos::GroupRole_Azuregos_Healer1 && me->groupRole != GroupRole_Azuregos::GroupRole_Azuregos_Healer2)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "tank")
    {
        if (me->groupRole != GroupRole_Azuregos::GroupRole_Azuregos_Tank)
        {
            todo = false;
        }
    }
    if (todo)
    {
        me->StopMoving();
        me->GetMotionMaster()->Clear();
        me->AttackStop();
        me->InterruptSpell(CURRENT_AUTOREPEAT_SPELL);
        sb->PetStop();
        staying = true;
        return true;
    }
    return false;
}

bool RobotStrategy_Group_Azuregos::Hold(std::string pmTargetGroupRole)
{
    if (!me)
    {
        return false;
    }
    bool todo = true;
    if (pmTargetGroupRole == "dps")
    {
        if (me->groupRole != GroupRole_Azuregos::GroupRole_Azuregos_DPS)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "healer")
    {
        if (me->groupRole != GroupRole_Azuregos::GroupRole_Azuregos_Healer1 && me->groupRole != GroupRole_Azuregos::GroupRole_Azuregos_Healer2)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "tank")
    {
        if (me->groupRole != GroupRole_Azuregos::GroupRole_Azuregos_Tank)
        {
            todo = false;
        }
    }
    if (todo)
    {
        holding = true;
        staying = false;
        return true;
    }
    return false;
}

bool RobotStrategy_Group_Azuregos::Engage(Unit* pmTarget)
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    switch (me->groupRole)
    {
    case GroupRole_Azuregos::GroupRole_Azuregos_Tank:
    {
        return sb->Tank(pmTarget, Chasing());
    }
    case GroupRole_Azuregos::GroupRole_Azuregos_Healer1:
    {
        return Heal();
    }
    case GroupRole_Azuregos::GroupRole_Azuregos_Healer2:
    {
        return Heal();
    }
    case GroupRole_Azuregos::GroupRole_Azuregos_DPS:
    {
        return DPS();
    }
    default:
    {
        return DPS();
    }
    }

    return false;
}

bool RobotStrategy_Group_Azuregos::Follow()
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    if (holding)
    {
        return false;
    }
    if (!following)
    {
        return false;
    }
    if (Group* myGroup = me->GetGroup())
    {
        if (Player* leader = ObjectAccessor::FindConnectedPlayer(myGroup->GetLeaderGUID()))
        {
            return sb->Follow(leader, followDistance);
        }
    }
    return false;
}

void RobotStrategy_Group_Azuregos::Update(uint32 pmDiff)
{
    if (!Update0(pmDiff))
    {
        return;
    }
    if (me->IsAlive())
    {
        if (me->HasAura(21098))
        {
            if (!me->HasAura(11359))
            {
                if (!me->HasItemCount(9030, 1))
                {
                    me->StoreNewItemInBestSlots(9030, 20);
                }
                if (Item* pPotion = sb->GetItemInInventory(9030))
                {
                    sb->UseItem(pPotion, me);
                }
            }
        }
    }
    if (Group* myGroup = me->GetGroup())
    {
        if (actionDelay > 0)
        {
            actionDelay -= pmDiff;
            switch (actionType)
            {
            case ActionType_Azuregos::ActionType_Azuregos_MarkMove:
            {
                if (me->GetExactDist(markPos) < 0.5f)
                {
                    actionDelay = 0;
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return;
        }
        bool groupInCombat = GroupInCombat();
        if (groupInCombat)
        {
            restDelay = 0;
            combatTime += pmDiff;
        }
        else
        {
            combatTime = 0;
        }
        if (engageDelay > 0)
        {
            engageDelay -= pmDiff;
            switch (me->groupRole)
            {
            case GroupRole_Azuregos::GroupRole_Azuregos_Tank:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_Azuregos::GroupRole_Azuregos_Healer1:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_Azuregos::GroupRole_Azuregos_Healer2:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_Azuregos::GroupRole_Azuregos_DPS:
            {
                if (sb->DPS(engageTarget, Chasing(), false, NULL))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return;
        }
        if (groupInCombat)
        {
            switch (me->groupRole)
            {
            case GroupRole_Azuregos::GroupRole_Azuregos_Tank:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            case GroupRole_Azuregos::GroupRole_Azuregos_Healer1:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_Azuregos::GroupRole_Azuregos_Healer2:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_Azuregos::GroupRole_Azuregos_DPS:
            {
                if (DPS())
                {
                    return;
                }
                break;
            }
            default:
            {
                break;
            }
            }
        }
        else
        {
            if (restDelay > 0)
            {
                restDelay -= pmDiff;
                return;
            }
            switch (me->groupRole)
            {

            case GroupRole_Azuregos::GroupRole_Azuregos_Tank:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_Azuregos::GroupRole_Azuregos_Healer1:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_Azuregos::GroupRole_Azuregos_Healer2:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_Azuregos::GroupRole_Azuregos_DPS:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            default:
            {
                break;
            }
            }
        }
        Follow();
    }
    else
    {
        me->rai->GetActiveStrategy()->sb->Reset();
        me->rai->activeStrategyIndex = Strategy_Index::Strategy_Index_Solo;
        return;
    }
}

bool RobotStrategy_Group_Azuregos::DPS()
{
    if (!me->IsAlive())
    {
        return true;
    }
    if (Group* myGroup = me->GetGroup())
    {
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Azuregos))
        {
            if (boss->IsNonMeleeSpellCast(false))
            {
                if (Spell* castingSpell = boss->GetCurrentSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL))
                {
                    if (castingSpell->m_spellInfo->Id == 21097)
                    {
                        if (sb->InterruptCasting(boss))
                        {
                            me->Yell("Mana storm interrupted!", Language::LANG_UNIVERSAL);
                            return true;
                        }
                    }
                }
            }
            if (Player* tank = GetPlayerByGroupRole(GroupRole_Azuregos::GroupRole_Azuregos_Tank))
            {
                if (tank->IsAlive())
                {
                    if (boss->GetTarget() != tank->GetGUID())
                    {
                        return true;
                    }
                }
            }
            bool bossPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                bool myPositionValid = false;
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                float myBossDistance = me->GetExactDist(boss->GetPosition());
                if (AngleInRange(myBossAngle, engageAngle, M_PI / 2))
                {
                    if (myBossDistance > engageDistance - 2.0f && myBossDistance < engageDistance + 2.0f)
                    {
                        myPositionValid = true;
                    }
                }
                if (!myPositionValid)
                {
                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                    actionDelay = 3000;
                    actionType = ActionType_Azuregos::ActionType_Azuregos_MarkMove;
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                    return true;
                }
            }
            if (combatTime > dpsDelay)
            {
                if (boss->HasAura(22067))
                {
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                    me->AttackStop();
                }
                else
                {
                    if (Player* bossTarget = ObjectAccessor::GetPlayer(*me, boss->GetTarget()))
                    {
                        if (bossTarget->groupRole == GroupRole_Azuregos::GroupRole_Azuregos_Tank)
                        {
                            sb->DPS(boss, false, false, NULL, false);
                        }
                    }
                }
            }
            return true;
        }
    }

    return RobotStrategy_Group::DPS();
}

bool RobotStrategy_Group_Azuregos::Tank()
{
    if (Group* myGroup = me->GetGroup())
    {
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Azuregos))
        {
            if (me->IsAlive())
            {
                float myBossDistance = me->GetExactDist(boss->GetPosition());
                if (myBossDistance < 22.0f)
                {
                    if (boss->GetTarget() == me->GetGUID())
                    {
                        bool positionValid = true;
                        if (myBossDistance < 13.0f)
                        {
                            positionValid = false;
                        }
                        else if (!AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                        {
                            positionValid = false;
                        }
                        if (!positionValid)
                        {
                            markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation());
                            actionDelay = 3000;
                            actionType = ActionType_Azuregos::ActionType_Azuregos_MarkMove;
                            me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                            me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                            me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                            me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                            return true;
                        }
                    }
                }
                sb->Taunt(boss);
                sb->Tank(boss, false);
            }
            return true;
        }
    }
    return RobotStrategy_Group::Tank();
}

bool RobotStrategy_Group_Azuregos::Tank(Unit* pmTarget)
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    switch (me->groupRole)
    {
    case GroupRole_Azuregos::GroupRole_Azuregos_Tank:
    {
        sb->ClearTarget();
        sb->ChooseTarget(pmTarget);
        return sb->Tank(pmTarget, Chasing());
    }
    default:
    {
        break;
    }
    }

    return false;
}

bool RobotStrategy_Group_Azuregos::Heal()
{
    if (Group* myGroup = me->GetGroup())
    {
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Azuregos))
        {
            bool bossPositionValid = false;
            bool myPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                if (AngleInRange(myBossAngle, engageAngle, M_PI / 2))
                {
                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                    if (myBossDistance > 25.0f && myBossDistance < 42.0f)
                    {
                        myPositionValid = true;
                    }
                }
                if (!myPositionValid)
                {
                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                    actionDelay = 3000;
                    actionType = ActionType_Azuregos::ActionType_Azuregos_MarkMove;
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                    return true;
                }
                switch (me->groupRole)
                {
                case GroupRole_Azuregos::GroupRole_Azuregos_Healer1:
                {
                    if (Player* tank = GetPlayerByGroupRole(GroupRole_Azuregos::GroupRole_Azuregos_Tank))
                    {
                        if (tank->IsAlive())
                        {
                            if (me->IsAlive())
                            {
                                if (tank->GetHealthPct() < 90.0f)
                                {
                                    if (sb->Heal(tank, true))
                                    {
                                        return true;
                                    }
                                }
                                if (me->GetHealthPct() < 50.0f)
                                {
                                    if (sb->Heal(me, true))
                                    {
                                        return true;
                                    }
                                }
                            }
                            return true;
                        }
                    }
                    break;
                }
                case GroupRole_Azuregos::GroupRole_Azuregos_Healer2:
                {
                    for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                    {
                        if (Player* member = groupRef->GetSource())
                        {
                            if (member->IsAlive())
                            {
                                if (member->groupRole == GroupRole_Azuregos::GroupRole_Azuregos_Tank)
                                {
                                    continue;
                                }
                                if (member->GetHealthPct() < 60.0f)
                                {
                                    if (sb->Heal(member, true))
                                    {
                                        return true;
                                    }
                                }
                            }
                        }
                    }
                    break;
                }
                default:
                {
                    break;
                }
                }
            }
        }
    }

    return RobotStrategy_Group::Heal();
}

void RobotStrategy_Group_Test::InitialStrategy()
{
    engageAngle = 0.0f;
    engageDistance = 0.0f;
    shadeCombatTime = 0;
    RobotStrategy_Group::InitialStrategy();
}

std::string RobotStrategy_Group_Test::GetGroupRoleName()
{
    if (!me)
    {
        return "";
    }
    switch (me->groupRole)
    {
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
    {
        return "tank1";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
    {
        return "tank2";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
    {
        return "tank3";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
    {
        return "tank4";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
    {
        return "tank5";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
    {
        return "healer1";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
    {
        return "healer2";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
    {
        return "healer3";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
    {
        return "healer4";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
    {
        return "healer5";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
    {
        return "healer6";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
    {
        return "healer7";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
    {
        return "healer8";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range:
    {
        return "dpsr";
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee:
    {
        return "dpsm";
    }
    default:
    {
        break;
    }
    }
    return "dps";
}

void RobotStrategy_Group_Test::SetGroupRole(std::string pmRoleName)
{
    if (!me)
    {
        return;
    }
    else if (pmRoleName == "tank1")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1;
    }
    else if (pmRoleName == "tank2")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2;
    }
    else if (pmRoleName == "tank3")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3;
    }
    else if (pmRoleName == "tank4")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4;
    }
    else if (pmRoleName == "tank5")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5;
    }
    else if (pmRoleName == "healer1")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1;
    }
    else if (pmRoleName == "healer2")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2;
    }
    else if (pmRoleName == "healer3")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3;
    }
    else if (pmRoleName == "healer4")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4;
    }
    else if (pmRoleName == "healer5")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5;
    }
    else if (pmRoleName == "healer6")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6;
    }
    else if (pmRoleName == "healer7")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7;
    }
    else if (pmRoleName == "healer8")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8;
    }
    else if (pmRoleName == "dpsm")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee;
    }
    else if (pmRoleName == "dpsr")
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range;
    }
    else
    {
        me->groupRole = GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range;
    }
}

bool RobotStrategy_Group_Test::Stay(std::string pmTargetGroupRole)
{
    if (!me)
    {
        return false;
    }
    bool todo = true;
    if (pmTargetGroupRole == "dps")
    {
        if (me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "healer")
    {
        if (me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "tank")
    {
        if (me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5)
        {
            todo = false;
        }
    }
    if (todo)
    {
        me->StopMoving();
        me->GetMotionMaster()->Clear();
        me->AttackStop();
        me->InterruptSpell(CURRENT_AUTOREPEAT_SPELL);
        sb->PetStop();
        staying = true;
        return true;
    }
    return false;
}

bool RobotStrategy_Group_Test::Hold(std::string pmTargetGroupRole)
{
    if (!me)
    {
        return false;
    }
    bool todo = true;
    if (pmTargetGroupRole == "dps")
    {
        if (me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "healer")
    {
        if (me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8)
        {
            todo = false;
        }
    }
    else if (pmTargetGroupRole == "tank")
    {
        if (me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4 && me->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5)
        {
            todo = false;
        }
    }
    if (todo)
    {
        holding = true;
        staying = false;
        return true;
    }
    return false;
}

bool RobotStrategy_Group_Test::Engage(Unit* pmTarget)
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    switch (me->groupRole)
    {
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
    {
        return sb->Tank(pmTarget, Chasing());
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
    {
        return Tank();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
    {
        return Heal();
    }
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
    {
        return Heal();
    }
    default:
    {
        return DPS();
    }
    }

    return false;
}

bool RobotStrategy_Group_Test::Follow()
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    if (holding)
    {
        return false;
    }
    if (!following)
    {
        return false;
    }
    if (Group* myGroup = me->GetGroup())
    {
        if (Player* leader = ObjectAccessor::FindConnectedPlayer(myGroup->GetLeaderGUID()))
        {
            return sb->Follow(leader, followDistance);
        }
    }
    return false;
}

void RobotStrategy_Group_Test::Update(uint32 pmDiff)
{
    if (!Update0(pmDiff))
    {
        return;
    }
    if (Group* myGroup = me->GetGroup())
    {
        if (actionDelay > 0)
        {
            actionDelay -= pmDiff;
            switch (actionType)
            {
            case ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove:
            {
                if (me->GetExactDist(markPos) < 0.5f)
                {
                    actionDelay = 0;
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return;
        }
        bool groupInCombat = GroupInCombat();
        if (groupInCombat)
        {
            restDelay = 0;
            combatTime += pmDiff;
            if (GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar).size() > 0)
            {
                shadeCombatTime += pmDiff;
            }
            else
            {
                shadeCombatTime = 0;
            }
        }
        else
        {
            combatTime = 0;
        }
        if (engageDelay > 0)
        {
            engageDelay -= pmDiff;
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (sb->Tank(engageTarget, Chasing()))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range:
            {
                if (sb->DPS(engageTarget, Chasing(), false, NULL))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee:
            {
                if (sb->DPS(engageTarget, Chasing(), false, NULL))
                {
                    return;
                }
                else
                {
                    engageTarget = NULL;
                    engageDelay = 0;
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return;
        }
        if (groupInCombat)
        {
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (Tank())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (Heal())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range:
            {
                if (DPS())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee:
            {
                if (DPS())
                {
                    return;
                }
                break;
            }
            default:
            {
                break;
            }
            }
        }
        else
        {
            if (restDelay > 0)
            {
                restDelay -= pmDiff;
                return;
            }
            switch (me->groupRole)
            {

            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (Rest())
                {
                    return;
                }
                if (Heal())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee:
            {
                if (Rest())
                {
                    return;
                }
                if (Buff())
                {
                    return;
                }
                break;
            }
            default:
            {
                break;
            }
            }
        }
        Follow();
    }
    else
    {
        me->rai->GetActiveStrategy()->sb->Reset();
        me->rai->activeStrategyIndex = Strategy_Index::Strategy_Index_Solo;
        return;
    }
}

bool RobotStrategy_Group_Test::DPS()
{
    if (!me->IsAlive())
    {
        return true;
    }
    if (me->HasAura(24778))
    {
        return true;
    }
    if (Group* myGroup = me->GetGroup())
    {
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Lethon))
        {
            bool bossPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                bool myPositionValid = false;
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                float myBossDistance = me->GetExactDist(boss->GetPosition());
                float engageDistanceMin = 13.0f;
                float engageDistanceMax = 15.0f;
                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                {
                    engageDistanceMin = 28.0f;
                    engageDistanceMax = 49.0f;
                    if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                else
                {
                    if (AngleInRange(myBossAngle, engageAngle, ANGLE_RANGE))
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                if (!myPositionValid)
                {
                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                    actionDelay = 3000;
                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                    return true;
                }
            }
            if (combatTime > dpsDelay)
            {
                bool attackSS = false;
                if (attackSS)
                {
                    std::list<Creature*> spiritShades;
                    me->GetCreatureListWithEntryInGrid(spiritShades, CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Spirit_Shade, VISIBILITY_DISTANCE_NORMAL);
                    if (spiritShades.size() > 0)
                    {
                        bool chaseDPS = true;
                        float distanceLimit = VISIBILITY_DISTANCE_NORMAL;
                        if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                        {
                            chaseDPS = false;
                            distanceLimit = 30.0f;
                        }
                        if (myGroup->groupTargetArrangementMap.find(me->GetGUID()) != myGroup->groupTargetArrangementMap.end())
                        {
                            ObjectGuid mySpiritShadeGUID = myGroup->groupTargetArrangementMap[me->GetGUID()];
                            if (Unit* mySpiritShade = ObjectAccessor::GetUnit(*me, mySpiritShadeGUID))
                            {
                                if (mySpiritShade->IsAlive())
                                {
                                    if (me->GetDistance(mySpiritShade) < distanceLimit)
                                    {
                                        if (sb->DPS(mySpiritShade, chaseDPS, false, NULL))
                                        {
                                            return true;
                                        }
                                    }
                                }
                            }
                        }
                        for (Creature* eachSS : spiritShades)
                        {
                            if (eachSS->IsAlive())
                            {
                                if (me->GetDistance(eachSS) < distanceLimit)
                                {
                                    bool arranged = false;
                                    for (std::unordered_map<ObjectGuid, ObjectGuid>::iterator arrangedIT = myGroup->groupTargetArrangementMap.begin(); arrangedIT != myGroup->groupTargetArrangementMap.end(); arrangedIT++)
                                    {
                                        if (eachSS->GetGUID() == arrangedIT->second)
                                        {
                                            arranged = true;
                                            break;
                                        }
                                    }
                                    if (!arranged)
                                    {
                                        myGroup->groupTargetArrangementMap[me->GetGUID()] = eachSS->GetGUID();
                                        return true;
                                    }
                                }
                            }
                        }
                        for (Creature* eachSS : spiritShades)
                        {
                            if (eachSS->IsAlive())
                            {
                                if (me->GetDistance(eachSS) < distanceLimit)
                                {
                                    if (sb->DPS(eachSS, chaseDPS, false, NULL))
                                    {
                                        return true;
                                    }
                                }
                            }
                        }
                    }
                    else
                    {
                        myGroup->groupTargetArrangementMap.clear();
                    }
                }
                sb->DPS(boss, false, false, NULL);
            }
            return true;
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Ysondre))
        {
            bool bossPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                bool myPositionValid = false;
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                float myBossDistance = me->GetExactDist(boss->GetPosition());
                float engageDistanceMin = 13.0f;
                float engageDistanceMax = 15.0f;
                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                {
                    engageDistanceMin = 28.0f;
                    engageDistanceMax = 49.0f;
                    if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                else
                {
                    if (AngleInRange(myBossAngle, engageAngle, ANGLE_RANGE))
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                if (!myPositionValid)
                {
                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                    actionDelay = 3000;
                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                    return true;
                }
            }
            if (combatTime > dpsDelay)
            {
                std::unordered_map<ObjectGuid, Unit*> dementedDruidMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Demented_Druid);
                if (dementedDruidMap.size() > 0)
                {
                    bool chaseDPS = true;
                    float distanceLimit = VISIBILITY_DISTANCE_NORMAL;
                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                    {
                        chaseDPS = false;
                        distanceLimit = 30.0f;
                    }
                    if (myGroup->groupTargetArrangementMap.find(me->GetGUID()) != myGroup->groupTargetArrangementMap.end())
                    {
                        ObjectGuid myDruidGUID = myGroup->groupTargetArrangementMap[me->GetGUID()];
                        if (Unit* myDruid = ObjectAccessor::GetUnit(*me, myDruidGUID))
                        {
                            if (myDruid->IsAlive())
                            {
                                if (me->GetExactDist(myDruid->GetPosition()) < distanceLimit)
                                {
                                    if (sb->DPS(myDruid, chaseDPS, false, NULL))
                                    {
                                        return true;
                                    }
                                }
                            }
                        }
                    }
                    for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                    {
                        if (Unit* eachDD = ddIT->second)
                        {
                            if (me->GetExactDist(eachDD->GetPosition()) < distanceLimit)
                            {
                                bool arranged = false;
                                for (std::unordered_map<ObjectGuid, ObjectGuid>::iterator arrangedIT = myGroup->groupTargetArrangementMap.begin(); arrangedIT != myGroup->groupTargetArrangementMap.end(); arrangedIT++)
                                {
                                    if (eachDD->GetGUID() == arrangedIT->second)
                                    {
                                        arranged = true;
                                        break;
                                    }
                                }
                                if (!arranged)
                                {
                                    myGroup->groupTargetArrangementMap[me->GetGUID()] = eachDD->GetGUID();
                                    return true;
                                }
                            }
                        }
                    }
                    for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                    {
                        if (Unit* eachDD = ddIT->second)
                        {
                            if (me->GetExactDist(eachDD->GetPosition()) < distanceLimit)
                            {
                                if (sb->DPS(eachDD, chaseDPS, false, NULL))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                }
                else
                {
                    myGroup->groupTargetArrangementMap.clear();
                }
                sb->DPS(boss, false, false, NULL);
            }
            return true;
        }
        std::unordered_map<ObjectGuid, Unit*> shadeOfTaerarMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar);
        if (shadeOfTaerarMap.size() > 0)
        {
            if (Creature* boss = me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Taerar))
            {
                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Melee)
                {
                    Position otherSidePos = GetNearPoint(boss->GetPosition(), engageDistance, basePos.GetOrientation() + M_PI * 3 / 2);
                    if (me->GetExactDist(otherSidePos) > 1.0f)
                    {
                        actionDelay = 3000;
                        markPos = otherSidePos;
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                    }
                    return true;
                }
                bool chaseDPS = true;
                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                {
                    chaseDPS = false;
                }
                if (shadeCombatTime > 10000)
                {
                    if (Unit* shade5 = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(5)))
                    {
                        if (shade5->IsAlive())
                        {
                            if (me->GetDistance(shade5) < RANGED_MAX_DISTANCE)
                            {
                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                {
                                    if (tank3->IsAlive())
                                    {
                                        if (!tank3->HasAura(24778))
                                        {
                                            if (shade5->GetTarget() == tank3->GetGUID())
                                            {
                                                if (sb->DPS(shade5, chaseDPS, false, NULL))
                                                {
                                                    return true;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if (Unit* shade6 = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(6)))
                    {
                        if (shade6->IsAlive())
                        {
                            if (me->GetDistance(shade6) < RANGED_MAX_DISTANCE)
                            {
                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                {
                                    if (tank4->IsAlive())
                                    {
                                        if (!tank4->HasAura(24778))
                                        {
                                            if (shade6->GetTarget() == tank4->GetGUID())
                                            {
                                                if (sb->DPS(shade6, chaseDPS, false, NULL))
                                                {
                                                    return true;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if (Unit* shade7 = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(7)))
                    {
                        if (shade7->IsAlive())
                        {
                            if (me->GetDistance(shade7) < RANGED_MAX_DISTANCE)
                            {
                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                {
                                    if (tank5->IsAlive())
                                    {
                                        if (!tank5->HasAura(24778))
                                        {
                                            if (shade7->GetTarget() == tank5->GetGUID())
                                            {
                                                if (sb->DPS(shade7, chaseDPS, false, NULL))
                                                {
                                                    return true;
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if (Unit* shade5 = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(5)))
                    {
                        if (shade5->IsAlive())
                        {
                            if (me->GetDistance(shade5) < RANGED_MAX_DISTANCE)
                            {
                                if (sb->DPS(shade5, chaseDPS, false, NULL))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                    if (Unit* shade6 = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(6)))
                    {
                        if (shade6->IsAlive())
                        {
                            if (me->GetDistance(shade6) < RANGED_MAX_DISTANCE)
                            {
                                if (sb->DPS(shade6, chaseDPS, false, NULL))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                    if (Unit* shade7 = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(7)))
                    {
                        if (shade7->IsAlive())
                        {
                            if (me->GetDistance(shade7) < RANGED_MAX_DISTANCE)
                            {
                                if (sb->DPS(shade7, chaseDPS, false, NULL))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                }
                return true;
            }
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Taerar))
        {
            bool bossPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                bool myPositionValid = false;
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                float myBossDistance = me->GetExactDist(boss->GetPosition());
                float engageDistanceMin = 13.0f;
                float engageDistanceMax = 15.0f;
                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                {
                    engageDistanceMin = 28.0f;
                    engageDistanceMax = 49.0f;
                    if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                else
                {
                    if (AngleInRange(myBossAngle, engageAngle, ANGLE_RANGE))
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                if (!myPositionValid)
                {
                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                    actionDelay = 3000;
                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                    return true;
                }
            }
            if (combatTime > dpsDelay)
            {
                std::unordered_map<ObjectGuid, Unit*> dementedDruidMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Demented_Druid);
                if (dementedDruidMap.size() > 0)
                {
                    bool chaseDPS = true;
                    float distanceLimit = VISIBILITY_DISTANCE_NORMAL;
                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                    {
                        chaseDPS = false;
                        distanceLimit = 30.0f;
                    }
                    if (myGroup->groupTargetArrangementMap.find(me->GetGUID()) != myGroup->groupTargetArrangementMap.end())
                    {
                        ObjectGuid myDruidGUID = myGroup->groupTargetArrangementMap[me->GetGUID()];
                        if (Unit* myDruid = ObjectAccessor::GetUnit(*me, myDruidGUID))
                        {
                            if (myDruid->IsAlive())
                            {
                                if (me->GetDistance(myDruid) < distanceLimit)
                                {
                                    if (sb->DPS(myDruid, chaseDPS, false, NULL))
                                    {
                                        return true;
                                    }
                                }
                            }
                        }
                    }
                    for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                    {
                        if (Unit* eachDD = ddIT->second)
                        {
                            if (me->GetDistance(eachDD) < distanceLimit)
                            {
                                bool arranged = false;
                                for (std::unordered_map<ObjectGuid, ObjectGuid>::iterator arrangedIT = myGroup->groupTargetArrangementMap.begin(); arrangedIT != myGroup->groupTargetArrangementMap.end(); arrangedIT++)
                                {
                                    if (eachDD->GetGUID() == arrangedIT->second)
                                    {
                                        arranged = true;
                                        break;
                                    }
                                }
                                if (!arranged)
                                {
                                    myGroup->groupTargetArrangementMap[me->GetGUID()] = eachDD->GetGUID();
                                    return true;
                                }
                            }
                        }
                    }
                    for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                    {
                        if (Unit* eachDD = ddIT->second)
                        {
                            if (me->GetDistance(eachDD) < distanceLimit)
                            {
                                if (sb->DPS(eachDD, chaseDPS, false, NULL))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                }
                else
                {
                    myGroup->groupTargetArrangementMap.clear();
                }
                sb->DPS(boss, false, false, NULL);
            }
            return true;
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Emeriss))
        {
            bool bossPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                bool myPositionValid = false;
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                float myBossDistance = me->GetExactDist(boss->GetPosition());
                float engageDistanceMin = 13.0f;
                float engageDistanceMax = 15.0f;
                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                {
                    engageDistanceMin = 28.0f;
                    engageDistanceMax = 49.0f;
                    if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                else
                {
                    if (AngleInRange(myBossAngle, engageAngle, ANGLE_RANGE))
                    {
                        if (myBossDistance > engageDistanceMin && myBossDistance < engageDistanceMax)
                        {
                            myPositionValid = true;
                        }
                    }
                }
                if (!myPositionValid)
                {
                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                    actionDelay = 3000;
                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                    return true;
                }
            }
            if (combatTime > dpsDelay)
            {
                bool doDPS = false;
                if (me->GetHealthPct() > 90.0f)
                {
                    doDPS = true;
                }
                else if (boss->GetHealthPct() < 25.0f)
                {
                    doDPS = true;
                }
                if (doDPS)
                {
                    sb->DPS(boss, false, false, NULL);
                }
            }
            return true;
        }
    }

    return RobotStrategy_Group::DPS();
}

bool RobotStrategy_Group_Test::Tank()
{
    if (Group* myGroup = me->GetGroup())
    {
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Lethon))
        {
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation());
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                        {
                            if (tank2->IsAlive())
                            {
                                if (!tank2->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank2->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation() + M_PI);
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                        {
                            if (tank1->IsAlive())
                            {
                                if (!tank1->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank1->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (me->IsAlive())
                {
                    if (boss->GetTarget() != me->GetGUID())
                    {
                        bool bossPositionValid = false;
                        if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        if (bossPositionValid)
                        {
                            bool myPositionValid = false;
                            float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                            if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                            {
                                float myBossDistance = me->GetExactDist(boss->GetPosition());
                                if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                {
                                    myPositionValid = true;
                                }
                            }
                            if (!myPositionValid)
                            {
                                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                {
                                    engageDistance = frand(37.0f, 43.0f);
                                }
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        sb->DPS(boss, false, false, NULL);
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (me->IsAlive())
                {
                    if (boss->GetTarget() != me->GetGUID())
                    {
                        bool bossPositionValid = false;
                        if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        if (bossPositionValid)
                        {
                            bool myPositionValid = false;
                            float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                            if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                            {
                                float myBossDistance = me->GetExactDist(boss->GetPosition());
                                if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                {
                                    myPositionValid = true;
                                }
                            }
                            if (!myPositionValid)
                            {
                                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                {
                                    engageDistance = frand(37.0f, 43.0f);
                                }
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        sb->DPS(boss, false, false, NULL);
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (me->IsAlive())
                {
                    if (boss->GetTarget() != me->GetGUID())
                    {
                        bool bossPositionValid = false;
                        if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        if (bossPositionValid)
                        {
                            bool myPositionValid = false;
                            float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                            if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                            {
                                float myBossDistance = me->GetExactDist(boss->GetPosition());
                                if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                {
                                    myPositionValid = true;
                                }
                            }
                            if (!myPositionValid)
                            {
                                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                {
                                    engageDistance = frand(37.0f, 43.0f);
                                }
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        sb->DPS(boss, false, false, NULL);
                    }
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return true;
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Ysondre))
        {
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation());
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                        {
                            if (tank2->IsAlive())
                            {
                                if (!tank2->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank2->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation() + M_PI);
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                        {
                            if (tank1->IsAlive())
                            {
                                if (!tank1->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank1->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (me->IsAlive())
                {
                    std::unordered_map<ObjectGuid, Unit*> dementedDruidMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Demented_Druid);
                    if (dementedDruidMap.size() > 0)
                    {
                        if (dementedDruidMap.find(me->GetTarget()) != dementedDruidMap.end())
                        {
                            if (Unit* myDruid = me->GetSelectedUnit())
                            {
                                if (myDruid->GetTarget() != me->GetGUID())
                                {
                                    sb->Taunt(me->GetSelectedUnit());
                                    if (sb->Tank(me->GetSelectedUnit(), true))
                                    {
                                        return true;
                                    }
                                }
                            }
                        }
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                        {
                            if (Unit* eachDD = ddIT->second)
                            {
                                if (Player* ddTarget = ObjectAccessor::GetPlayer(*me, eachDD->GetTarget()))
                                {
                                    if (ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8)
                                    {
                                        sb->Taunt(eachDD);
                                        if (sb->Tank(eachDD, true))
                                        {
                                            return true;
                                        }
                                    }
                                }
                            }
                        }
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                        {
                            if (Unit* eachDD = ddIT->second)
                            {
                                sb->Taunt(eachDD);
                                if (sb->Tank(eachDD, true))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                    bool bossPositionValid = false;
                    if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    if (bossPositionValid)
                    {
                        Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(sidePos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = sidePos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (me->IsAlive())
                {
                    std::unordered_map<ObjectGuid, Unit*> dementedDruidMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Demented_Druid);
                    if (dementedDruidMap.size() > 0)
                    {
                        if (dementedDruidMap.find(me->GetTarget()) != dementedDruidMap.end())
                        {
                            if (Unit* myDruid = me->GetSelectedUnit())
                            {
                                if (myDruid->GetTarget() != me->GetGUID())
                                {
                                    sb->Taunt(me->GetSelectedUnit());
                                    if (sb->Tank(me->GetSelectedUnit(), true))
                                    {
                                        return true;
                                    }
                                }
                            }
                        }
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                        {
                            if (Unit* eachDD = ddIT->second)
                            {
                                if (Player* ddTarget = ObjectAccessor::GetPlayer(*me, eachDD->GetTarget()))
                                {
                                    if (ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8)
                                    {
                                        sb->Taunt(eachDD);
                                        if (sb->Tank(eachDD, true))
                                        {
                                            return true;
                                        }
                                    }
                                }
                            }
                        }
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                        {
                            if (Unit* eachDD = ddIT->second)
                            {
                                sb->Taunt(eachDD);
                                if (sb->Tank(eachDD, true))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                    bool bossPositionValid = false;
                    if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    if (bossPositionValid)
                    {
                        Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(sidePos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = sidePos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (me->IsAlive())
                {
                    std::unordered_map<ObjectGuid, Unit*> dementedDruidMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Demented_Druid);
                    if (dementedDruidMap.size() > 0)
                    {
                        if (dementedDruidMap.find(me->GetTarget()) != dementedDruidMap.end())
                        {
                            if (Unit* myDruid = me->GetSelectedUnit())
                            {
                                if (myDruid->GetTarget() != me->GetGUID())
                                {
                                    sb->Taunt(me->GetSelectedUnit());
                                    if (sb->Tank(me->GetSelectedUnit(), true))
                                    {
                                        return true;
                                    }
                                }
                            }
                        }
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                        {
                            if (Unit* eachDD = ddIT->second)
                            {
                                if (Player* ddTarget = ObjectAccessor::GetPlayer(*me, eachDD->GetTarget()))
                                {
                                    if (ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7 || ddTarget->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8)
                                    {
                                        sb->Taunt(eachDD);
                                        if (sb->Tank(eachDD, true))
                                        {
                                            return true;
                                        }
                                    }
                                }
                            }
                        }
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator ddIT = dementedDruidMap.begin(); ddIT != dementedDruidMap.end(); ddIT++)
                        {
                            if (Unit* eachDD = ddIT->second)
                            {
                                sb->Taunt(eachDD);
                                if (sb->Tank(eachDD, true))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                    bool bossPositionValid = false;
                    if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    if (bossPositionValid)
                    {
                        Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(sidePos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = sidePos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        }
                    }
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return true;
        }
        std::unordered_map<ObjectGuid, Unit*> shadeOfTaerarMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar);
        if (shadeOfTaerarMap.size() > 0)
        {
            if (Creature* boss = me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Taerar))
            {
                if (Unit* firstShade = shadeOfTaerarMap.begin()->second)
                {
                    int targetIcon = myGroup->GetTargetIconByOG(firstShade->GetGUID());
                    if (targetIcon < 5 || targetIcon > 7)
                    {
                        int checkTargetIcon = 5;
                        for (std::unordered_map<ObjectGuid, Unit*>::iterator shadeIT = shadeOfTaerarMap.begin(); shadeIT != shadeOfTaerarMap.end(); shadeIT++)
                        {
                            if (Unit* eachShade = shadeIT->second)
                            {
                                myGroup->SetTargetIcon(checkTargetIcon, me->GetGUID(), eachShade->GetGUID());
                                checkTargetIcon++;
                            }
                        }
                    }
                }
                switch (me->groupRole)
                {
                case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
                {
                    if (me->IsAlive())
                    {
                        Position frontPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(frontPos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = frontPos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                            return true;
                        }
                    }
                    break;
                }
                case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
                {
                    if (me->IsAlive())
                    {
                        Position frontPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(frontPos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = frontPos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                            return true;
                        }
                    }
                    break;
                }
                case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
                {
                    if (Unit* myShade = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(5)))
                    {
                        if (myShade->GetEntry() == CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar)
                        {
                            if (myShade->IsAlive())
                            {
                                if (me->IsAlive())
                                {
                                    if (shadeCombatTime > 7000)
                                    {
                                        if (myShade->GetTarget() == me->GetGUID())
                                        {
                                            Position shadePos = boss->GetPosition();
                                            shadePos.m_positionX = boss->GetPositionX() + 10.0f * std::cos(basePos.GetOrientation() + M_PI / 2);
                                            shadePos.m_positionY = boss->GetPositionY() + 10.0f * std::sin(basePos.GetOrientation() + M_PI / 2);
                                            shadePos.m_positionZ = boss->GetPositionZ() + 10.0f;
                                            me->UpdateAllowedPositionZ(shadePos.m_positionX, shadePos.m_positionY, shadePos.m_positionZ);
                                            float shadeDistance = me->GetExactDist(shadePos);
                                            if (shadeDistance > 10.0f)
                                            {
                                                actionDelay = 1000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                markPos = shadePos;
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(myShade->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(myShade);
                                    sb->Tank(myShade, true);
                                }
                            }
                            else
                            {
                                myGroup->SetTargetIcon(5, me->GetGUID(), ObjectGuid());
                                Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                if (me->GetExactDist(sidePos) > 1.0f)
                                {
                                    actionDelay = 3000;
                                    markPos = sidePos;
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                        }
                    }
                    break;
                }
                case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
                {
                    if (Unit* myShade = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(6)))
                    {
                        if (myShade->GetEntry() == CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar)
                        {
                            if (myShade->IsAlive())
                            {
                                if (me->IsAlive())
                                {
                                    if (shadeCombatTime > 7000)
                                    {
                                        if (myShade->GetTarget() == me->GetGUID())
                                        {
                                            Position shadePos = basePos;
                                            shadePos.m_positionX = boss->GetPositionX() + 10.0f * std::cos(basePos.GetOrientation() + M_PI / 2);
                                            shadePos.m_positionY = boss->GetPositionY() + 10.0f * std::sin(basePos.GetOrientation() + M_PI / 2);
                                            shadePos.m_positionZ = boss->GetPositionZ() + 10.0f;
                                            me->UpdateAllowedPositionZ(shadePos.m_positionX, shadePos.m_positionY, shadePos.m_positionZ);
                                            float shadeDistance = me->GetExactDist(shadePos);
                                            if (shadeDistance > 10.0f)
                                            {
                                                actionDelay = 1000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                markPos = shadePos;
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(myShade->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(myShade);
                                    sb->Tank(myShade, true);
                                }
                            }
                            else
                            {
                                myGroup->SetTargetIcon(6, me->GetGUID(), ObjectGuid());
                                Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                if (me->GetExactDist(sidePos) > 1.0f)
                                {
                                    actionDelay = 3000;
                                    markPos = sidePos;
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                        }
                    }
                    break;
                }
                case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
                {
                    if (Unit* myShade = ObjectAccessor::GetUnit(*me, myGroup->GetOGByTargetIcon(7)))
                    {
                        if (myShade->GetEntry() == CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar)
                        {
                            if (myShade->IsAlive())
                            {
                                if (me->IsAlive())
                                {
                                    if (shadeCombatTime > 7000)
                                    {
                                        if (myShade->GetTarget() == me->GetGUID())
                                        {
                                            Position shadePos = basePos;
                                            shadePos.m_positionX = boss->GetPositionX() + 10.0f * std::cos(basePos.GetOrientation() + M_PI / 2);
                                            shadePos.m_positionY = boss->GetPositionY() + 10.0f * std::sin(basePos.GetOrientation() + M_PI / 2);
                                            shadePos.m_positionZ = boss->GetPositionZ() + 10.0f;
                                            me->UpdateAllowedPositionZ(shadePos.m_positionX, shadePos.m_positionY, shadePos.m_positionZ);
                                            float shadeDistance = me->GetExactDist(shadePos);
                                            if (shadeDistance > 10.0f)
                                            {
                                                actionDelay = 1000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                markPos = shadePos;
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(myShade->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(myShade);
                                    sb->Tank(myShade, true);
                                }
                            }
                            else
                            {
                                myGroup->SetTargetIcon(7, me->GetGUID(), ObjectGuid());
                                Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                if (me->GetExactDist(sidePos) > 1.0f)
                                {
                                    actionDelay = 3000;
                                    markPos = sidePos;
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                        }
                    }
                    break;
                }
                default:
                {
                    break;
                }
                }
                return true;
            }
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Taerar))
        {
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation());
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                        {
                            if (tank2->IsAlive())
                            {
                                if (!tank2->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank2->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation() + M_PI);
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                        {
                            if (tank1->IsAlive())
                            {
                                if (!tank1->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank1->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (me->IsAlive())
                {
                    if (boss->GetHealthPct() < 25.0f)
                    {
                        if (sb->DPS(boss, true, false, NULL))
                        {
                            return true;
                        }
                    }
                    bool bossPositionValid = false;
                    if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    if (bossPositionValid)
                    {
                        Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(sidePos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = sidePos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                            return true;
                        }
                        if (sb->DPS(boss, false, false, NULL))
                        {
                            return true;
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (me->IsAlive())
                {
                    if (boss->GetHealthPct() < 25.0f)
                    {
                        if (sb->DPS(boss, true, false, NULL))
                        {
                            return true;
                        }
                    }
                    bool bossPositionValid = false;
                    if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    if (bossPositionValid)
                    {
                        Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(sidePos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = sidePos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                            return true;
                        }
                        if (sb->DPS(boss, false, false, NULL))
                        {
                            return true;
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (me->IsAlive())
                {
                    if (boss->GetHealthPct() < 25.0f)
                    {
                        if (sb->DPS(boss, true, false, NULL))
                        {
                            return true;
                        }
                    }
                    bool bossPositionValid = false;
                    if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                    {
                        bossPositionValid = true;
                    }
                    if (bossPositionValid)
                    {
                        Position sidePos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        if (me->GetExactDist(sidePos) > 1.0f)
                        {
                            actionDelay = 3000;
                            markPos = sidePos;
                            me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                            return true;
                        }
                        if (sb->DPS(boss, false, false, NULL))
                        {
                            return true;
                        }
                    }
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return true;
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Emeriss))
        {
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation());
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                        {
                            if (tank2->IsAlive())
                            {
                                if (!tank2->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank2->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2:
            {
                if (ObjectGuid activeTankOG = myGroup->GetOGByTargetIcon(0))
                {
                    if (activeTankOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->HasAura(24778))
                            {
                                if (me->GetAuraCount(24818) < 3)
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance < 22.0f)
                                    {
                                        if (boss->GetTarget() == me->GetGUID())
                                        {
                                            bool positionValid = true;
                                            if (myBossDistance < 13.0f)
                                            {
                                                positionValid = false;
                                            }
                                            else if (!AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                                            {
                                                positionValid = false;
                                            }
                                            if (!positionValid)
                                            {
                                                markPos = GetNearPoint(boss->GetPosition(), 14.0f, basePos.GetOrientation() + M_PI);
                                                actionDelay = 3000;
                                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                                return true;
                                            }
                                        }
                                    }
                                    sb->Taunt(boss);
                                    sb->Tank(boss, false);
                                    return true;
                                }
                            }
                        }
                        if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                        {
                            if (tank1->IsAlive())
                            {
                                if (!tank1->HasAura(24778))
                                {
                                    myGroup->SetTargetIcon(0, me->GetGUID(), tank1->GetGUID());
                                }
                            }
                        }
                    }
                    else
                    {
                        if (boss->GetTarget() != me->GetGUID())
                        {
                            bool bossPositionValid = false;
                            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                            {
                                bossPositionValid = true;
                            }
                            if (bossPositionValid)
                            {
                                bool myPositionValid = false;
                                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                                if (AngleInRange(engageAngle, myBossAngle, ANGLE_RANGE))
                                {
                                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                                    if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                    {
                                        myPositionValid = true;
                                    }
                                }
                                if (!myPositionValid)
                                {
                                    if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                    {
                                        engageDistance = frand(37.0f, 43.0f);
                                    }
                                    markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                    actionDelay = 3000;
                                    actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                    me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                    me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                    return true;
                                }
                            }
                            sb->SubTank(boss, false);
                        }
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3:
            {
                if (me->IsAlive())
                {
                    if (boss->GetTarget() != me->GetGUID())
                    {
                        bool bossPositionValid = false;
                        if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        if (bossPositionValid)
                        {
                            bool myPositionValid = false;
                            float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                            if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                            {
                                float myBossDistance = me->GetExactDist(boss->GetPosition());
                                if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                {
                                    myPositionValid = true;
                                }
                            }
                            if (!myPositionValid)
                            {
                                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                {
                                    engageDistance = frand(37.0f, 43.0f);
                                }
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        sb->DPS(boss, false, false, NULL);
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4:
            {
                if (me->IsAlive())
                {
                    if (boss->GetTarget() != me->GetGUID())
                    {
                        bool bossPositionValid = false;
                        if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        if (bossPositionValid)
                        {
                            bool myPositionValid = false;
                            float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                            if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                            {
                                float myBossDistance = me->GetExactDist(boss->GetPosition());
                                if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                {
                                    myPositionValid = true;
                                }
                            }
                            if (!myPositionValid)
                            {
                                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                {
                                    engageDistance = frand(37.0f, 43.0f);
                                }
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        sb->DPS(boss, false, false, NULL);
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5:
            {
                if (me->IsAlive())
                {
                    if (boss->GetTarget() != me->GetGUID())
                    {
                        bool bossPositionValid = false;
                        if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
                        {
                            bossPositionValid = true;
                        }
                        if (bossPositionValid)
                        {
                            bool myPositionValid = false;
                            float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                            if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                            {
                                float myBossDistance = me->GetExactDist(boss->GetPosition());
                                if (myBossDistance > 13.0f && myBossDistance < 15.0f)
                                {
                                    myPositionValid = true;
                                }
                            }
                            if (!myPositionValid)
                            {
                                if (me->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_DPS_Range)
                                {
                                    engageDistance = frand(37.0f, 43.0f);
                                }
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        sb->DPS(boss, false, false, NULL);
                    }
                }
                break;
            }
            default:
            {
                break;
            }
            }
            return true;
        }
    }
    return RobotStrategy_Group::Tank();
}

bool RobotStrategy_Group_Test::Tank(Unit* pmTarget)
{
    if (!me)
    {
        return false;
    }
    if (!me->IsAlive())
    {
        return false;
    }
    switch (me->groupRole)
    {
    case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1:
    {
        sb->ClearTarget();
        sb->ChooseTarget(pmTarget);
        return sb->Tank(pmTarget, Chasing());
    }
    default:
    {
        break;
    }
    }

    return false;
}

bool RobotStrategy_Group_Test::Heal()
{
    if (Group* myGroup = me->GetGroup())
    {
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Lethon))
        {
            bool bossPositionValid = false;
            bool myPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                {
                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                    if (myBossDistance > 18.0f && myBossDistance < 42.0f)
                    {
                        myPositionValid = true;
                    }
                }
            }
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                {
                                    if (healer2->IsAlive())
                                    {
                                        if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer2->HasAura(24818))
                                            {
                                                if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                    {
                                        if (healer3->IsAlive())
                                        {
                                            if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer3->HasAura(24818))
                                                {
                                                    if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                {
                                    if (healer3->IsAlive())
                                    {
                                        if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer3->HasAura(24818))
                                            {
                                                if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                    {
                                        if (healer1->IsAlive())
                                        {
                                            if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer1->HasAura(24818))
                                                {
                                                    if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                {
                                    if (healer1->IsAlive())
                                    {
                                        if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer1->HasAura(24818))
                                            {
                                                if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                    {
                                        if (healer2->IsAlive())
                                        {
                                            if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer2->HasAura(24818))
                                                {
                                                    if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                {
                                    if (healer5->IsAlive())
                                    {
                                        if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer5->HasAura(24818))
                                            {
                                                if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                    {
                                        if (healer6->IsAlive())
                                        {
                                            if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer6->HasAura(24818))
                                                {
                                                    if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                {
                                    if (healer6->IsAlive())
                                    {
                                        if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer6->HasAura(24818))
                                            {
                                                if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                    {
                                        if (healer4->IsAlive())
                                        {
                                            if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer4->HasAura(24818))
                                                {
                                                    if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                {
                                    if (healer4->IsAlive())
                                    {
                                        if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer4->HasAura(24818))
                                            {
                                                if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                    {
                                        if (healer5->IsAlive())
                                        {
                                            if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer5->HasAura(24818))
                                                {
                                                    if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer8 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8))
                        {
                            if (healer8->IsAlive())
                            {
                                if (!healer8->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer8->HasAura(24818))
                                    {
                                        if (healer8->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer8->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer7 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7))
                        {
                            if (healer7->IsAlive())
                            {
                                if (!healer7->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer7->HasAura(24818))
                                    {
                                        if (healer7->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer7->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            default:
            {
                break;
            }
            }
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Ysondre))
        {
            bool bossPositionValid = false;
            bool myPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                {
                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                    if (myBossDistance > 18.0f && myBossDistance < 42.0f)
                    {
                        myPositionValid = true;
                    }
                }
            }
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                {
                                    if (healer2->IsAlive())
                                    {
                                        if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer2->HasAura(24818))
                                            {
                                                if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                    {
                                        if (healer3->IsAlive())
                                        {
                                            if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer3->HasAura(24818))
                                                {
                                                    if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                {
                                    if (healer3->IsAlive())
                                    {
                                        if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer3->HasAura(24818))
                                            {
                                                if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                    {
                                        if (healer1->IsAlive())
                                        {
                                            if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer1->HasAura(24818))
                                                {
                                                    if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                {
                                    if (healer1->IsAlive())
                                    {
                                        if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer1->HasAura(24818))
                                            {
                                                if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                    {
                                        if (healer2->IsAlive())
                                        {
                                            if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer2->HasAura(24818))
                                                {
                                                    if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                {
                                    if (healer5->IsAlive())
                                    {
                                        if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer5->HasAura(24818))
                                            {
                                                if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                    {
                                        if (healer6->IsAlive())
                                        {
                                            if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer6->HasAura(24818))
                                                {
                                                    if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                {
                                    if (healer6->IsAlive())
                                    {
                                        if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer6->HasAura(24818))
                                            {
                                                if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                    {
                                        if (healer4->IsAlive())
                                        {
                                            if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer4->HasAura(24818))
                                                {
                                                    if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                {
                                    if (healer4->IsAlive())
                                    {
                                        if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer4->HasAura(24818))
                                            {
                                                if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                    {
                                        if (healer5->IsAlive())
                                        {
                                            if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer5->HasAura(24818))
                                                {
                                                    if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer8 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8))
                        {
                            if (healer8->IsAlive())
                            {
                                if (!healer8->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer8->HasAura(24818))
                                    {
                                        if (healer8->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer8->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer7 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7))
                        {
                            if (healer7->IsAlive())
                            {
                                if (!healer7->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer7->HasAura(24818))
                                    {
                                        if (healer7->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer7->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            default:
            {
                break;
            }
            }
        }
        std::unordered_map<ObjectGuid, Unit*> shadeOfTaerarMap = GetAttackerMap(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Shade_of_Taerar);
        if (shadeOfTaerarMap.size() > 0)
        {
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                {
                                    if (healer2->IsAlive())
                                    {
                                        if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer2->HasAura(24818))
                                            {
                                                if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                    {
                                        if (healer3->IsAlive())
                                        {
                                            if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer3->HasAura(24818))
                                                {
                                                    if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                {
                                    if (healer3->IsAlive())
                                    {
                                        if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer3->HasAura(24818))
                                            {
                                                if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                    {
                                        if (healer1->IsAlive())
                                        {
                                            if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer1->HasAura(24818))
                                                {
                                                    if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                {
                                    if (healer1->IsAlive())
                                    {
                                        if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer1->HasAura(24818))
                                            {
                                                if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                    {
                                        if (healer2->IsAlive())
                                        {
                                            if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer2->HasAura(24818))
                                                {
                                                    if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                {
                                    if (healer5->IsAlive())
                                    {
                                        if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer5->HasAura(24818))
                                            {
                                                if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                    {
                                        if (healer6->IsAlive())
                                        {
                                            if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer6->HasAura(24818))
                                                {
                                                    if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                {
                                    if (healer6->IsAlive())
                                    {
                                        if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer6->HasAura(24818))
                                            {
                                                if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                    {
                                        if (healer4->IsAlive())
                                        {
                                            if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer4->HasAura(24818))
                                                {
                                                    if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank4))
                                                {
                                                    if (tank4->IsAlive())
                                                    {
                                                        if (tank4->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank4, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank5))
                                                {
                                                    if (tank5->IsAlive())
                                                    {
                                                        if (tank5->GetHealthPct() < 90.0f)
                                                        {
                                                            if (sb->Heal(tank5, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                {
                                    if (healer4->IsAlive())
                                    {
                                        if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer4->HasAura(24818))
                                            {
                                                if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                    {
                                        if (healer5->IsAlive())
                                        {
                                            if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer5->HasAura(24818))
                                                {
                                                    if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                        {
                                            if (tank3->IsAlive())
                                            {
                                                if (tank3->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank3, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                            }
                                        }
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer8 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8))
                        {
                            if (healer8->IsAlive())
                            {
                                if (!healer8->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer8->HasAura(24818))
                                    {
                                        if (healer8->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer8->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                        {
                                            if (tank3->IsAlive())
                                            {
                                                if (tank3->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank3, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                            }
                                        }
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer7 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7))
                        {
                            if (healer7->IsAlive())
                            {
                                if (!healer7->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer7->HasAura(24818))
                                    {
                                        if (healer7->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer7->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            default:
            {
                break;
            }
            }
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Taerar))
        {
            if (me->GetClass() == Classes::CLASS_PRIEST)
            {
                if (Player* activeTank = ObjectAccessor::GetPlayer(*me, myGroup->GetOGByTargetIcon(0)))
                {
                    if (!activeTank->HasAura(6346))
                    {
                        if (sb->SpellValid(6346))
                        {
                            if (me->GetExactDist(activeTank->GetPosition()) < 30.0f)
                            {
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                if (sb->CastSpell(activeTank, "Fear Ward", 35.0f))
                                {
                                    return true;
                                }
                            }
                        }
                    }
                }
            }
            bool bossPositionValid = false;
            bool myPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                {
                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                    if (myBossDistance > 18.0f && myBossDistance < 42.0f)
                    {
                        myPositionValid = true;
                    }
                }
            }
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                {
                                    if (healer2->IsAlive())
                                    {
                                        if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer2->HasAura(24818))
                                            {
                                                if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                    {
                                        if (healer3->IsAlive())
                                        {
                                            if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer3->HasAura(24818))
                                                {
                                                    if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3))
                                {
                                    if (healer3->IsAlive())
                                    {
                                        if (!healer3->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer3->HasAura(24818))
                                            {
                                                if (healer3->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer3->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                    {
                                        if (healer1->IsAlive())
                                        {
                                            if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer1->HasAura(24818))
                                                {
                                                    if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                {
                                    if (healer1->IsAlive())
                                    {
                                        if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer1->HasAura(24818))
                                            {
                                                if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                    {
                                        if (healer2->IsAlive())
                                        {
                                            if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer2->HasAura(24818))
                                                {
                                                    if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                {
                                    if (healer5->IsAlive())
                                    {
                                        if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer5->HasAura(24818))
                                            {
                                                if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                    {
                                        if (healer6->IsAlive())
                                        {
                                            if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer6->HasAura(24818))
                                                {
                                                    if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer6 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6))
                                {
                                    if (healer6->IsAlive())
                                    {
                                        if (!healer6->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer6->HasAura(24818))
                                            {
                                                if (healer6->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer6->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                    {
                                        if (healer4->IsAlive())
                                        {
                                            if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer4->HasAura(24818))
                                                {
                                                    if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                bool activeHealerSwitched = false;
                                if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                {
                                    if (healer4->IsAlive())
                                    {
                                        if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer4->HasAura(24818))
                                            {
                                                if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                    activeHealerSwitched = true;
                                                }
                                            }
                                        }
                                    }
                                }
                                if (!activeHealerSwitched)
                                {
                                    if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                    {
                                        if (healer5->IsAlive())
                                        {
                                            if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                            {
                                                if (!healer5->HasAura(24818))
                                                {
                                                    if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                    {
                                                        myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                        activeHealerSwitched = true;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                                if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                                {
                                                    if (tank3->IsAlive())
                                                    {
                                                        if (tank3->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank3, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                        {
                                            if (tank3->IsAlive())
                                            {
                                                if (tank3->GetHealthPct() < 90.0f)
                                                {
                                                    if (me->GetExactDist(tank3->GetPosition()) < 40.0f)
                                                    {
                                                        if (sb->Heal(tank3, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (me->GetExactDist(member->GetPosition()) < 40.0f)
                                                        {
                                                            if (sb->Heal(member, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer8 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8))
                        {
                            if (healer8->IsAlive())
                            {
                                if (!healer8->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer8->HasAura(24818))
                                    {
                                        if (healer8->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer8->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(3))
                {
                    if (activeHealerOG == me->GetGUID())
                    {
                        if (me->IsAlive())
                        {
                            if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                            {
                                if (!me->HasAura(24818))
                                {
                                    if (me->GetPower(Powers::POWER_MANA) > 500)
                                    {
                                        if (Player* tank3 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank3))
                                        {
                                            if (tank3->IsAlive())
                                            {
                                                if (tank3->GetHealthPct() < 90.0f)
                                                {
                                                    if (me->GetExactDist(tank3->GetPosition()) < 40.0f)
                                                    {
                                                        if (sb->Heal(tank3, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                        {
                                            if (Player* member = groupRef->GetSource())
                                            {
                                                if (member->IsAlive())
                                                {
                                                    if (member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 || member->groupRole == GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                                    {
                                                        continue;
                                                    }
                                                    if (member->GetHealthPct() < 50.0f)
                                                    {
                                                        if (me->GetExactDist(member->GetPosition()) < 40.0f)
                                                        {
                                                            if (sb->Heal(member, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        return true;
                                    }
                                }
                            }
                        }
                        if (Player* healer7 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7))
                        {
                            if (healer7->IsAlive())
                            {
                                if (!healer7->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                {
                                    if (!healer7->HasAura(24818))
                                    {
                                        if (healer7->GetPower(Powers::POWER_MANA) > 500)
                                        {
                                            myGroup->SetTargetIcon(3, me->GetGUID(), healer7->GetGUID());
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                return true;
                break;
            }
            default:
            {
                break;
            }
            }
        }
        if (Unit* boss = GetAttacker(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Emeriss))
        {
            bool bossPositionValid = false;
            bool myPositionValid = false;
            if (AngleInRange(basePos.GetOrientation(), boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            else if (AngleInRange(basePos.GetOrientation() + M_PI, boss->GetOrientation(), ANGLE_RANGE))
            {
                bossPositionValid = true;
            }
            if (bossPositionValid)
            {
                float myBossAngle = boss->GetPosition().GetAbsoluteAngle(me->GetPosition());
                if (myBossAngle > basePos.GetOrientation() + M_PI * 5 / 16 && myBossAngle < basePos.GetOrientation() + M_PI * 11 / 16)
                {
                    float myBossDistance = me->GetExactDist(boss->GetPosition());
                    if (myBossDistance > 18.0f && myBossDistance < 42.0f)
                    {
                        myPositionValid = true;
                    }
                }
            }
            if (me->GetClass() == Classes::CLASS_PRIEST)
            {
                if (Player* activeTank = ObjectAccessor::GetPlayer(*me, myGroup->GetOGByTargetIcon(0)))
                {
                    if (activeTank->HasAura(24928))
                    {
                        if (me->GetExactDist(activeTank->GetPosition()) < 40.0f)
                        {
                            me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                            me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                            me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                            me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                            if (sb->CastSpell(activeTank, "Abolish Disease", 45.0f))
                            {
                                return true;
                            }
                        }
                    }
                }
            }
            switch (me->groupRole)
            {
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                if (Player* healer2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2))
                                {
                                    if (healer2->IsAlive())
                                    {
                                        if (!healer2->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer2->HasAura(24818))
                                            {
                                                if (healer2->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer2->GetGUID());
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer2:
            {
                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                {
                    if (tank1->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank1->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(1))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank1, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }

                                if (Player* healer1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer1))
                                {
                                    if (healer1->IsAlive())
                                    {
                                        if (!healer1->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer1->HasAura(24818))
                                            {
                                                if (healer1->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(1, me->GetGUID(), healer1->GetGUID());
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank1->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank1))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                                                {
                                                    if (tank2->IsAlive())
                                                    {
                                                        if (tank2->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank2, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer3:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (me->IsAlive())
                {
                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                    {
                        if (!me->HasAura(24818))
                        {
                            if (me->GetPower(Powers::POWER_MANA) > 500)
                            {
                                uint8 mySubGroup = me->GetSubGroup();
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (me->GetExactDist(member->GetPosition()) < RANGED_MAX_DISTANCE)
                                                        {
                                                            if (sb->GroupHeal(100.0f))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                return true;
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                if (Player* healer5 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5))
                                {
                                    if (healer5->IsAlive())
                                    {
                                        if (!healer5->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer5->HasAura(24818))
                                            {
                                                if (healer5->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer5->GetGUID());
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer5:
            {
                if (Player* tank2 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2))
                {
                    if (tank2->IsAlive())
                    {
                        if (bossPositionValid)
                        {
                            if (myPositionValid)
                            {
                                float myTankDistance = me->GetExactDist(tank2->GetPosition());
                                if (myTankDistance > 40.0f)
                                {
                                    myPositionValid = false;
                                }
                            }
                            if (!myPositionValid)
                            {
                                markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                                actionDelay = 3000;
                                actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                                me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                                me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                                return true;
                            }
                        }
                        if (ObjectGuid activeHealerOG = myGroup->GetOGByTargetIcon(2))
                        {
                            if (activeHealerOG == me->GetGUID())
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) > 500)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->Heal(tank2, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (me->GetHealthPct() < 50.0f)
                                                {
                                                    if (sb->Heal(me, true))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                return true;
                                            }
                                        }
                                    }
                                }
                                if (Player* healer4 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer4))
                                {
                                    if (healer4->IsAlive())
                                    {
                                        if (!healer4->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                        {
                                            if (!healer4->HasAura(24818))
                                            {
                                                if (healer4->GetPower(Powers::POWER_MANA) > 500)
                                                {
                                                    myGroup->SetTargetIcon(2, me->GetGUID(), healer4->GetGUID());
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                            else
                            {
                                if (me->IsAlive())
                                {
                                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                                    {
                                        if (!me->HasAura(24818))
                                        {
                                            if (me->GetPower(Powers::POWER_MANA) * 100 / me->GetMaxPower(Powers::POWER_MANA) > 50)
                                            {
                                                if (tank2->GetHealthPct() < 90.0f)
                                                {
                                                    if (sb->SubHeal(tank2))
                                                    {
                                                        return true;
                                                    }
                                                }
                                                if (Player* tank1 = GetPlayerByGroupRole(GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1))
                                                {
                                                    if (tank1->IsAlive())
                                                    {
                                                        if (tank1->GetHealthPct() < 50.0f)
                                                        {
                                                            if (sb->Heal(tank1, true))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        return true;
                    }
                }
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer6:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (me->IsAlive())
                {
                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                    {
                        if (!me->HasAura(24818))
                        {
                            if (me->GetPower(Powers::POWER_MANA) > 500)
                            {
                                uint8 mySubGroup = me->GetSubGroup();
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (me->GetExactDist(member->GetPosition()) < RANGED_MAX_DISTANCE)
                                                        {
                                                            if (sb->GroupHeal(100.0f))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                return true;
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer7:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (me->IsAlive())
                {
                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                    {
                        if (!me->HasAura(24818))
                        {
                            if (me->GetPower(Powers::POWER_MANA) > 500)
                            {
                                uint8 mySubGroup = me->GetSubGroup();
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (me->GetExactDist(member->GetPosition()) < RANGED_MAX_DISTANCE)
                                                        {
                                                            if (sb->GroupHeal(100.0f))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                return true;
                            }
                        }
                    }
                }
                return true;
                break;
            }
            case GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Healer8:
            {
                if (bossPositionValid)
                {
                    if (!myPositionValid)
                    {
                        markPos = GetNearPoint(boss->GetPosition(), engageDistance, engageAngle);
                        actionDelay = 3000;
                        actionType = ActionType_EmeraldDragon::ActionType_EmeraldDragon_MarkMove;
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_AUTOREPEAT_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_CHANNELED_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_GENERIC_SPELL);
                        me->InterruptSpell(CurrentSpellTypes::CURRENT_MELEE_SPELL);
                        me->GetMotionMaster()->MovePoint(0, markPos, true, me->GetAbsoluteAngle(boss->GetPosition()));
                        return true;
                    }
                }
                if (me->IsAlive())
                {
                    if (!me->GetNearbyCreatureWithEntry(CreatureEntry_RobotStrategy::CreatureEntry_RobotStrategy_Dream_Fog, 3.0f))
                    {
                        if (!me->HasAura(24818))
                        {
                            if (me->GetPower(Powers::POWER_MANA) > 500)
                            {
                                uint8 mySubGroup = me->GetSubGroup();
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (me->GetExactDist(member->GetPosition()) < RANGED_MAX_DISTANCE)
                                                        {
                                                            if (sb->GroupHeal(100.0f))
                                                            {
                                                                return true;
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                for (GroupReference* groupRef = myGroup->GetFirstMember(); groupRef != nullptr; groupRef = groupRef->next())
                                {
                                    if (Player* member = groupRef->GetSource())
                                    {
                                        if (member->IsAlive())
                                        {
                                            if (member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank1 && member->groupRole != GroupRole_EmeraldDragon::GroupRole_EmeraldDragon_Tank2)
                                            {
                                                if (member->GetSubGroup() == mySubGroup)
                                                {
                                                    if (member->GetHealthPct() < 90.0f)
                                                    {
                                                        if (sb->Heal(member, true))
                                                        {
                                                            return true;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                                return true;
                            }
                        }
                    }
                }
                return true;
                break;
            }
            default:
            {
                break;
            }
            }
        }
    }

    return RobotStrategy_Group::Heal();
}
