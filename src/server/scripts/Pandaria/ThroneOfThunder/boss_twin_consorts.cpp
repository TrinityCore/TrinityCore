/*
* Copyright 2023 AzgathCore
*
* This program is free software; you can redistribute it and/or modify it
* under the terms of the GNU General Public License as published by the
* Free Software Foundation; either version 2 of the License, or (at your
* option) any later version.
*
* This program is distributed in the hope that it will be useful, but WITHOUT
* ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
* FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
* more details.
*
* You should have received a copy of the GNU General Public License along
* with this program. If not, see <http://www.gnu.org/licenses/>.
*/

#include "throne_of_thunder.h"
#include "GameObject.h"
#include "PhaseShift.h"
#include "PhasingHandler.h"
#include "SpellAuraDefines.h"
#include "SpellAuraEffects.h"

enum Creatures
{
    NPC_SUEN = 68904,
    NPC_LURKERS = 69591,
    NPC_BEAST_OF_NIGHTMARES = 69479,
    NPC_MELT_ICE_TRIGGER = 999294,
    NPC_MOON_LOTUS = 69340, // main summoner
    NPC_MOON_LOTUS_MOVE = 69456, // MOVER
    NPC_STAR = 69365,
    NPC_ICE_COMET = 69704,

    NPC_CHI_JI = 69774,
    NPC_NIUZAO = 69777,
    NPC_XUEN = 69771,
    NPC_YU_LON = 69779,

    // Serpent Constellation
    NPC_YULON_CONSTELATION_CORRECT_1 = 999295,
    NPC_YULON_CONSTELATION_CORRECT_2 = 999296,
    NPC_YULON_CONSTELATION_CORRECT_3 = 999297,
    NPC_YULON_CONSTELATION_CORRECT_4 = 999298,
    NPC_YULON_CONSTELATION_CORRECT_5 = 999299,
    NPC_YULON_CONSTELATION_FAIL_6 = 999368,
    NPC_YULON_CONSTELATION_FAIL_7 = 999369,

    // Ox Constellation
    NPC_NIUZAO_CONSTELLATION_CORRECT_1 = 999449,
    NPC_NIUZAO_CONSTELLATION_CORRECT_2 = 999450,
    NPC_NIUZAO_CONSTELLATION_CORRECT_3 = 999451,
    NPC_NIUZAO_CONSTELLATION_CORRECT_4 = 999457,
    NPC_NIUZAO_CONSTELLATION_CORRECT_5 = 999458,
    NPC_NIUZAO_CONSTELLATION_FAIL_6 = 999459,
    NPC_NIUZAO_CONSTELLATION_FAIL_7 = 999460,

    // Tiger Constellation
    NPC_XUEN_CONSTELLATION_CORRECT_1 = 999461,
    NPC_XUEN_CONSTELLATION_CORRECT_2 = 999462,
    NPC_XUEN_CONSTELLATION_CORRECT_3 = 999463,
    NPC_XUEN_CONSTELLATION_CORRECT_4 = 999464,
    NPC_XUEN_CONSTELLATION_CORRECT_5 = 999465,
    NPC_XUEN_CONSTELLATION_CORRECT_6 = 999466,
    NPC_XUEN_CONSTELLATION_FAIL_7 = 999467,
    NPC_XUEN_CONSTELLATION_FAIL_8 = 999468,

    // Crane Constellation
    NPC_CHIJI_CONSTELLATION_CORRECT_1 = 999471,
    NPC_CHIJI_CONSTELLATION_CORRECT_2 = 999472,
    NPC_CHIJI_CONSTELLATION_CORRECT_3 = 999473,
    NPC_CHIJI_CONSTELLATION_CORRECT_4 = 999474,
    NPC_CHIJI_CONSTELLATION_CORRECT_5 = 999475,
    NPC_CHIJI_CONSTELLATION_CORRECT_6 = 999476,
    NPC_CHIJI_CONSTELLATION_FAIL_7 = 999477,
    NPC_CHIJI_CONSTELLATION_FAIL_8 = 999478,

    NPC_CRANE_RUSH_TRIGGER = 999479,

    NPC_TWIN_CONSORTS_CONTROLER = 999480,
    NPC_TIDAL_FORCE_SLOWER = 999481,
};

// player is teleported at: 6198.65f, 4214.27f, 146.50f, 2.34f
Position const ConstellationPoints[7] =
{
    { 6173.21f, 4240.08f, 146.53f, 0.42f }, // center
    { 6195.01f, 4238.06f, 146.49f, 2.28f }, // right bot
    { 6188.42f, 4255.24f, 146.48f, 2.29f }, // right middle
    { 6173.65f, 4260.87f, 146.48f, 4.30f }, // right top
    { 6157.13f, 4224.27f, 146.48f, 3.85f }, // left middle
    { 6171.67f, 4217.34f, 146.49f, 5.26f }, // left bot
    { 6151.36f, 4236.38f, 146.48f, 3.82f }, // left top
};

Position const Tiger[1] =
{
    { 6239.10f, 4247.66f, 151.44f, 3.23f },
};

Position const Serpent[1] =
{
    { 6164.72f, 4169.63f, 150.62f, 1.46f },
};

Position const Ox[1] =
{
    { 6104.25f, 4230.80f, 150.516f, 0.12f },
};

Position const Crane[1] =
{
    { 6181.09f, 4307.19f, 150.76f, 4.69f },
};

enum Spells
{
    // Celestial
    SPELL_RED_SHADOWY = 138065,
    SPELL_BLUE_SHADOWY = 138059,
    SPELL_GREEN_SHADOWY = 138071,
    SPELL_YELLOW_SHADOWY = 138069,

    SPELL_TIGERS_CELERITY = 146296, // maybe 138656 ? 
    SPELL_SERPENTS_VITALITY = 138306,
    SPELL_A_RUSH_OF_CRANES = 144470, // 500 ms summon
    SPELL_A_RUSH_OF_CRANES_SUMMON = 144495, // morph into 46475
    SPELL_CRANE_RUSH_AREATRIGGER = 138314,
    SPELL_CRANE_RUSH_DAMAGE = 138318, // damaging spell
    SPELL_FORTITUDE_OF_THE_OX = 138300,

    // Lu'lin
    SPELL_MOON_LOTUS = 136690,
    //SPELL_MOON_LOTUS_INVISIBLE = 137192,
    SPELL_MOON_LOTUS_ACTIVATE = 137118,
    SPELL_MOON_LOTUS_EFFECT = 136722, // sleep 
    SPELL_MOON_LOTUS_VISUAL = 137192,
    SPELL_MOON_LOTUS_AT_EFFECT = 136721, // npc trigger 0.4 speed

    SPELL_COSMIC_BARRAGE = 136752,

    SPELL_BEAST_OF_NIGHTMARES = 137341, // aura on player

    SPELL_CORRUPTED_HEALING = 137360,

    SPELL_CRASHING_STAR = 137129,

    SPELL_ICE_COMET = 137418,
    SPELL_ICY_SHADOWS = 137440, // debuff
    SPELL_ICY_SHADOWS_AT = 137439,
    SPELL_ICE_COMENT_VISUAL = 137420,

    SPELL_TIDAL_FORCE = 137531,
    SPELL_TIDAL_FORCE_DAMAGE = 137716,
    SPELL_TIDAL_FORCE_EFFECT = 137718,

    SPELL_TIDAL_FORCE_WAVE = 140863,

    // Suen
    SPELL_FAN_OF_FLAMES = 137408,

    SPELL_FLAMES_OF_PASSION = 137412,
    SPELL_FLAMES_OF_PASSION_PERIODIC = 137417, // area trigger spell ? 137416 > area persistant damage

    SPELL_BLAZING_RADIANCE = 137410, // damage
    SPELL_BLAZING_RADIANCE_STACK_DAMAGE = 139412, // periodic damage updater

    SPELL_LIGHT_OF_DAY = 138822,

    SPELL_TEARS_OF_THE_SUN = 137404,
    SPELL_LIGHT_OF_DAY_DARK = 137401,
    SPELL_TEARS_OF_THE_SUN_PERIODIC = 137405,

    SPELL_NUCLEAR_INFERNO = 137491,
    SPELL_NUCLEAR_INFERNO_DAMAGE = 137492,

    // Celestials
    SPELL_CELESTIAL_BEAM = 138206,

    SPELL_TIGER_CONSTELLATION = 138261,
    SPELL_OX_CONSTELLATION = 138260,
    SPELL_CRANE_CONSTELLATION = 138180,
    SPELL_SERPENT_CONSTELLATION = 138262,

    SPELL_CONSTELLATION_UPDATED = 137138,
    SPELL_CONSTELLATION_STATIONARY = 138039,

    SPELL_CONSTELLATION_FAIL = 138933,
    SPELL_CONSTELATION_SUCCES = 138930,

    // drawings and screen effects
    SPELL_INVOKE_SERPENT_SPIRIT = 138267,
    SPELL_INVOKE_OX_SPIRIT = 138254,
    SPELL_INVOKE_CRANE_SPIRIT = 138189,
    SPELL_INVOKE_TIGER_SPIRIT = 138264,

    // LURKERS
    SPELL_DARKNESS = 137382,
    SPELL_SHADOWED_VISUAL = 111705,
};

enum Events
{
    EVENT_MOON_LOTUS = 1,
    EVENT_COSMIC_BARRAGE,
    EVENT_BEAST_OF_NIGHTMARES,
    EVENT_SUMMON_LURKERS, // heroic only
    EVENT_TEARS_OF_THE_SUN,
    EVENT_TEARS_DONE,
    EVENT_LIGHT_OF_DAY_DARK,
    EVENT_CAST_DARKNESS,

    EVENT_FAN_OF_FLAMES,
    EVENT_ALREADY_A_PLAYERS,
    EVENT_FLAMES_OF_PASSION,
    EVENT_LIGHT_OF_DAY,
    EVENT_NUCLEAR_INFERNO,
    EVENT_FLAMES_OF_PASSION_FLAME,
    EVENT_STAR_ATTACK,
    EVENT_BLAZING_RADIANCE,
    EVENT_NUCLEAR_INFERNO_CLEAN,
    EVENT_MAKE_A_RUN,
    EVENT_SELECT_ORIENTATION_AND_RUSH,
    EVENT_ICE_COMET,
    EVENT_ICY_SHADOWS,

    EVENT_TIDAL_FORCE,
    EVENT_REMOVE_STACKS,
    EVENT_CHECK_ACTIVE,
    EVENT_SHUFFLE_ORIENTATION_AND_MOVE,
    EVENT_CHECK_PROXIMITY_PLAYERS,
    EVENT_SUMMON_AT,

    EVENT_DARKNESS_PHASE,
    EVENT_ICE_COMET_DUSK,
    EVENT_DAYLIGHT_PHASE,

    EVENT_BERSERK,
};

enum Actions
{
    ACTION_DARK_PHASE_LULIN = 2,

    ACTION_DAYLIGHT_PHASE_SUEN = 3,

    ACTION_DUSK = 4,

    ACTION_NO_LONGER_DARKNESS = 5,
    ACTION_DARKNESS = 6,

    ACTION_RESET_POINTS = 7,
    ACTION_ACTIVE_POINTS = 8,
    ACTION_CONSTELLATION_COMPLETE = 9,
    ACTION_PLAYER_IN_ROOM = 10,

    ACTION_LURKER_VISIBLE = 11,
    ACTION_LURKER_INVISIBLE = 12,

    ACTION_DUSK_END = 13,

    ACTION_BOSS_TIMERS_START = 14,
    ACTION_BOSS_TIMERS_DONE = 15,
    ACTION_BOSS_TIMERS_WIPE = 16,

    ACTION_RESET_CELESTIALS_DUSK = 17,
};

Position const MoonLotus[10] =
{
    { 6161.84f, 4197.94f, 146.48f, 2.99f },
    { 6135.09f, 4220.55f, 146.48f, 2.37f },
    { 6226.12f, 4245.04f, 146.47f, 4.32f },
    { 6133.09f, 4247.90f, 146.48f, 1.88f },
    { 6200.98f, 4276.29f, 146.48f, 5.74f },
    { 6186.13f, 4191.75f, 146.48f, 0.60f },
    { 6152.28f, 4282.76f, 146.48f, 0.91f },
    { 6156.41f, 4207.16f, 146.48f, 0.81f },
    { 6201.08f, 4213.95f, 146.50f, 4.21f },
};

Position const Lurkers[20] =
{
    { 6207.62f, 4230.40f, 146.49f, 3.01f },
    { 6220.99f, 4245.38f, 146.47f, 3.21f },
    { 6218.58f, 4262.52f, 146.47f, 3.43f },
    { 6200.75f, 4266.97f, 146.47f, 2.92f },
    { 6197.43f, 4281.36f, 146.47f, 2.00f },
    { 6182.48f, 4292.10f, 146.47f, 2.93f },
    { 6136.79f, 4275.58f, 146.58f, 3.98f },
    { 6160.55f, 4283.81f, 146.48f, 3.50f },
    { 6140.35f, 4208.22f, 146.48f, 4.90f },
    { 6124.44f, 4258.12f, 146.48f, 4.56f },
    { 6162.56f, 4190.71f, 146.48f, 5.61f },
    { 6137.44f, 4222.84f, 146.48f, 5.98f },
    { 6175.06f, 4201.31f, 146.48f, 0.70f },
    { 6127.47f, 4235.93f, 146.48f, 4.85f },
    { 6157.91f, 4190.52f, 146.48f, 2.63f },
    { 6171.56f, 4182.95f, 146.48f, 4.52f },
    { 6114.61f, 4228.38f, 146.48f, 3.67f },
    { 6200.27f, 4213.42f, 146.50f, 0.78f },
    { 6204.39f, 4229.03f, 146.49f, 2.79f },
    { 6222.84f, 4222.43f, 146.48f, 2.00f },
};

enum Timers
{
    TIMER_IMMEDIATE = 0,

    TIMER_DARKNESS_PHASE = 3 * IN_MILLISECONDS * MINUTE, // change to daylight
    TIMER_DAYLIGHT_PHASE = 3 * IN_MILLISECONDS * MINUTE, // change to dusk

    TIMER_BERSERK = 10 * IN_MILLISECONDS * MINUTE,

    // DARK PHASE

    // Suen in dark
    TIMER_TEARS_OF_THE_SUN = 40 * IN_MILLISECONDS,
    TIMER_LIGHT_OF_DAY = 20 * IN_MILLISECONDS,

    // Lulin in dark
    TIMER_MOON_LOTUS = 32 * IN_MILLISECONDS,
    TIMER_COSMIC_BARRAGE = 20 * IN_MILLISECONDS,
    TIMER_BEAST_OF_NIGHTMARE = 50 * IN_MILLISECONDS,

    // HEROIC
    TIMER_LURKERS = 15 * IN_MILLISECONDS,

    // DAY PHASE

    // Suen in day
    TIMER_FAN_OF_FLAMES = 25 * IN_MILLISECONDS,
    TIMER_FLAMES_OF_PASSION = 35 * IN_MILLISECONDS,
    TIMER_BLAZING_RADIANCE = 2 * IN_MILLISECONDS,

    // Lulin in day
    TIMER_ICE_COMET = 15 * IN_MILLISECONDS,

    // DUSK

    // Suen
    TIMER_NUCLEAR_INFERNO = 50 * IN_MILLISECONDS,

    // Lulin
    TIMER_TIDAL_FORCE = 15 * IN_MILLISECONDS,
    TIMER_TIDAL_FORCE_SECOND = 40 * IN_MILLISECONDS,
};

enum Points
{
    POINT_FLAME = 1,
};

enum Talks
{
    // Suen
    TALK_S_AGGRO = 1,
    TALK_S_PHASE_2 = 2,
    TALK_S_PHASE_3 = 3,
    TALK_S_FLAMES = 4,
    TALK_S_WIPE = 5,

    // Lu'lin
    TALK_L_AGGRO = 1,
    TALK_L_PHASE_1 = 2,
    TALK_L_PHASE_3 = 3,
    TALK_L_WIPE = 5,
};

void AddSC_bfa_boss_twin_consorts()
{
    
}
