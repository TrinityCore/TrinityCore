<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3170px" preserveAspectRatio="none" style="width:2079px;height:3170px;" version="1.1" viewBox="0 0 2079 3170" width="2079px" zoomAndPan="magnify"><defs><filter height="300%" id="fl4bfh57hav0" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="1000.75" y="26.0439">AuthServer</text><rect fill="#F0FFFF" height="3104.6094" style="stroke: #A80036; stroke-width: 1.0;" width="1697.5" x="19" y="37.1201"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="75" x="830.25" y="52.0181">Auth Server</text><rect fill="#FFFFFF" filter="url(#fl4bfh57hav0)" height="1034.1406" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1992" y="1884.2056"/><rect fill="#D3D3D3" filter="url(#fl4bfh57hav0)" height="99.6289" style="stroke: #000000; stroke-width: 2.0;" width="303" x="13" y="139.2402"/><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="223" y="158.9946"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="230" y="182.0386">ConfigMgr</text><rect fill="#F0FFFF" filter="url(#fl4bfh57hav0)" height="860.1055" style="stroke: #000000; stroke-width: 2.0;" width="1031.5" x="13" y="252.8691"/><rect fill="#A9A9A9" filter="url(#fl4bfh57hav0)" height="52.2402" style="stroke: #A80036; stroke-width: 1.5;" width="164" x="316" y="272.6235"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="323" y="295.6675">&lt;&lt; DatabaseLoader &gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="380" y="314.7876">loader</text><rect fill="#FFFFFF" filter="url(#fl4bfh57hav0)" height="264.3037" style="stroke: #000000; stroke-width: 2.0;" width="589" x="306" y="346.8638"/><rect fill="#FFFFFF" filter="url(#fl4bfh57hav0)" height="82.2861" style="stroke: #000000; stroke-width: 2.0;" width="401" x="484" y="477.127"/><rect fill="#FFFFFF" filter="url(#fl4bfh57hav0)" height="452.8071" style="stroke: #000000; stroke-width: 2.0;" width="728.5" x="306" y="639.1675"/><rect fill="#F0FFFF" filter="url(#fl4bfh57hav0)" height="583.436" style="stroke: #000000; stroke-width: 2.0;" width="1739" x="13" y="1171.729"/><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="972.5" y="1191.4834"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="979.5" y="1214.5273">AuthSocketMgr</text><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="176" x="1181.5" y="1239.6035"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="1188.5" y="1262.6475">SocketMgr&lt;AuthSession&gt;</text><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="205" x="1396.5" y="1413.7412"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="191" x="1403.5" y="1436.7852">NetworkThread&lt;AuthSession&gt;</text><rect fill="#00FFFF" filter="url(#fl4bfh57hav0)" height="188.7949" style="stroke: #000000; stroke-width: 2.0;" width="355.5" x="1386.5" y="1468.8613"/><rect fill="#00FFFF" filter="url(#fl4bfh57hav0)" height="64.5088" style="stroke: #000000; stroke-width: 2.0;" width="126.5" x="1605.5" y="1572.1475"/><rect fill="#F0FFFF" filter="url(#fl4bfh57hav0)" height="1221.6899" style="stroke: #000000; stroke-width: 2.0;" width="2055.5" x="13" y="1769.165"/><rect fill="#FFFF00" filter="url(#fl4bfh57hav0)" height="1077.6494" style="stroke: #000000; stroke-width: 2.0;" width="1584.5" x="474" y="1840.6968"/><rect fill="#00FFFF" filter="url(#fl4bfh57hav0)" height="153.2808" style="stroke: #000000; stroke-width: 2.0;" width="333.5" x="1605.5" y="2099.7319"/><rect fill="#FFFF00" filter="url(#fl4bfh57hav0)" height="173.772" style="stroke: #000000; stroke-width: 2.0;" width="1564.5" x="484" y="2469.5391"/><rect fill="#FFFF00" filter="url(#fl4bfh57hav0)" height="254.0352" style="stroke: #000000; stroke-width: 2.0;" width="1564.5" x="484" y="2657.311"/><rect fill="#FFFF00" filter="url(#fl4bfh57hav0)" height="51.5088" style="stroke: #000000; stroke-width: 2.0;" width="443" x="1605.5" y="2932.3462"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="67" x2="67" y1="122.2402" y2="3052.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="264" x2="264" y1="193.0547" y2="3052.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="400" x2="400" y1="316.2437" y2="3052.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="684" x2="684" y1="122.2402" y2="3052.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1029.5" x2="1029.5" y1="1225.5435" y2="3052.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1271.5" x2="1271.5" y1="1273.6636" y2="3052.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1500.5" x2="1500.5" y1="1447.8013" y2="3052.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1663.5" x2="1663.5" y1="122.2402" y2="3052.6094"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1996.5" x2="1996.5" y1="122.2402" y2="3052.6094"/><rect fill="#FFD700" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="23" y="84.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="30" y="107.1641">AuthServer</text><rect fill="#FFD700" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="23" y="3051.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="30" y="3074.6533">AuthServer</text><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="223" y="3051.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="230" y="3074.6533">ConfigMgr</text><rect fill="#A9A9A9" filter="url(#fl4bfh57hav0)" height="52.2402" style="stroke: #A80036; stroke-width: 1.5;" width="164" x="316" y="3051.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="323" y="3074.6533">&lt;&lt; DatabaseLoader &gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="380" y="3093.7734">loader</text><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="52.2402" style="stroke: #A80036; stroke-width: 1.5;" width="377" x="494" y="65"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="359" x="501" y="88.0439">&lt;&lt; DatabaseWorkerPool&lt;LoginDatabaseConnection&gt; &gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="636.5" y="107.1641">LoginDatabase</text><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="52.2402" style="stroke: #A80036; stroke-width: 1.5;" width="377" x="494" y="3051.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="359" x="501" y="3074.6533">&lt;&lt; DatabaseWorkerPool&lt;LoginDatabaseConnection&gt; &gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="636.5" y="3093.7734">LoginDatabase</text><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="972.5" y="3051.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="979.5" y="3074.6533">AuthSocketMgr</text><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="176" x="1181.5" y="3051.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="1188.5" y="3074.6533">SocketMgr&lt;AuthSession&gt;</text><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="205" x="1396.5" y="3051.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="191" x="1403.5" y="3074.6533">NetworkThread&lt;AuthSession&gt;</text><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1615.5" y="84.1201"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1622.5" y="107.1641">AuthSession</text><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1615.5" y="3051.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1622.5" y="3074.6533">AuthSession</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="1955.5" y="119.1641">WOW Client</text><ellipse cx="1997" cy="46.1201" fill="#FEFECE" filter="url(#fl4bfh57hav0)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M1997,54.1201 L1997,81.1201 M1984,62.1201 L2010,62.1201 M1997,81.1201 L1984,96.1201 M1997,81.1201 L2010,96.1201 " fill="none" filter="url(#fl4bfh57hav0)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="77" x="1955.5" y="3067.6533">WOW Client</text><ellipse cx="1997" cy="3080.7295" fill="#FEFECE" filter="url(#fl4bfh57hav0)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M1997,3088.7295 L1997,3115.7295 M1984,3096.7295 L2010,3096.7295 M1997,3115.7295 L1984,3130.7295 M1997,3115.7295 L2010,3130.7295 " fill="none" filter="url(#fl4bfh57hav0)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FFFFFF" filter="url(#fl4bfh57hav0)" height="1034.1406" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1992" y="1884.2056"/><path d="M13,139.2402 L217,139.2402 L217,148.2402 L207,158.2402 L13,158.2402 L13,139.2402 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="99.6289" style="stroke: #000000; stroke-width: 2.0;" width="303" x="13" y="139.2402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="159" x="28" y="155.1382">sConfigMgr-&gt;LoadInitial()</text><polygon fill="#A80036" points="211,160.9946,221,164.9946,211,168.9946,215,164.9946" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="217" y1="164.9946" y2="164.9946"/><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="223" y="158.9946"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="230" y="182.0386">ConfigMgr</text><polygon fill="#A80036" points="78.5,226.8691,68.5,230.8691,78.5,234.8691,74.5,230.8691" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="72.5" x2="263.5" y1="230.8691" y2="230.8691"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="84.5" y="226.0127">authserver.conf loaded</text><path d="M13,252.8691 L114,252.8691 L114,261.8691 L104,271.8691 L13,271.8691 L13,252.8691 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="860.1055" style="stroke: #000000; stroke-width: 2.0;" width="1031.5" x="13" y="252.8691"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56" x="28" y="268.7671">StartDB()</text><polygon fill="#A80036" points="304,292.3779,314,296.3779,304,300.3779,308,296.3779" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="310" y1="296.3779" y2="296.3779"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="47" x="74.5" y="291.5215">initialize</text><rect fill="#A9A9A9" filter="url(#fl4bfh57hav0)" height="52.2402" style="stroke: #A80036; stroke-width: 1.5;" width="164" x="316" y="272.6235"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="146" x="323" y="295.6675">&lt;&lt; DatabaseLoader &gt;&gt;</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="380" y="314.7876">loader</text><path d="M306,346.8638 L443,346.8638 L443,355.8638 L433,365.8638 L306,365.8638 L306,346.8638 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="264.3037" style="stroke: #000000; stroke-width: 2.0;" width="589" x="306" y="346.8638"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="92" x="321" y="362.7617">AddDatabase()</text><polygon fill="#A80036" points="672.5,368.6182,682.5,372.6182,672.5,376.6182,676.5,372.6182" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="400" x2="678.5" y1="372.6182" y2="372.6182"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="726.5" y1="404.3726" y2="404.3726"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="726.5" x2="726.5" y1="404.3726" y2="417.3726"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="685.5" x2="726.5" y1="417.3726" y2="417.3726"/><polygon fill="#A80036" points="695.5,413.3726,685.5,417.3726,695.5,421.3726,691.5,417.3726" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="691.5" y="399.5161">_open.push(</text><text fill="#00FFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="762.5" y="399.5161">λ1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="776.5" y="399.5161">)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="726.5" y1="449.127" y2="449.127"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="726.5" x2="726.5" y1="449.127" y2="462.127"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="685.5" x2="726.5" y1="462.127" y2="462.127"/><polygon fill="#A80036" points="695.5,458.127,685.5,462.127,695.5,466.127,691.5,462.127" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="74" x="691.5" y="444.2705">_close.push(</text><text fill="#00FFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="765.5" y="444.2705">λ2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="779.5" y="444.2705">)</text><path d="M484,477.127 L545,477.127 L545,486.127 L535,496.127 L484,496.127 L484,477.127 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="82.2861" style="stroke: #000000; stroke-width: 2.0;" width="401" x="484" y="477.127"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="16" x="499" y="493.0249">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="205" x="560" y="491.7329">[配置:Updates.EnableDatabases=true]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="726.5" y1="538.4131" y2="538.4131"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="726.5" x2="726.5" y1="538.4131" y2="551.4131"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="685.5" x2="726.5" y1="551.4131" y2="551.4131"/><polygon fill="#A80036" points="695.5,547.4131,685.5,551.4131,695.5,555.4131,691.5,551.4131" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="691.5" y="515.8022">_populate.push(</text><text fill="#00FFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="783.5" y="515.8022">λ3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="797.5" y="515.8022">)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="691.5" y="533.5566">_update.push(</text><text fill="#00FFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="773.5" y="533.5566">λ4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="787.5" y="533.5566">)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="726.5" y1="590.1675" y2="590.1675"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="726.5" x2="726.5" y1="590.1675" y2="603.1675"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="685.5" x2="726.5" y1="603.1675" y2="603.1675"/><polygon fill="#A80036" points="695.5,599.1675,685.5,603.1675,695.5,607.1675,691.5,603.1675" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="691.5" y="585.311">_prepare.push(</text><text fill="#00FFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="777.5" y="585.311">λ5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="791.5" y="585.311">)</text><polygon fill="#A80036" points="411,620.1675,401,624.1675,411,628.1675,407,624.1675" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="405" x2="683.5" y1="624.1675" y2="624.1675"/><path d="M306,639.1675 L391,639.1675 L391,648.1675 L381,658.1675 L306,658.1675 L306,639.1675 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="452.8071" style="stroke: #000000; stroke-width: 2.0;" width="728.5" x="306" y="639.1675"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="321" y="655.0654">Load()</text><polygon fill="#A80036" points="672.5,678.6763,682.5,682.6763,672.5,686.6763,676.5,682.6763" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="400" x2="678.5" y1="682.6763" y2="682.6763"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="407" y="677.8198">OpenDatabases()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="726.5" y1="749.9395" y2="749.9395"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="726.5" x2="726.5" y1="749.9395" y2="762.9395"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="685.5" x2="726.5" y1="762.9395" y2="762.9395"/><polygon fill="#A80036" points="695.5,758.9395,685.5,762.9395,695.5,766.9395,691.5,762.9395" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#00FFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="691.5" y="709.5742">λ1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="705.5" y="709.5742">: SetConnectionInfo()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="723.5" y="727.3286">[DBUpdater&lt;T&gt;::Create() : "create_table.sql"]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="715.5" y="745.083">Open()</text><polygon fill="#A80036" points="411,772.9395,401,776.9395,411,780.9395,407,776.9395" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="405" x2="683.5" y1="776.9395" y2="776.9395"/><polygon fill="#A80036" points="672.5,804.6938,682.5,808.6938,672.5,812.6938,676.5,808.6938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="400" x2="678.5" y1="808.6938" y2="808.6938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="407" y="803.8374">PopulateDatabases()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="726.5" y1="840.4482" y2="840.4482"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="726.5" x2="726.5" y1="840.4482" y2="853.4482"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="685.5" x2="726.5" y1="853.4482" y2="853.4482"/><polygon fill="#A80036" points="695.5,849.4482,685.5,853.4482,695.5,857.4482,691.5,853.4482" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#00FFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="691.5" y="835.5918">λ3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="153" x="705.5" y="835.5918">: DBUpdater&lt;T&gt;::Populate</text><polygon fill="#A80036" points="411,863.4482,401,867.4482,411,871.4482,407,867.4482" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="405" x2="683.5" y1="867.4482" y2="867.4482"/><polygon fill="#A80036" points="672.5,895.2026,682.5,899.2026,672.5,903.2026,676.5,899.2026" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="400" x2="678.5" y1="899.2026" y2="899.2026"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="407" y="894.3462">UpdateDatabases()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="726.5" y1="930.957" y2="930.957"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="726.5" x2="726.5" y1="930.957" y2="943.957"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="685.5" x2="726.5" y1="943.957" y2="943.957"/><polygon fill="#A80036" points="695.5,939.957,685.5,943.957,695.5,947.957,691.5,943.957" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#00FFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="691.5" y="926.1006">λ4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="705.5" y="926.1006">: DBUpdater&lt;T&gt;::Update</text><polygon fill="#A80036" points="411,953.957,401,957.957,411,961.957,407,957.957" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="405" x2="683.5" y1="957.957" y2="957.957"/><polygon fill="#A80036" points="672.5,985.7114,682.5,989.7114,672.5,993.7114,676.5,989.7114" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="400" x2="678.5" y1="989.7114" y2="989.7114"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="407" y="984.855">PrepareStatements()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="726.5" y1="1056.9746" y2="1056.9746"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="726.5" x2="726.5" y1="1056.9746" y2="1069.9746"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="685.5" x2="726.5" y1="1069.9746" y2="1069.9746"/><polygon fill="#A80036" points="695.5,1065.9746,685.5,1069.9746,695.5,1073.9746,691.5,1069.9746" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#00FFFF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="14" x="691.5" y="1016.6094">λ4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="705.5" y="1016.6094">: PrepareStatements()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="237" x="727.5" y="1034.3638">MySQLConnection::PrepareStatements()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="287" x="735.5" y="1052.1182">LoginDatabaseConnection::DoPrepareStatements</text><polygon fill="#A80036" points="411,1079.9746,401,1083.9746,411,1087.9746,407,1083.9746" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="405" x2="683.5" y1="1083.9746" y2="1083.9746"/><polygon fill="#A80036" points="78.5,1100.9746,68.5,1104.9746,78.5,1108.9746,74.5,1104.9746" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="72.5" x2="399" y1="1104.9746" y2="1104.9746"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="391" x2="409" y1="1095.9746" y2="1113.9746"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="391" x2="409" y1="1113.9746" y2="1095.9746"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="109.5" y1="1143.729" y2="1143.729"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109.5" x2="109.5" y1="1143.729" y2="1156.729"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="68.5" x2="109.5" y1="1156.729" y2="1156.729"/><polygon fill="#A80036" points="78.5,1152.729,68.5,1156.729,78.5,1160.729,74.5,1156.729" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="74.5" y="1138.8726">sRealmList-&gt;Initialize()</text><path d="M13,1171.729 L254,1171.729 L254,1180.729 L244,1190.729 L13,1190.729 L13,1171.729 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="583.436" style="stroke: #000000; stroke-width: 2.0;" width="1739" x="13" y="1171.729"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="196" x="28" y="1187.627">sAuthSocketMgr.StartNetwork()</text><polygon fill="#A80036" points="960.5,1211.2378,970.5,1215.2378,960.5,1219.2378,964.5,1215.2378" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="966.5" y1="1215.2378" y2="1215.2378"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="74.5" y="1210.3813">AuthSocketMgr.Instance()</text><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="110" x="972.5" y="1191.4834"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="96" x="979.5" y="1214.5273">AuthSocketMgr</text><polygon fill="#A80036" points="1169.5,1259.3579,1179.5,1263.3579,1169.5,1267.3579,1173.5,1263.3579" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1029.5" x2="1175.5" y1="1263.3579" y2="1263.3579"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="83" x="1036.5" y="1258.5015">StartNetwork()</text><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="176" x="1181.5" y="1239.6035"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="1188.5" y="1262.6475">SocketMgr&lt;AuthSession&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1271.5" x2="1313.5" y1="1329.2324" y2="1329.2324"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1313.5" x2="1313.5" y1="1329.2324" y2="1342.2324"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1272.5" x2="1313.5" y1="1342.2324" y2="1342.2324"/><polygon fill="#A80036" points="1282.5,1338.2324,1272.5,1342.2324,1282.5,1346.2324,1278.5,1342.2324" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="124" x="1278.5" y="1306.6216">new AsyncAcceptor()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1282.5" y="1324.376">AsyncAcceptor.Bind()</text><polygon fill="#A80036" points="1040.5,1369.9868,1030.5,1373.9868,1040.5,1377.9868,1036.5,1373.9868" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1034.5" x2="1270.5" y1="1373.9868" y2="1373.9868"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1046.5" y="1369.1304">CreateThreads()</text><polygon fill="#A80036" points="1259.5,1401.7412,1269.5,1405.7412,1259.5,1409.7412,1263.5,1405.7412" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1029.5" x2="1265.5" y1="1405.7412" y2="1405.7412"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="1036.5" y="1400.8848">new NetworkThread&lt;AuthSession&gt;[1]</text><polygon fill="#A80036" points="1384.5,1433.4956,1394.5,1437.4956,1384.5,1441.4956,1388.5,1437.4956" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1271.5" x2="1390.5" y1="1437.4956" y2="1437.4956"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="101" x="1278.5" y="1432.6392">_threads[i].Start()</text><rect fill="#FEFECE" filter="url(#fl4bfh57hav0)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="205" x="1396.5" y="1413.7412"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="191" x="1403.5" y="1436.7852">NetworkThread&lt;AuthSession&gt;</text><path d="M1386.5,1468.8613 L1459.5,1468.8613 L1459.5,1477.8613 L1449.5,1487.8613 L1386.5,1487.8613 L1386.5,1468.8613 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="188.7949" style="stroke: #000000; stroke-width: 2.0;" width="355.5" x="1386.5" y="1468.8613"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1401.5" y="1484.7593">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="1474.5" y="1483.4673">[Run() Timer(10ms)]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1501" x2="1543" y1="1512.3931" y2="1512.3931"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1543" x2="1543" y1="1512.3931" y2="1525.3931"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1502" x2="1543" y1="1525.3931" y2="1525.3931"/><polygon fill="#A80036" points="1512,1521.3931,1502,1525.3931,1512,1529.3931,1508,1525.3931" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="1508" y="1507.5366">Update()</text><polygon fill="#A80036" points="1652,1553.1475,1662,1557.1475,1652,1561.1475,1656,1557.1475" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1501" x2="1658" y1="1557.1475" y2="1557.1475"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="1508" y="1552.291">_sockets.erase()</text><path d="M1605.5,1572.1475 L1678.5,1572.1475 L1678.5,1581.1475 L1668.5,1591.1475 L1605.5,1591.1475 L1605.5,1572.1475 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="64.5088" style="stroke: #000000; stroke-width: 2.0;" width="126.5" x="1605.5" y="1572.1475"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1620.5" y="1588.0454">loop</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1664" x2="1706" y1="1615.6563" y2="1615.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1706" x2="1706" y1="1615.6563" y2="1628.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1665" x2="1706" y1="1628.6563" y2="1628.6563"/><polygon fill="#A80036" points="1675,1624.6563,1665,1628.6563,1675,1632.6563,1671,1628.6563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="1671" y="1610.7998">Update()</text><polygon fill="#A80036" points="1512,1645.6563,1502,1649.6563,1512,1653.6563,1508,1649.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1506" x2="1663" y1="1649.6563" y2="1649.6563"/><polygon fill="#A80036" points="1282.5,1666.6563,1272.5,1670.6563,1282.5,1674.6563,1278.5,1670.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1276.5" x2="1500" y1="1670.6563" y2="1670.6563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1271.5" x2="1313.5" y1="1720.165" y2="1720.165"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1313.5" x2="1313.5" y1="1720.165" y2="1733.165"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1272.5" x2="1313.5" y1="1733.165" y2="1733.165"/><polygon fill="#A80036" points="1282.5,1729.165,1272.5,1733.165,1282.5,1737.165,1278.5,1733.165" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="1278.5" y="1697.5542">AsyncAcceptWithCallback(</text><text fill="#FF7F50" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="1437.5" y="1697.5542">cb1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1459.5" y="1697.5542">)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="1290.5" y="1715.3086">: _acceptor.async_accept</text><polygon fill="#A80036" points="1040.5,1743.165,1030.5,1747.165,1040.5,1751.165,1036.5,1747.165" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1034.5" x2="1270.5" y1="1747.165" y2="1747.165"/><path d="M13,1769.165 L86,1769.165 L86,1778.165 L76,1788.165 L13,1788.165 L13,1769.165 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1221.6899" style="stroke: #000000; stroke-width: 2.0;" width="2055.5" x="13" y="1769.165"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="28" y="1785.063">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="141" x="101" y="1783.771">[AsyncAcceptor.Accept()]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="109.5" y1="1812.6968" y2="1812.6968"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109.5" x2="109.5" y1="1812.6968" y2="1825.6968"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="68.5" x2="109.5" y1="1825.6968" y2="1825.6968"/><polygon fill="#A80036" points="78.5,1821.6968,68.5,1825.6968,78.5,1829.6968,74.5,1825.6968" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="74.5" y="1807.8403">ioContext-&gt;run();</text><path d="M474,1840.6968 L540,1840.6968 L540,1849.6968 L530,1859.6968 L474,1859.6968 L474,1840.6968 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1077.6494" style="stroke: #000000; stroke-width: 2.0;" width="1584.5" x="474" y="1840.6968"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="489" y="1856.5947">par</text><polygon fill="#A80036" points="1675,1880.2056,1665,1884.2056,1675,1888.2056,1671,1884.2056" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1669" x2="1991" y1="1884.2056" y2="1884.2056"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="1681" y="1879.3491">Connect AuthServer &lt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="182" x="1808" y="1879.3491">AUTH_LOGON_CHALLENGE&gt;</text><polygon fill="#A80036" points="1040.5,1911.96,1030.5,1915.96,1040.5,1919.96,1036.5,1915.96" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1034.5" x2="1663" y1="1915.96" y2="1915.96"/><text fill="#FF7F50" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="1046.5" y="1911.1035">OnSocketAccept()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="1162.5" y="1911.1035">&lt;- accept callback</text><polygon fill="#A80036" points="1259.5,1943.7144,1269.5,1947.7144,1259.5,1951.7144,1263.5,1947.7144" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1029.5" x2="1265.5" y1="1947.7144" y2="1947.7144"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="1036.5" y="1942.8579">Instance().OnSocketOpen()</text><polygon fill="#A80036" points="1652,1975.4688,1662,1979.4688,1652,1983.4688,1656,1979.4688" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1271.5" x2="1658" y1="1979.4688" y2="1979.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="1278.5" y="1974.6123">newSocket-&gt;Start()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="694.5" y1="2011.2231" y2="2007.2231"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="694.5" y1="2011.2231" y2="2015.2231"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="1663" y1="2011.2231" y2="2011.2231"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="701.5" y="2006.3667">LoginDatabase.AsyncQuery() -&gt;</text><text fill="#00FFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="891.5" y="2006.3667">cb2</text><path d="M1567,2024.2231 L1567,2051.2231 L1756,2051.2231 L1756,2034.2231 L1746,2024.2231 L1567,2024.2231 " fill="#FBFB77" filter="url(#fl4bfh57hav0)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1746,2024.2231 L1746,2034.2231 L1756,2034.2231 L1746,2024.2231 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="1573" y="2044.1211">_queryProcessor.AddQuery()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1662" x2="1652" y1="2084.7319" y2="2080.7319"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1662" x2="1652" y1="2084.7319" y2="2088.7319"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="684.5" x2="1663" y1="2084.7319" y2="2084.7319"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="691.5" y="2079.8755">&lt;&lt; QueryCallback &gt;&gt;</text><text fill="#00FFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="824.5" y="2079.8755">cb2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="850.5" y="2079.8755">[LOGIN_SEL_IP_INFO queryResultFuture]</text><path d="M1605.5,2099.7319 L1678.5,2099.7319 L1678.5,2108.7319 L1668.5,2118.7319 L1605.5,2118.7319 L1605.5,2099.7319 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="153.2808" style="stroke: #000000; stroke-width: 2.0;" width="333.5" x="1605.5" y="2099.7319"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="1620.5" y="2115.6299">loop</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1664" x2="1706" y1="2232.0127" y2="2232.0127"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1706" x2="1706" y1="2232.0127" y2="2245.0127"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1665" x2="1706" y1="2245.0127" y2="2245.0127"/><polygon fill="#A80036" points="1675,2241.0127,1665,2245.0127,1675,2249.0127,1671,2245.0127" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="49" x="1671" y="2138.3843">Update()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="1679" y="2156.1387">:_queryProcessor.ProcessReadyQueries()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1699" y="2173.8931">:</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="1707" y="2173.8931">cb2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1707" y="2191.6475"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="118" x="1707" y="2191.6475">.CheckIpCallback()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="75" x="1719" y="2209.4019">AsyncRead()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="1739" y="2227.1563">ReadHandler()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1664" x2="1706" y1="2283.7671" y2="2283.7671"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1706" x2="1706" y1="2283.7671" y2="2296.7671"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1665" x2="1706" y1="2296.7671" y2="2296.7671"/><polygon fill="#A80036" points="1675,2292.7671,1665,2296.7671,1675,2300.7671,1671,2296.7671" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="1671" y="2278.9106">HandleLogonChallenge()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="694.5" y1="2328.5215" y2="2324.5215"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="694.5" y1="2328.5215" y2="2332.5215"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="1663" y1="2328.5215" y2="2328.5215"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="701.5" y="2323.665">LoginDatabase.AsyncQuery() -&gt;</text><text fill="#00FFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="891.5" y="2323.665">cb3</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1662" x2="1652" y1="2360.2759" y2="2356.2759"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1662" x2="1652" y1="2360.2759" y2="2364.2759"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="684.5" x2="1663" y1="2360.2759" y2="2360.2759"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="691.5" y="2355.4194">&lt;&lt; QueryCallback &gt;&gt;</text><text fill="#00FFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="824.5" y="2355.4194">cb3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="850.5" y="2355.4194">[LOGIN_SEL_LOGONCHALLENGE queryResultFuture]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1664" x2="1706" y1="2409.7847" y2="2409.7847"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1706" x2="1706" y1="2409.7847" y2="2422.7847"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1665" x2="1706" y1="2422.7847" y2="2422.7847"/><polygon fill="#A80036" points="1675,2418.7847,1665,2422.7847,1675,2426.7847,1671,2422.7847" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#00FFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="1671" y="2387.1738">cb3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1697" y="2387.1738"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1675" y="2404.9282"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="164" x="1675" y="2404.9282">.LogonChallengeCallback</text><polygon fill="#A80036" points="1980,2450.5391,1990,2454.5391,1980,2458.5391,1984,2454.5391" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1664" x2="1986" y1="2454.5391" y2="2454.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="1671" y="2449.6826">SendPacket() &lt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="105" x="1762" y="2449.6826">WOW_SUCCESS</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1867" y="2449.6826">&gt;</text><path d="M484,2469.5391 L550,2469.5391 L550,2478.5391 L540,2488.5391 L484,2488.5391 L484,2469.5391 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="173.772" style="stroke: #000000; stroke-width: 2.0;" width="1564.5" x="484" y="2469.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="499" y="2485.437">par</text><polygon fill="#A80036" points="1675,2509.0479,1665,2513.0479,1675,2517.0479,1671,2513.0479" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1669" x2="1991" y1="2513.0479" y2="2513.0479"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="1681" y="2508.1914">cmd &lt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142" x="1718" y="2508.1914">AUTH_LOGON_PROOF</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1860" y="2508.1914">&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1664" x2="1706" y1="2544.8022" y2="2544.8022"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1706" x2="1706" y1="2544.8022" y2="2557.8022"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1665" x2="1706" y1="2557.8022" y2="2557.8022"/><polygon fill="#A80036" points="1675,2553.8022,1665,2557.8022,1675,2561.8022,1671,2557.8022" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="1671" y="2539.9458">HandleLogonProof()</text><polygon fill="#A80036" points="695.5,2585.5566,685.5,2589.5566,695.5,2593.5566,691.5,2589.5566" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="689.5" x2="1663" y1="2589.5566" y2="2589.5566"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="364" x="701.5" y="2584.7002">LoginDatabase.DirectExecute() [LOGIN_UPD_LOGONPROOF]</text><polygon fill="#A80036" points="1652,2599.5566,1662,2603.5566,1652,2607.5566,1656,2603.5566" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="684.5" x2="1658" y1="2603.5566" y2="2603.5566"/><polygon fill="#A80036" points="1980,2631.311,1990,2635.311,1980,2639.311,1984,2635.311" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1664" x2="1986" y1="2635.311" y2="2635.311"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="1671" y="2630.4546">SendPacket() &lt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142" x="1762" y="2630.4546">AUTH_LOGON_PROOF</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1904" y="2630.4546">&gt;</text><path d="M484,2657.311 L550,2657.311 L550,2666.311 L540,2676.311 L484,2676.311 L484,2657.311 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="254.0352" style="stroke: #000000; stroke-width: 2.0;" width="1564.5" x="484" y="2657.311"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="499" y="2673.209">par</text><polygon fill="#A80036" points="1675,2696.8198,1665,2700.8198,1675,2704.8198,1671,2700.8198" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1669" x2="1991" y1="2700.8198" y2="2700.8198"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="1681" y="2695.9634">cmd &lt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="1718" y="2695.9634">REALM_LIST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1799" y="2695.9634">&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1664" x2="1706" y1="2732.5742" y2="2732.5742"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1706" x2="1706" y1="2732.5742" y2="2745.5742"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1665" x2="1706" y1="2745.5742" y2="2745.5742"/><polygon fill="#A80036" points="1675,2741.5742,1665,2745.5742,1675,2749.5742,1671,2745.5742" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="106" x="1671" y="2727.7178">HandleRealmList()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="694.5" y1="2777.3286" y2="2773.3286"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="694.5" y1="2777.3286" y2="2781.3286"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="684.5" x2="1663" y1="2777.3286" y2="2777.3286"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="701.5" y="2772.4722">LoginDatabase.AsyncQuery() -&gt;</text><text fill="#00FFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="891.5" y="2772.4722">cb4</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1662" x2="1652" y1="2809.083" y2="2805.083"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1662" x2="1652" y1="2809.083" y2="2813.083"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="684.5" x2="1663" y1="2809.083" y2="2809.083"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="691.5" y="2804.2266">&lt;&lt; QueryCallback &gt;&gt;</text><text fill="#00FFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="824.5" y="2804.2266">cb4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="387" x="850.5" y="2804.2266">[LOGIN_SEL_REALM_CHARACTER_COUNTS queryResultFuture]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1664" x2="1706" y1="2858.5918" y2="2858.5918"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1706" x2="1706" y1="2858.5918" y2="2871.5918"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1665" x2="1706" y1="2871.5918" y2="2871.5918"/><polygon fill="#A80036" points="1675,2867.5918,1665,2871.5918,1675,2875.5918,1671,2871.5918" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#00FFFF" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="1671" y="2835.981">cb4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1697" y="2835.981"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1675" y="2853.7354"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="122" x="1675" y="2853.7354">.RealmListCallback</text><polygon fill="#A80036" points="1980,2899.3462,1990,2903.3462,1980,2907.3462,1984,2903.3462" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1664" x2="1986" y1="2903.3462" y2="2903.3462"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="91" x="1671" y="2898.4897">SendPacket() &lt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="81" x="1762" y="2898.4897">REALM_LIST</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1843" y="2898.4897">&gt;</text><path d="M1605.5,2932.3462 L1671.5,2932.3462 L1671.5,2941.3462 L1661.5,2951.3462 L1605.5,2951.3462 L1605.5,2932.3462 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="51.5088" style="stroke: #000000; stroke-width: 2.0;" width="443" x="1605.5" y="2932.3462"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="1620.5" y="2948.2441">par</text><polygon fill="#A80036" points="1675,2971.855,1665,2975.855,1675,2979.855,1671,2975.855" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1669" x2="1996" y1="2975.855" y2="2975.855"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1681" y="2970.9985">&lt;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="210" x="1689" y="2970.9985">AUTH_LOGON_CHALLENGE&gt; ......</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="67.5" x2="109.5" y1="3021.6094" y2="3021.6094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="109.5" x2="109.5" y1="3021.6094" y2="3034.6094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="68.5" x2="109.5" y1="3034.6094" y2="3034.6094"/><polygon fill="#A80036" points="78.5,3030.6094,68.5,3034.6094,78.5,3038.6094,74.5,3034.6094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="74.5" y="3016.7529">sAuthSocketMgr.StopNetwork()</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="58.5" x2="76.5" y1="3025.6094" y2="3043.6094"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="58.5" x2="76.5" y1="3043.6094" y2="3025.6094"/><text fill="#888888" font-family="sans-serif" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="53" x="1014.25" y="3157.1895">by jinnblue</text><!--
@startuml
title AuthServer
footer by jinnblue

box "Auth Server" #Azure
  participant A as "AuthServer" #Gold
  participant C as "ConfigMgr"
  participant D as "<< DatabaseLoader >> \n loader" #DarkGray
  participant P as "<< DatabaseWorkerPool<LoginDatabaseConnection> >> \n LoginDatabase"
  participant M as "AuthSocketMgr"
  participant MA as "SocketMgr<AuthSession>"
  participant N as "NetworkThread<AuthSession>"
  participant S as "AuthSession"
end box
actor W as "WOW Client"

Create C
group #LightGray sConfigMgr->LoadInitial()
  A -> C
  A <- - C: authserver.conf loaded
end

group #Azure StartDB()
  Create D
  A -> D : initialize

  group AddDatabase()
    D -> P
    P -> P:_open.push(<font color=Aqua>λ1</font>)
    P -> P: _close.push(<font color=Aqua>λ2</font>)
    alt 配置:Updates.EnableDatabases=true
      P -> P: _populate.push(<font color=Aqua>λ3</font>) \n_update.push(<font color=Aqua>λ4</font>)
    end
    P -> P: _prepare.push(<font color=Aqua>λ5</font>)
  end
  D <- - P

  group Load()
    D -> P: OpenDatabases()
      P -> P: <font color=Aqua>λ1</font>: SetConnectionInfo() \n        [DBUpdater<T>::Create() : "create_table.sql"] \n      Open()
    D <- - P

    D -> P: PopulateDatabases()
      P -> P: <font color=Aqua>λ3</font>: DBUpdater<T>::Populate
    D <- - P

    D -> P: UpdateDatabases()
      P -> P: <font color=Aqua>λ4</font>: DBUpdater<T>::Update
    D <- - P

    D -> P: PrepareStatements()
      P -> P: <font color=Aqua>λ4</font>: PrepareStatements() \n         MySQLConnection::PrepareStatements() \n           LoginDatabaseConnection::DoPrepareStatements
    D <- - P
  end

  A <- - D
  destroy D
end

A -> A: sRealmList->Initialize()

Create M
group #Azure sAuthSocketMgr.StartNetwork()
  A -> M: AuthSocketMgr.Instance()
  Create MA
  M -> MA: StartNetwork()
  MA -> MA: new AsyncAcceptor() \n AsyncAcceptor.Bind()
  M <- - MA: CreateThreads()
  M -> MA: new NetworkThread<AuthSession>[1]
    Create N
    MA -> N: _threads[i].Start()
    loop #Aqua Run() Timer(10ms)
      N -> N: Update()
      N -> S: _sockets.erase()
      loop #Aqua
        S -> S: Update()
      end
      N <- - S
    end
    MA <- - N
    MA -> MA: AsyncAcceptWithCallback(<font color=Coral><b>cb1</font>) \n   : _acceptor.async_accept
  M <- - MA
end

loop #Azure AsyncAcceptor.Accept()
A -> A: ioContext->run();

  par #BUSINESS
    W -> S: Connect AuthServer <<b>AUTH_LOGON_CHALLENGE>
    activate W
    S -> M: <font color=Coral><b>OnSocketAccept()</font> <- accept callback
    MA <- - M: Instance().OnSocketOpen()
    S <- - MA: newSocket->Start()
    S ->> P: LoginDatabase.AsyncQuery() -> <font color=Aqua><b>cb2</font>
    note over S: _queryProcessor.AddQuery()
    S <<- - P: << QueryCallback >>  <font color=Aqua><b>cb2</font> [LOGIN_SEL_IP_INFO queryResultFuture]
    loop #Aqua
      S -> S: Update() \n  :_queryProcessor.ProcessReadyQueries() \n       : <b>cb2 \n         <b>.CheckIpCallback() \n            AsyncRead() \n\t\t ReadHandler()
    end
    S -> S: HandleLogonChallenge()
    S ->> P: LoginDatabase.AsyncQuery() -> <font color=Aqua><b>cb3</font>
    S <<- - P: << QueryCallback >>  <font color=Aqua><b>cb3</font> [LOGIN_SEL_LOGONCHALLENGE queryResultFuture]
    S -> S: <font color=Aqua><b>cb3</font> \n <b>.LogonChallengeCallback
    W <- - S: SendPacket() <<b>WOW_SUCCESS</b>>

    par #BUSINESS
      W -> S: cmd <<b>AUTH_LOGON_PROOF</b>>
      S -> S: HandleLogonProof()
      S -> P: LoginDatabase.DirectExecute() [LOGIN_UPD_LOGONPROOF]
      S <- - P
      W <- - S: SendPacket() <<b>AUTH_LOGON_PROOF</b>>
    end

    par #BUSINESS
      W -> S: cmd <<b>REALM_LIST</b>>
      S -> S: HandleRealmList()
      S ->> P: LoginDatabase.AsyncQuery() -> <font color=Aqua><b>cb4</font>
      S <<- - P: << QueryCallback >>  <font color=Aqua><b>cb4</font> [LOGIN_SEL_REALM_CHARACTER_COUNTS queryResultFuture]
      S -> S: <font color=Aqua><b>cb4</font> \n <b>.RealmListCallback
      W <- - S: SendPacket() <<b>REALM_LIST</b>>
    end
    deactivate W
  end

  par #BUSINESS
    W -> S: <<b>AUTH_LOGON_CHALLENGE> ......
  end
end

A -> A: sAuthSocketMgr.StopNetwork()
destroy A
@enduml

PlantUML version 1.2019.06(Sat May 25 01:10:25 CST 2019)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_221-b11
Operating System: Windows 10
OS Version: 10.0
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>